# IM ç³»ç»Ÿå‰åç«¯æ¥å£åˆ†ææŠ¥å‘Š

ç”Ÿæˆæ—¶é—´ï¼š2026-01-22 13:14:00

## ä¸€ã€æ ¸å¿ƒ IM åŠŸèƒ½æ¥å£åˆ†æ

### 1. ç”¨æˆ·ç›¸å…³æ¥å£

#### 1.1 è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- **åç«¯æ¥å£**ï¼š`GET /api/im/user/info`
  - Controller: `ImUserController.getUserInfo()`
  - å‚æ•°ï¼š`@RequestHeader userId` (å¯é€‰ï¼Œé»˜è®¤1)
  - è¿”å›ï¼š`Result<ImUserVO>`
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/user.js - getUserInfo()`
  - è·¯å¾„ï¼š`/api/im/user/info`
  - æ–¹æ³•ï¼šGET
  - å‚æ•°ï¼šæ— 
  
- **åŒ¹é…çŠ¶æ€**ï¼šâœ… åŒ¹é…
- **é—®é¢˜**ï¼šåç«¯å¯èƒ½è¿”å› 500 é”™è¯¯ï¼Œéœ€æ£€æŸ¥ Service å±‚å®ç°

#### 1.2 æœç´¢ç”¨æˆ·
- **åç«¯æ¥å£**ï¼š`GET /api/im/user/search`
  - å‚æ•°ï¼š`@RequestParam keyword`
  - è¿”å›ï¼š`Result<List<ImUserVO>>`
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/user.js - searchUsers(keyword)`
  - è·¯å¾„ï¼š`/api/im/user/search`
  - å‚æ•°ï¼š`params: { keyword }`
  
- **åŒ¹é…çŠ¶æ€**ï¼šâœ… åŒ¹é…

### 2. ä¼šè¯ç›¸å…³æ¥å£

#### 2.1 è·å–ä¼šè¯åˆ—è¡¨
- **åç«¯æ¥å£**ï¼š`GET /api/im/conversation/list`
  - Controller: `ImConversationController.getUserConversations()`
  - å‚æ•°ï¼š`@RequestHeader userId` (å¯é€‰ï¼Œé»˜è®¤1)
  - è¿”å›ï¼š`Result<List<ImConversationVO>>`
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/conversation.js - getConversations()`
  - è·¯å¾„ï¼š`/api/im/conversation/list`
  - æ–¹æ³•ï¼šGET
  - å‚æ•°ï¼šæ— 
  
- **åŒ¹é…çŠ¶æ€**ï¼šâœ… åŒ¹é…

#### 2.2 è·å–ä¼šè¯è¯¦æƒ…
- **åç«¯æ¥å£**ï¼š`GET /api/im/conversation/{id}`
  - å‚æ•°ï¼š`@PathVariable id`, `@RequestHeader userId`
  - è¿”å›ï¼š`Result<ImConversationVO>`
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/conversation.js - getConversation(conversationId)`
  - è·¯å¾„ï¼š`/api/im/conversation/${conversationId}`
  - æ–¹æ³•ï¼šGET
  
- **åŒ¹é…çŠ¶æ€**ï¼šâœ… åŒ¹é…

#### 2.3 æ ‡è®°ä¼šè¯å·²è¯»
- **åç«¯æ¥å£**ï¼š`PUT /api/im/conversation/{id}/markAsRead`
  - å‚æ•°ï¼š`@PathVariable id`, `@RequestHeader userId`
  - è¿”å›ï¼š`Result<Void>`
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/conversation.js - markConversationAsRead(conversationId)`
  - è·¯å¾„ï¼š`/api/im/conversation/${conversationId}/markAsRead`
  - æ–¹æ³•ï¼šPUT
  
- **åŒ¹é…çŠ¶æ€**ï¼šâœ… åŒ¹é…

### 3. æ¶ˆæ¯ç›¸å…³æ¥å£

#### 3.1 å‘é€æ¶ˆæ¯
- **åç«¯æ¥å£**ï¼š`POST /api/im/message/send`
  - Controller: `ImMessageController.send()`
  - å‚æ•°ï¼š`@RequestBody ImMessageSendRequest`, `@RequestHeader userId`
  - è¯·æ±‚ä½“å­—æ®µï¼š
    - `conversationId` (Long, å¿…å¡«)
    - `type` (String, å¿…å¡«) - æ¶ˆæ¯ç±»å‹
    - `content` (String, å¿…å¡«)
    - `receiverId` (Long, å¯é€‰)
    - `replyToMessageId` (Long, å¯é€‰)
    - `clientMsgId` (String, å¯é€‰)
    - `extra` (String, å¯é€‰)
    - `mentionInfo` (Object, å¯é€‰)
  - è¿”å›ï¼š`Result<Long>` - æ¶ˆæ¯ID
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/message.js - sendMessage(data)`
  - è·¯å¾„ï¼š`/api/im/message/send`
  - æ–¹æ³•ï¼šPOST
  - è¯·æ±‚ä½“å­—æ®µï¼š
    - `conversationId`
    - `messageType` âš ï¸
    - `content`
    - `replyToMessageId`
  
- **åŒ¹é…çŠ¶æ€**ï¼šâš ï¸ å­—æ®µåä¸åŒ¹é…
  - åç«¯ï¼š`type`
  - å‰ç«¯ï¼š`messageType`

#### 3.2 è·å–æ¶ˆæ¯åˆ—è¡¨
- **åç«¯æ¥å£**ï¼š`GET /api/im/message/list/{conversationId}`
  - Controller: `ImMessageController.getMessages()`
  - å‚æ•°ï¼š
    - `@PathVariable conversationId`
    - `@RequestParam lastId` (å¯é€‰)
    - `@RequestParam limit` (å¯é€‰ï¼Œé»˜è®¤20)
    - `@RequestHeader userId`
  - è¿”å›ï¼š`Result<List<ImMessageVO>>`
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/message.js - getMessages(conversationId, params)`
  - è·¯å¾„ï¼š`/api/im/message/list/${conversationId}`
  - æ–¹æ³•ï¼šGET
  - å‚æ•°ï¼š`params` å¯¹è±¡
  
- **åŒ¹é…çŠ¶æ€**ï¼šâœ… åŒ¹é…

#### 3.3 æ’¤å›æ¶ˆæ¯
- **åç«¯æ¥å£**ï¼š`DELETE /api/im/message/{messageId}/recall`
  - å‚æ•°ï¼š`@PathVariable messageId`, `@RequestHeader userId`
  - è¿”å›ï¼š`Result<Void>`
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/message.js - recallMessage(messageId)`
  - è·¯å¾„ï¼š`/api/im/message/${messageId}/recall`
  - æ–¹æ³•ï¼šDELETE
  
- **åŒ¹é…çŠ¶æ€**ï¼šâœ… åŒ¹é…

#### 3.4 åˆ é™¤æ¶ˆæ¯
- **åç«¯æ¥å£**ï¼š`DELETE /api/im/message/{messageId}`
  - å‚æ•°ï¼š`@PathVariable messageId`, `@RequestHeader userId`
  - è¿”å›ï¼š`Result<Void>`
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/message.js - deleteMessage(messageId)`
  - è·¯å¾„ï¼š`/api/im/message/${messageId}`
  - æ–¹æ³•ï¼šDELETE
  
- **åŒ¹é…çŠ¶æ€**ï¼šâœ… åŒ¹é…

#### 3.5 æ ‡è®°æ¶ˆæ¯å·²è¯»
- **åç«¯æ¥å£**ï¼š`PUT /api/im/message/read`
  - Controller: `ImMessageController.markConversationRead()`
  - å‚æ•°ï¼š
    - `@RequestParam conversationId`
    - `@RequestParam lastReadMessageId` (å¯é€‰)
    - `@RequestHeader userId`
  - è¿”å›ï¼š`Result<Void>`
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/message.js - markAsRead(data)`
  - è·¯å¾„ï¼š`/api/im/message/read`
  - æ–¹æ³•ï¼šPUT
  - å‚æ•°ï¼š
    - `params.conversationId`
    - `params.lastReadMessageId` (ä» data.messageId æ˜ å°„)
  
- **åŒ¹é…çŠ¶æ€**ï¼šâœ… åŒ¹é…

### 4. è”ç³»äººç›¸å…³æ¥å£

#### 4.1 è·å–è”ç³»äººåˆ—è¡¨
- **åç«¯æ¥å£**ï¼š`GET /api/im/contact/list`
  - Controller: `ImContactController.getContacts()`
  - å‚æ•°ï¼š`@RequestHeader userId`, å…¶ä»–æŸ¥è¯¢å‚æ•°
  - è¿”å›ï¼š`Result<List<ImFriendVO>>`
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/contact.js - getContacts(params)`
  - è·¯å¾„ï¼š`/api/im/contact/list`
  - æ–¹æ³•ï¼šGET
  - å‚æ•°ï¼š`params`
  
- **åŒ¹é…çŠ¶æ€**ï¼šâœ… åŒ¹é…

#### 4.2 æœç´¢è”ç³»äºº
- **åç«¯æ¥å£**ï¼š`GET /api/im/contact/search`
  - å‚æ•°ï¼š`@RequestParam keyword`, `@RequestHeader userId`
  - è¿”å›ï¼š`Result<List<ImFriendVO>>`
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/contact.js - searchContacts(keyword)`
  - è·¯å¾„ï¼š`/api/im/contact/search`
  - æ–¹æ³•ï¼šGET
  - å‚æ•°ï¼š`params: { keyword }`
  
- **åŒ¹é…çŠ¶æ€**ï¼šâœ… åŒ¹é…

### 5. ç¾¤ç»„ç›¸å…³æ¥å£

#### 5.1 è·å–ç¾¤ç»„åˆ—è¡¨
- **åç«¯æ¥å£**ï¼š`GET /api/im/group/list`
  - Controller: `ImGroupController.getGroups()`
  - å‚æ•°ï¼š`@RequestHeader userId`
  - è¿”å›ï¼š`Result<List<ImGroupVO>>`
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/group.js - getGroups()`
  - è·¯å¾„ï¼š`/api/im/group/list`
  - æ–¹æ³•ï¼šGET
  
- **åŒ¹é…çŠ¶æ€**ï¼šâœ… åŒ¹é…

#### 5.2 è·å–ç¾¤ç»„è¯¦æƒ…
- **åç«¯æ¥å£**ï¼š`GET /api/im/group/{groupId}`
  - å‚æ•°ï¼š`@PathVariable groupId`, `@RequestHeader userId`
  - è¿”å›ï¼š`Result<ImGroupVO>`
  
- **å‰ç«¯è°ƒç”¨**ï¼š`src/api/im/group.js - getGroup(groupId)`
  - è·¯å¾„ï¼š`/api/im/group/${groupId}`
  - æ–¹æ³•ï¼šGET
  
- **åŒ¹é…çŠ¶æ€**ï¼šâœ… åŒ¹é…

## äºŒã€å‘ç°çš„æ¥å£ä¸åŒ¹é…é—®é¢˜

### é—®é¢˜ 1ï¼šæ¶ˆæ¯å‘é€æ¥å£å­—æ®µåä¸åŒ¹é… âš ï¸

**ä½ç½®**ï¼š`POST /api/im/message/send`

**é—®é¢˜æè¿°**ï¼š
- åç«¯æœŸæœ›å­—æ®µåï¼š`type`
- å‰ç«¯å‘é€å­—æ®µåï¼š`messageType`

**å½±å“**ï¼šæ¶ˆæ¯å‘é€åŠŸèƒ½æ— æ³•æ­£å¸¸å·¥ä½œ

**ä¿®å¤æ–¹æ¡ˆ**ï¼šä¿®æ”¹å‰ç«¯ä»£ç ï¼Œå°† `messageType` æ”¹ä¸º `type`

### é—®é¢˜ 2ï¼šéƒ¨åˆ†éæ ¸å¿ƒæ¥å£ä¸å­˜åœ¨ âŒ

**ä¸å­˜åœ¨çš„æ¥å£**ï¼š
1. `GET /api/im/organization/tree` - ç»„ç»‡æ¶æ„æ ‘
2. `GET /api/im/workbench/statistics` - å·¥ä½œå°ç»Ÿè®¡

**å½±å“**ï¼šé€šè®¯å½•å’Œå·¥ä½œå°æ¨¡å—éƒ¨åˆ†åŠŸèƒ½æ— æ³•ä½¿ç”¨

**ä¿®å¤æ–¹æ¡ˆ**ï¼šå‰ç«¯æ·»åŠ å®¹é”™å¤„ç†ï¼Œæˆ–åç«¯å®ç°è¿™äº›æ¥å£

### é—®é¢˜ 3ï¼šåç«¯ 500 é”™è¯¯ ğŸ”´

**å—å½±å“æ¥å£**ï¼š
1. `GET /api/im/user/info`
2. `GET /api/im/announcement/list`
3. `GET /api/im/attendance/records`

**å¯èƒ½åŸå› **ï¼š
- Service å±‚ç©ºæŒ‡é’ˆå¼‚å¸¸
- æ•°æ®åº“æ•°æ®ç¼ºå¤±
- ä¾èµ–æ³¨å…¥é—®é¢˜

**ä¿®å¤æ–¹æ¡ˆ**ï¼šéœ€è¦æ£€æŸ¥åç«¯æ—¥å¿—ï¼Œå®šä½å…·ä½“é”™è¯¯åŸå› 

## ä¸‰ã€ä¿®å¤ä¼˜å…ˆçº§

### P0 - æ ¸å¿ƒåŠŸèƒ½ï¼ˆå¿…é¡»ä¿®å¤ï¼‰
1. âœ… æ¶ˆæ¯å‘é€æ¥å£å­—æ®µåä¿®å¤
2. âœ… å‰ç«¯å®¹é”™å¤„ç†

### P1 - é‡è¦åŠŸèƒ½ï¼ˆå»ºè®®ä¿®å¤ï¼‰
1. åç«¯ 500 é”™è¯¯æ’æŸ¥
2. ç¼ºå¤±æ¥å£å®ç°

### P2 - æ¬¡è¦åŠŸèƒ½ï¼ˆå¯é€‰ä¿®å¤ï¼‰
1. å·¥ä½œå°ç›¸å…³æ¥å£
2. ç»„ç»‡æ¶æ„æ¥å£

## å››ã€ä¿®å¤è®¡åˆ’

### æ­¥éª¤ 1ï¼šä¿®å¤æ¶ˆæ¯å‘é€æ¥å£å­—æ®µå
- æ–‡ä»¶ï¼š`src/api/im/message.js`
- æ–‡ä»¶ï¼š`src/store/modules/im.js`
- æ–‡ä»¶ï¼š`src/views/ChatPanel.vue`

### æ­¥éª¤ 2ï¼šéªŒè¯æ ¸å¿ƒæ¥å£
- ä¼šè¯åˆ—è¡¨
- è”ç³»äººåˆ—è¡¨
- ç¾¤ç»„åˆ—è¡¨
- æ¶ˆæ¯å‘é€/æ¥æ”¶

### æ­¥éª¤ 3ï¼šæ·»åŠ å‰ç«¯å®¹é”™
- å·²å®Œæˆï¼š`App.vue`
- å¾…å®Œæˆï¼šå…¶ä»–ç»„ä»¶

### æ­¥éª¤ 4ï¼šåç«¯é”™è¯¯æ’æŸ¥
- éœ€è¦æŸ¥çœ‹åç«¯æ—¥å¿—
- æ£€æŸ¥æ•°æ®åº“æ•°æ®
