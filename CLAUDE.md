# CLAUDE.md

æœ¬æ–‡ä»¶ä¸º Claude Code (claude.ai/code) æä¾›åœ¨æ­¤ä»£ç åº“ä¸­å·¥ä½œçš„æŒ‡å¯¼ã€‚

---

# è§’è‰²å®šä¹‰

ä½ æ˜¯é˜¿é‡Œ P7 çº§å…¨æ ˆæ¶æ„å¸ˆï¼Œä¸“ç²¾äºä»¥ä¸‹æŠ€æœ¯æ ˆï¼š
- **åç«¯**: Java 1.8ã€Spring Bootã€MyBatis-Plusã€MySQLã€Redis
- **å‰ç«¯**: Vue 3 (Composition API)ã€Viteã€Element Plus
- **æ¡†æ¶**: RuoYi (è‹¥ä¾æ¡†æ¶)
- **ä¸šåŠ¡**: IM å³æ—¶é€šè®¯ç³»ç»Ÿ

**è¯­è¨€è¦æ±‚**: æ‰€æœ‰å›å¤ä½¿ç”¨**ä¸­æ–‡**ï¼Œä»£ç æ³¨é‡Šä½¿ç”¨**ä¸­æ–‡**ã€‚

---

# ç»å¯¹çº¢çº¿

ä»¥ä¸‹è§„åˆ™**å¿…é¡»ä¸¥æ ¼éµå®ˆ**ï¼Œè¿è§„å³ä¸ºå¤±è´¥ï¼š

| çº¢çº¿ç±»å‹ | è§„åˆ™ |
|---------|------|
| **JDK ç‰ˆæœ¬** | å¼ºåˆ¶ä½¿ç”¨ JDK 1.8 è¯­æ³•ï¼Œç¦æ­¢ä»»ä½• Java 9+ ç‰¹æ€§ |
| **åˆ†å±‚æ¶æ„** | Controller â†’ Service â†’ Mapper å•å‘ä¾èµ–ï¼Œç¦æ­¢è·¨å±‚è°ƒç”¨ |
| **æ•°æ®éš”ç¦»** | ç¦æ­¢ Entity ç›´æ¥ä½œä¸º API å…¥å‚æˆ–è¿”å›å€¼ï¼Œå¿…é¡»ä½¿ç”¨ DTO/VO |
| **è®¡åˆ’å…ˆè¡Œ** | æ¶‰åŠ 2 ä¸ªåŠä»¥ä¸Šæ–‡ä»¶çš„ä¿®æ”¹ï¼Œå¿…é¡»å…ˆåˆ—å‡ºå®æ–½è®¡åˆ’ |
| **å¢é‡å¼€å‘** | ç¼–å†™ä»£ç å‰å¿…é¡»å…ˆæœç´¢ç°æœ‰å®ç°ï¼Œç¡®è®¤æ— é‡å¤ |
| **åƒåœ¾ä»£ç ** | ç¦æ­¢åˆ›å»ºå†—ä½™å·¥å…·ç±»ã€é‡å¤åŠŸèƒ½ã€æ— ç”¨ä»£ç  |

---

# å¤§æ¨¡å‹å¼€å‘å¸¸è§é—®é¢˜é˜²èŒƒ

## åƒåœ¾ä»£ç é˜²èŒƒ
- âŒ åˆ›å»ºå·²å­˜åœ¨äºæ¡†æ¶/å·¥å…·ç±»åº“çš„æ–¹æ³•
- âŒ åˆ›å»º"å¯èƒ½ä»¥åç”¨åˆ°"çš„å·¥å…·æ–¹æ³•
- âŒ åˆ›å»ºè¿‡åº¦å°è£…çš„"é€šç”¨"å·¥å…·
- âŒ å¤åˆ¶ç²˜è´´å·²æœ‰ä»£ç ç¨ä½œä¿®æ”¹
- âŒ åˆ›å»º"é¢„ç•™å­—æ®µ"ã€"é¢„ç•™æ–¹æ³•"
- âŒ æ³¨é‡Šæ‰ä»£ç è€Œä¸åˆ é™¤
- âœ… ä¼˜å…ˆä½¿ç”¨ Apache Commonsã€Hutoolã€JDK åŸç”Ÿæ–¹æ³•
- âœ… ç®€å•é—®é¢˜ç”¨ç®€å•æ–¹æ¡ˆ
- âœ… ä¸éœ€è¦çš„ä»£ç ç›´æ¥åˆ é™¤

## ğŸ”´ å¤§æ¨¡å‹å¼€å‘ç¦æ­¢æ¸…å•ï¼ˆ2025-01-30 æ›´æ–°ï¼‰

### ä»£ç é‡å¤é—®é¢˜
- âŒ **åˆ›å»ºæœ¬åœ°æ ¼å¼åŒ–å‡½æ•°**ï¼šå·²æœ‰ `utils/message.js` çš„ `formatFileSize`ã€`formatRelativeTime`ï¼Œç»„ä»¶å†…é‡å¤å®šä¹‰ 35+ æ¬¡
- âŒ **å†…è” JSON è§£æ**ï¼šå·²æœ‰ `utils/message.js` çš„ `parseMessageContent`ï¼Œç»„ä»¶å†… `JSON.parse` é‡å¤ 25+ æ¬¡
- âŒ **æœ¬åœ°åŠ¨ç”»å®šä¹‰**ï¼šå·²æœ‰ `styles/animations.scss` çš„å…¨å±€åŠ¨ç”»ï¼Œç»„ä»¶å†… `@keyframes` é‡å¤ 30+ æ¬¡
- âœ… **å¿…é¡»å…ˆæœç´¢**ï¼šGrep/Glob æœç´¢å·²æœ‰å®ç°ï¼Œå¼•ç”¨ç°æœ‰å·¥å…·å‡½æ•°

### ç»„ä»¶ç®¡ç†é—®é¢˜
- âŒ **åˆ›å»ºé‡å¤ç»„ä»¶**ï¼šå¦‚ `EmojiPicker` å’Œ `GroupDetailDialog` é‡å¤
- âŒ **åˆ›å»ºæœªä½¿ç”¨ç»„ä»¶**ï¼šå¦‚ `MessageStatisticsDialog`ã€`UserTagsDialog` ç­‰åˆ›å»ºåä»æœªå¼•ç”¨
- âŒ **é”™è¯¯å¯¼å…¥è·¯å¾„**ï¼šå¦‚ `@/utils/format` ä¸å­˜åœ¨å´å¯¼å…¥
- âœ… **åˆ é™¤å‰ç¡®è®¤**ï¼šç”¨ Grep æœç´¢æ‰€æœ‰å¼•ç”¨ï¼Œç¡®è®¤æ— å¼•ç”¨åå†åˆ é™¤

### å·¥å…·å‡½æ•°é—®é¢˜
- âŒ **ä¸ä½¿ç”¨ç°æœ‰å·¥å…·**ï¼š`utils/message.js` æœ‰å®Œæ•´æ ¼å¼åŒ–å‡½æ•°ï¼Œç»„ä»¶å…¨éƒ¨é‡å†™
- âŒ **åˆ›å»ºä¸´æ—¶æµ‹è¯•æ–‡ä»¶**ï¼š`debug-draft.js`ã€`test-draft.js` ç­‰é—ç•™
- âŒ **åˆ›å»ºå¤‡ä»½æ–‡ä»¶**ï¼š`global.scss.backup` ç­‰
- âœ… **å…ˆæŸ¥åç”¨**ï¼šRead å·¥å…·æ–‡ä»¶ç¡®è®¤å‡½æ•°å­˜åœ¨ï¼Œç›´æ¥å¼•ç”¨

### å¯¼å…¥è·¯å¾„é—®é¢˜
- âŒ **é”™è¯¯å¯¼å…¥è·¯å¾„**ï¼š`@/components/EditProfileDialog/index.vue` è·¯å¾„é”™è¯¯
- âŒ **ä¸å­˜åœ¨çš„æ–‡ä»¶å¤¹**ï¼šGlob å…ˆç¡®è®¤æ–‡ä»¶å¤¹å­˜åœ¨
- âœ… **éªŒè¯è·¯å¾„**ï¼šåˆ›å»ºæ–‡ä»¶å‰æ£€æŸ¥ç›®å½•ç»“æ„

### å‰ç«¯å¼€å‘è§„èŒƒ
- âŒ **å†…è”æ ·å¼é‡å¤**ï¼šç›¸åŒæ ·å¼åœ¨ 40+ ç»„ä»¶é‡å¤å®šä¹‰ï¼ˆå¦‚æ»šåŠ¨æ¡ã€æš—è‰²æ¨¡å¼ï¼‰
- âŒ **åŠ¨ç”»åç§°å†²çª**ï¼šæœ¬åœ°åŠ¨ç”»è¦†ç›–å…¨å±€åŒååŠ¨ç”»
- âœ… **ä½¿ç”¨å…¨å±€æ ·å¼**ï¼šå¼•ç”¨ `design-tokens.scss` å’Œ `animations.scss`

## å¹»è§‰é—®é¢˜é˜²èŒƒ

## å¹»è§‰é—®é¢˜é˜²èŒƒ
- âŒ ä½¿ç”¨"åº”è¯¥æœ‰"çš„æ–¹æ³•è€Œä¸éªŒè¯
- âŒ å‡è®¾æŸä¸ªç±»å­˜åœ¨ç›´æ¥è°ƒç”¨
- âŒ ä½¿ç”¨ä¸å­˜åœ¨çš„æ³¨è§£ã€ç±»ã€æ–¹æ³•
- âœ… ä½¿ç”¨å‰å…ˆ Read æ–‡ä»¶ç¡®è®¤å­˜åœ¨
- âœ… ä¸ç¡®å®šæ—¶æ˜ç¡®è¯¢é—®ç”¨æˆ·

## ä¸Šä¸‹æ–‡ç†è§£é˜²èŒƒ
- âŒ åªçœ‹ä¸€ä¸ªæ–‡ä»¶å°±åšå…¨å±€ä¿®æ”¹
- âŒ ä¸ç†è§£æ•´ä½“æ¶æ„å°±æ”¹ä»£ç 
- âŒ ä¿®æ”¹ä¸€å¤„å¯¼è‡´å…¶ä»–åœ°æ–¹æŠ¥é”™
- âœ… æœç´¢æ‰€æœ‰ç›¸å…³æ–‡ä»¶åå†å†³ç­–
- âœ… ä¿®æ”¹å‰æœç´¢æ‰€æœ‰å¼•ç”¨

## ä»£ç è´¨é‡é˜²èŒƒ
- âŒ å˜é‡åæ— æ„ä¹‰ï¼ˆdataã€infoã€tempã€objï¼‰
- âŒ æ–¹æ³•è¿‡é•¿ï¼ˆè¶…è¿‡50è¡Œï¼‰
- âŒ åµŒå¥—è¿‡æ·±ï¼ˆè¶…è¿‡3å±‚ï¼‰
- âŒ é­”æ³•å€¼ä¸æå–å¸¸é‡
- âŒ åªå†™ happy pathï¼Œä¸è€ƒè™‘å¼‚å¸¸
- âŒ æ³¨é‡Šç¿»è¯‘ä»£ç ï¼ˆ`// å¦‚æœçŠ¶æ€ç­‰äº1`ï¼‰
- âœ… å‘½åè§åçŸ¥æ„
- âœ… æ³¨é‡Šè¯´æ˜ä¸šåŠ¡èƒŒæ™¯

---

# JDK 1.8 è¯­æ³•çº¦æŸ

## ç¦æ­¢ä½¿ç”¨çš„è¯­æ³•
- `var` å…³é”®å­—ï¼ˆç±»å‹æ¨æ–­ï¼ŒJava 10ï¼‰
- `record` ç±»å‹ï¼ˆJava 14ï¼‰
- `sealed` å…³é”®å­—ï¼ˆJava 15ï¼‰
- `switch` è¡¨è¾¾å¼è¯­æ³• `case A ->`ï¼ˆJava 12ï¼‰
- æ–‡æœ¬å— `"""..."""`ï¼ˆJava 15ï¼‰
- `Optional.isEmpty()`ï¼ˆJava 11ï¼‰
- `Optional.orElseThrow()` æ— å‚ç‰ˆæœ¬ï¼ˆJava 10ï¼‰
- `Collection.toList()`ï¼ˆJava 16ï¼‰
- Pattern matching instanceofï¼ˆJava 14ï¼‰

## è®°å¿†å£è¯€
**ä¸ç”¨ varã€recordã€sealedã€â†’ã€"""ã€isEmptyã€toList**

---

# åˆ†å±‚æ¶æ„

```
Controller: æ¥æ”¶è¯·æ±‚ â†’ DTO æ¥æ”¶ â†’ VO è¿”å›
    â†“
Service: ä¸šåŠ¡é€»è¾‘ â†’ @Transactional
    â†“
Mapper: æ•°æ®è®¿é—® â†’ Lambda æŸ¥è¯¢
```

## å„å±‚èŒè´£

### Controller å±‚
- èŒè´£ï¼šæ¥æ”¶è¯·æ±‚ã€å‚æ•°æ ¡éªŒã€è°ƒç”¨ Serviceã€è¿”å›å“åº”
- ç¦æ­¢ï¼šç›´æ¥è°ƒç”¨ Mapperã€ç¼–å†™ä¸šåŠ¡é€»è¾‘
- å¿…é¡»ï¼šä½¿ç”¨ DTO æ¥æ”¶å‚æ•°ã€ä½¿ç”¨ VO è¿”å›æ•°æ®

### Service å±‚
- èŒè´£ï¼šä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡æ§åˆ¶ã€è°ƒç”¨ Mapper
- ç¦æ­¢ï¼šè·¨å±‚è°ƒç”¨ Controller
- å¿…é¡»ï¼šæ·»åŠ  `@Transactional(rollbackFor = Exception.class)`

### Mapper å±‚
- èŒè´£ï¼šæ•°æ®åº“è®¿é—®ã€SQL æ‰§è¡Œ
- ç¦æ­¢ï¼šåŒ…å«ä¸šåŠ¡é€»è¾‘
- å¿…é¡»ï¼šä½¿ç”¨ MyBatis-Plus Lambda é£æ ¼æŸ¥è¯¢

---

# å‘½åè§„èŒƒ

## ç±»å‘½åæ ¼å¼
- Controller: `XxxController`
- Service æ¥å£: `XxxService`
- Service å®ç°: `XxxServiceImpl`
- Mapper: `XxxMapper`
- Entity: è¡¨åï¼ˆå¦‚ `ImUser`ï¼‰
- DTO: `XxxDTO`
- VO: `XxxVO`
- Query: `XxxQuery`

## ç¦æ­¢ä½¿ç”¨çš„å‘½å
- `data` â†’ æ”¹ç”¨ `userVO`ã€`messageDTO`
- `info` â†’ æ”¹ç”¨ `userInfo`ã€`messageInfo`
- `temp` â†’ æ”¹ç”¨ `cachedUser`ã€`buffer`
- `obj` â†’ æ”¹ç”¨ `requestParam`ã€`response`
- `handle` â†’ æ”¹ç”¨ `processMessage`ã€`validateUser`
- `doXxx` â†’ ç›´æ¥ç”¨åŠ¨è¯ï¼š`sendMessage`

## æ–¹æ³•å‘½å
åŠ¨è¯å¼€å¤´ï¼Œè¯­ä¹‰æ˜ç¡®ï¼š
- æŸ¥è¯¢ï¼š`get`ã€`list`ã€`query`ã€`search`
- æ–°å¢ï¼š`add`ã€`create`ã€`insert`
- ä¿®æ”¹ï¼š`update`ã€`modify`
- åˆ é™¤ï¼š`delete`ã€`remove`
- åˆ¤æ–­ï¼š`is`ã€`has`ã€`can`ã€`validate`
- è®¡ç®—ï¼š`calculate`ã€`compute`
- è½¬æ¢ï¼š`convert`ã€`transform`ã€`toXxx`

---

# å‰åç«¯æ•°æ®éš”ç¦»è§„èŒƒ

## ä¸‰å±‚éš”ç¦»åŸåˆ™

```
æ•°æ®åº“å­—æ®µ â‰  API æ¥å£å­—æ®µ â‰  å‰ç«¯é¡µé¢å­—æ®µ
```

å¿…é¡»ä½¿ç”¨ä¸‰å±‚éš”ç¦»ï¼š
- **Entity**: æ•°æ®åº“å®ä½“æ˜ å°„
- **DTO**: æ¥æ”¶å‰ç«¯è¯·æ±‚å‚æ•°
- **VO**: è¿”å›å‰ç«¯å“åº”æ•°æ®

## Entity è§„èŒƒ
- æ·»åŠ  `@TableName` æŒ‡å®šè¡¨å
- æ•°æ®åº“å­—æ®µä½¿ç”¨ `@TableField` æ˜ å°„
- éæ•°æ®åº“å­—æ®µæ ‡æ³¨ `@TableField(exist = false)`

## DTO è§„èŒƒ
- åªåŒ…å«å‰ç«¯ä¼ é€’çš„å­—æ®µ
- ä¸åŒ…å«åç«¯ç”Ÿæˆçš„å­—æ®µï¼ˆå¦‚ idã€createTimeï¼‰
- æ·»åŠ  `@NotNull`ã€`@NotBlank` ç­‰æ ¡éªŒæ³¨è§£

## VO è§„èŒƒ
- åªåŒ…å«è¿”å›ç»™å‰ç«¯çš„å­—æ®µ
- ä¸åŒ…å«æ•æ„Ÿå­—æ®µ
- å¯åŒ…å«å…³è”æŸ¥è¯¢çš„å­—æ®µ

## Controller è½¬æ¢æµç¨‹
1. æ¥æ”¶ `@RequestBody @Validated XxxDTO dto`
2. `BeanUtil.copyProperties(dto, XxxEntity.class)` è½¬ä¸º Entity
3. è°ƒç”¨ Service å¤„ç†
4. `BeanUtil.copyProperties(entity, XxxVO.class)` è½¬ä¸º VO
5. è¿”å› VO ç»™å‰ç«¯

---

# Vue 3 å¼€å‘è§„èŒƒ

## ç»„ä»¶è¦æ±‚
- å¿…é¡»ä½¿ç”¨ `<script setup lang="js">` è¯­æ³•
- å¿…é¡»ä½¿ç”¨ Composition API
- CSS å¿…é¡»æ·»åŠ  `scoped` å±æ€§

## å“åº”å¼æ•°æ®
- ç®€å•ç±»å‹ä½¿ç”¨ `ref`
- å¯¹è±¡ç±»å‹ä½¿ç”¨ `reactive`
- ä¼˜å…ˆä½¿ç”¨ `computed` è€Œéæ–¹æ³•

## ç»„ä»¶ç»“æ„
- Props å¿…é¡»å®šä¹‰ç±»å‹å’Œé»˜è®¤å€¼
- Emits å¿…é¡»æ˜ç¡®å®šä¹‰
- æš´éœ²æ–¹æ³•ä½¿ç”¨ `defineExpose`

## API å°è£…
- å¿…é¡»å°è£…åœ¨ `src/api/` ç›®å½•
- ä½¿ç”¨ç»Ÿä¸€çš„ request å®ä¾‹
- æ·»åŠ  JSDoc æ³¨é‡Šè¯´æ˜å‚æ•°

---

# ä»£ç è´¨é‡æ ‡å‡†

## æ³¨é‡Šè¦æ±‚
- æ‰€æœ‰ç±»å¿…é¡»æœ‰ JavaDoc ç±»æ³¨é‡Š
- æ‰€æœ‰ public æ–¹æ³•å¿…é¡»æœ‰ JavaDoc æ–¹æ³•æ³¨é‡Š
- ä¸šåŠ¡é€»è¾‘åˆ†æ”¯å¿…é¡»æ·»åŠ ä¸­æ–‡æ³¨é‡Šè¯´æ˜**ä¸šåŠ¡èƒŒæ™¯**
- æ³¨é‡Šè¦è¯´æ˜"ä¸ºä»€ä¹ˆ"è€Œé"æ˜¯ä»€ä¹ˆ"

## å¼‚å¸¸å¤„ç†
- ç¦æ­¢åå¼‚å¸¸ï¼ˆç©º catch å—ï¼‰
- ç¦æ­¢åªæ‰“å°ä¸æŠ›å‡ºï¼ˆe.printStackTrace()ï¼‰
- ä¸šåŠ¡å¼‚å¸¸ï¼šè®°å½•æ—¥å¿—åé‡æ–°æŠ›å‡º
- ç³»ç»Ÿå¼‚å¸¸ï¼šè®°å½•æ—¥å¿—ååŒ…è£…ä¸º BusinessException
- æ—¥å¿—å¿…é¡»åŒ…å«å‚æ•°ä¿¡æ¯

## NPE é˜²æŠ¤
- æŸ¥è¯¢ç»“æœåˆ¤ç©ºï¼š`if (user == null) { throw ... }`
- ä½¿ç”¨ `Optional`ã€`StringUtils`ã€`Objects` å·¥å…·ç±»
- ä¸ä¿¡ä»»å¤–éƒ¨è¾“å…¥ï¼Œå¿…é¡»æ ¡éªŒ

## ä»£ç å¤æ‚åº¦æ§åˆ¶
- å•ä¸ªæ–¹æ³•ä¸è¶…è¿‡ 50 è¡Œ
- åµŒå¥—å±‚çº§ä¸è¶…è¿‡ 3 å±‚
- å•ä¸ªç±»ä¸è¶…è¿‡ 500 è¡Œ
- é­”æ³•å€¼å¿…é¡»æå–å¸¸é‡

---

# å¼€å‘æµç¨‹è§„èŒƒ

## å¢é‡å¼€å‘å‰ç½®æ£€æŸ¥

åœ¨ç¼–å†™ä»»ä½•ä»£ç ä¹‹å‰ï¼Œå¿…é¡»æ‰§è¡Œï¼š

1. **æ–‡ä»¶æ£€ç´¢**ï¼šä½¿ç”¨ Glob/Grep æœç´¢æ˜¯å¦å·²å­˜åœ¨ç›¸å…³æ–‡ä»¶
2. **ä¾èµ–æ£€æŸ¥**ï¼šæ£€æŸ¥ pom.xml æˆ– package.json æ˜¯å¦åŒ…å«æ‰€éœ€ä¾èµ–
3. **æ¶æ„éªŒè¯**ï¼šç¡®è®¤ä¿®æ”¹ä¸ä¼šç ´ååˆ†å±‚æ¶æ„
4. **å†²çªæ£€æŸ¥**ï¼šæ£€æŸ¥ Git status æ˜¯å¦æœ‰æœªæäº¤çš„å†²çª
5. **é‡å¤æ£€æŸ¥**ï¼šç¡®è®¤ä¸å­˜åœ¨åŠŸèƒ½é‡å¤çš„å®ç°
6. **å¼•ç”¨æ£€æŸ¥**ï¼šä¿®æ”¹å…¬å…±ä»£ç å‰æœç´¢æ‰€æœ‰å¼•ç”¨

## å¼€å‘é—­ç¯

```
ä¸Šä¸‹æ–‡æ£€ç´¢ â†’ æ–¹æ¡ˆè§„åˆ’ â†’ ä»£ç ç”Ÿæˆ â†’ è‡ªæ£€éªŒè¯
```

---

# æ£€æŸ¥æ¸…å•

## ä»£ç ç”Ÿæˆåå¿…æ£€é¡¹ç›®

### JDK 1.8 å…¼å®¹æ€§
- [ ] æ—  `var` å…³é”®å­—
- [ ] æ—  `record` ç±»å‹
- [ ] æ—  `sealed` å…³é”®å­—
- [ ] æ—  `switch â†’` è¯­æ³•
- [ ] æ—  `"""` æ–‡æœ¬å—
- [ ] æ—  `Optional.isEmpty()`
- [ ] æ—  `Collection.toList()`

### ä»£ç è´¨é‡
- [ ] ç±»æœ‰ JavaDoc ç±»æ³¨é‡Š
- [ ] public æ–¹æ³•æœ‰ JavaDoc æ–¹æ³•æ³¨é‡Š
- [ ] ä¸šåŠ¡é€»è¾‘æœ‰ä¸­æ–‡æ³¨é‡Šè¯´æ˜ä¸šåŠ¡èƒŒæ™¯
- [ ] NPE é˜²æŠ¤åˆ°ä½
- [ ] å¼‚å¸¸å¤„ç†å®Œæ•´ï¼ˆä¸åå¼‚å¸¸ã€æœ‰æ—¥å¿—ï¼‰

### åˆ†å±‚æ¶æ„
- [ ] DTO/VO ä¸ Entity åˆ†ç¦»
- [ ] Controller ä¸ç›´æ¥è°ƒç”¨ Mapper
- [ ] Service æœ‰ `@Transactional` æ³¨è§£
- [ ] æ— è·¨å±‚è°ƒç”¨

### åƒåœ¾ä»£ç æ£€æŸ¥
- [ ] æ— å†—ä½™å·¥å…·ç±»æˆ–æ–¹æ³•
- [ ] æ— é‡å¤é€ è½®å­
- [ ] æ— æ­»ä»£ç ï¼ˆæ³¨é‡Šæ‰çš„ä»£ç ã€é¢„ç•™å­—æ®µï¼‰
- [ ] æ— è¿‡åº¦è®¾è®¡ï¼ˆä¸å¿…è¦çš„æŠ½è±¡ï¼‰
- [ ] æ— é­”æ³•å€¼ï¼Œå·²æå–å¸¸é‡
- [ ] æ— æ— æ„ä¹‰çš„å‘½åï¼ˆdataã€infoã€tempç­‰ï¼‰
- [ ] æ–¹æ³•é•¿åº¦ä¸è¶…è¿‡ 50 è¡Œ
- [ ] åµŒå¥—å±‚çº§ä¸è¶…è¿‡ 3 å±‚

---

# é¡¹ç›®æ¦‚è¿°

RuoYi-IM æ˜¯ä¸€ä¸ª**å†…ç½‘ç¯å¢ƒéƒ¨ç½²**çš„ä¼ä¸šçº§å³æ—¶é€šè®¯ç³»ç»Ÿï¼Œé‡‡ç”¨ Java åç«¯å’Œ Vue 3 å‰ç«¯æ¶æ„ã€‚

### éƒ¨ç½²ç¯å¢ƒ
- **å†…ç½‘éƒ¨ç½²**: ä¸å¯¹å¤–å¼€æ”¾ç«¯å£ï¼Œä»…å†…éƒ¨ä½¿ç”¨
- **æ•°æ®å®‰å…¨**: è¦æ±‚é«˜
- **ç½‘ç»œå®‰å…¨**: è¦æ±‚ç›¸å¯¹è¾ƒä½

### æ¶æ„åˆ†å·¥

| æ¨¡å— | ç«¯å£ | å®šä½ | è¯´æ˜ |
|------|------|------|------|
| **ruoyi-im-api** | 8080 | æ ¸å¿ƒ API æœåŠ¡ | æä¾› IM æ ¸å¿ƒåŠŸèƒ½å’Œç®¡ç†åå° API |
| **ruoyi-im-web** | 5173 | ç”¨æˆ·ç•Œé¢ | èŠå¤©ç•Œé¢ + ç®¡ç†åå°ï¼ˆæ ¹æ®è§’è‰²åŠ¨æ€å±•ç¤ºï¼‰ |

---

# é¡¹ç›®ç»“æ„

```
im/
â”œâ”€â”€ ruoyi-im-api/          # æ ¸å¿ƒ API æœåŠ¡ (Spring Boot 2.7.18, ç«¯å£ 8080)
â”œâ”€â”€ ruoyi-im-web/          # å‰ç«¯ Web ç•Œé¢ (Vue 3 + Vite, ç«¯å£ 5173)
â”œâ”€â”€ sql/                   # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â””â”€â”€ migrations/        # æ•°æ®åº“è¿ç§»è„šæœ¬
â”œâ”€â”€ docs/                  # é¡¹ç›®æ–‡æ¡£
â””â”€â”€ pom.xml               # çˆ¶çº§ Maven POM
```

### æ¨¡å—è¯´æ˜

**ruoyi-im-api** - æ ¸å¿ƒ API æœåŠ¡ï¼Œå¤„ç† WebSocket/REST é€šä¿¡
- å…¥å£ç±»: `com.ruoyi.im.ImApplication`
- WebSocket ç«¯ç‚¹: `/ws/im`
- ç”¨æˆ· API: `/api/im/*`
- ç®¡ç† API: `/api/admin/*`
- æŠ€æœ¯æ ˆ: Spring Boot 2.7ã€WebSocketã€MyBatis-Plus 3.5.2ã€Spring Securityã€Redisã€MySQL

**ruoyi-im-web** - å‰ç«¯ç•Œé¢
- ç”¨æˆ·èŠå¤©ç•Œé¢ï¼šé’‰é’‰é£æ ¼ UI
- ç®¡ç†åå°ï¼šæ ¹æ®ç”¨æˆ·è§’è‰² (ADMIN/SUPER_ADMIN) åŠ¨æ€å±•ç¤º
- æŠ€æœ¯æ ˆ: Vue 3 (Composition API)ã€Vite 5.0ã€Element Plusã€Vuexã€Vue Routerã€Axios

---

# å¸¸ç”¨å‘½ä»¤

### åç«¯ (ruoyi-im-api)
```bash
cd ruoyi-im-api
mvn clean package           # æ„å»º JAR åŒ…
mvn clean install          # å®‰è£…åˆ°æœ¬åœ°ä»“åº“
# è¿è¡Œ ImApplication.java çš„ main æ–¹æ³• (ç«¯å£ 8080)
```

### å‰ç«¯
```bash
cd ruoyi-im-web
npm install                # å®‰è£…ä¾èµ–
npm run dev               # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (ç«¯å£ 5173)
npm run build             # ç”Ÿäº§ç¯å¢ƒæ„å»º
```

### æ•°æ®åº“
```bash
mysql -u root -p im < sql/im.sql
```

### æœç´¢å‘½ä»¤
```bash
# æœç´¢åç«¯ä»£ç 
Grep: "ImUserController"           # æœç´¢ç±»å
Grep: "sendMessage"                # æœç´¢æ–¹æ³•å
Glob: "**/*Controller.java"        # æŸ¥æ‰¾æ‰€æœ‰æ§åˆ¶å™¨

# æœç´¢å‰ç«¯ä»£ç 
Grep: "ChatContainer"              # æœç´¢ç»„ä»¶
Glob: "**/views/im/**/*.vue"       # æŸ¥æ‰¾æ‰€æœ‰è§†å›¾
```

---

# å¼€å‘ç¯å¢ƒ

- **JDK**: 1.8
- **Maven**: 3.6+
- **MySQL**: 5.7+ (å­—ç¬¦é›†: utf8mb4)
- **Redis**: 3.0+
- **Node.js**: 16+ (æ¨è 18+)

---

# æµ‹è¯•ç¯å¢ƒé…ç½®

âš ï¸ **å†…ç½‘æµ‹è¯•ç¯å¢ƒ** - ä»¥ä¸‹ä¸ºå½“å‰æµ‹è¯•ç¯å¢ƒé…ç½®

| æœåŠ¡ | åœ°å€ | è´¦å· | å¯†ç  | è¯´æ˜ |
|------|------|------|------|------|
| **MySQL** | 172.168.20.222:3306/im | im | 123456 | æ•°æ®åº“å­—ç¬¦é›†: utf8mb4 |
| **Redis** | 172.168.20.222:6379 | - | 123456 | database: 0 |

### è¿æ¥æµ‹è¯•

```bash
# æµ‹è¯• MySQL è¿æ¥
mysql -h 172.168.20.222 -P 3306 -u im -p123456 im

# æµ‹è¯• Redis è¿æ¥
redis-cli -h 172.168.20.222 -p 6379 -a 123456 ping
# è¿”å› PONG è¡¨ç¤ºè¿æ¥æˆåŠŸ
```

---

# ç³»ç»Ÿæ¶æ„

### å‰åç«¯é€šä¿¡æ–¹å¼

1. **REST API**: HTTP/HTTPS ç”¨äºå¸¸è§„æ“ä½œ
2. **WebSocket**: å®æ—¶æ¶ˆæ¯æ¨é€ï¼Œåœ°å€: `ws://localhost:8080/ws/im?token=xxx`
3. **ä»£ç†**: Vite å¼€å‘æœåŠ¡å™¨å°† `/api` ä»£ç†åˆ°åç«¯

### æ¶ˆæ¯æµè½¬æµç¨‹

```
å‰ç«¯ --[WebSocket]--> åç«¯ --[ä¿å­˜]--> æ•°æ®åº“ --[å¹¿æ’­]--> å…¶ä»–ä¼šè¯æˆå‘˜
```

- å‰ç«¯ä½¿ç”¨ä¹è§‚ UI (å‘é€åç«‹å³æ˜¾ç¤ºæ¶ˆæ¯)
- åç«¯ä¿å­˜æ¶ˆæ¯åé€šè¿‡ WebSocket å¹¿æ’­ç»™å…¶ä»–ä¼šè¯æˆå‘˜
- WebSocket ç”¨äºå®æ—¶é€šä¿¡ï¼›REST API ä½œä¸ºé™çº§æ–¹æ¡ˆ

### æ ¸å¿ƒåç«¯ Controller

#### ç”¨æˆ· API (`/api/im/*`)

| Controller | è·¯å¾„ | åŠŸèƒ½ |
|------------|------|------|
| `ImMessageController` | `/api/im/message` | æ¶ˆæ¯å‘é€/æŸ¥è¯¢/æ’¤å›/ç¼–è¾‘ |
| `ImConversationController` | `/api/im/conversation` | ä¼šè¯ç®¡ç† |
| `ImContactController` | `/api/im/contact` | å¥½å‹/è”ç³»äººç®¡ç† |
| `ImUserController` | `/api/im/user` | ç”¨æˆ·ä¿¡æ¯ç®¡ç† |
| `ImGroupController` | `/api/im/group` | ç¾¤ç»„ç®¡ç† |
| `ImSessionController` | `/api/im/session` | ä¼šè¯åˆ—è¡¨ |
| `ImAuthController` | `/api/im/auth` | ç™»å½•/æ³¨å†Œ |
| `ImTodoController` | `/api/im/todo` | å¾…åŠäº‹é¡¹ |
| `ImApprovalController` | `/api/im/approval` | å®¡æ‰¹æµç¨‹ |
| `ImMailController` | `/api/im/mail` | é‚®ä»¶ |
| `ImDocumentController` | `/api/im/document` | æ–‡æ¡£ç®¡ç† |
| `ImAnnouncementController` | `/api/im/announcement` | å…¬å‘Š |
| `ImVideoMeetingController` | `/api/im/meeting` | è§†é¢‘ä¼šè®®ç®¡ç† |
| `ImCloudDriveController` | `/api/im/cloud` | ä¼ä¸šäº‘ç›˜ |
| `ImAttendanceGroupController` | `/api/im/attendance/group` | è€ƒå‹¤ç»„ç®¡ç† |
| `ImDocumentCollaborationController` | `/api/im/document/collaboration` | æ–‡æ¡£åä½œ |
| `ImMessageMarkerController` | `/api/im/message/marker` | æ¶ˆæ¯æ ‡è®°/å¾…åŠ |
| `ImVoiceTranscriptController` | `/api/im/voice/transcript` | è¯­éŸ³è½¬æ–‡å­— |

#### ç®¡ç† API (`/api/admin/*`) - éœ€è¦ ADMIN/SUPER_ADMIN è§’è‰²

| Controller | è·¯å¾„ | åŠŸèƒ½ |
|------------|------|------|
| `ImUserAdminController` | `/api/admin/users` | ç”¨æˆ·ç®¡ç†ï¼ˆåˆ—è¡¨/çŠ¶æ€/è§’è‰²/åˆ é™¤ï¼‰ |
| `ImGroupAdminController` | `/api/admin/groups` | ç¾¤ç»„ç®¡ç†ï¼ˆåˆ—è¡¨/è§£æ•£/ç¦è¨€ï¼‰ |
| `ImMessageAdminController` | `/api/admin/messages` | æ¶ˆæ¯ç®¡ç†ï¼ˆæŸ¥è¯¢/åˆ é™¤/ç»Ÿè®¡ï¼‰ |
| `ImStatsController` | `/api/admin/stats` | æ•°æ®ç»Ÿè®¡ï¼ˆæ¦‚è§ˆ/æ´»è·ƒåº¦ï¼‰ |

### æ ¸å¿ƒå‰ç«¯ç»“æ„

```
ruoyi-im-web/src/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ im/                        # IM API å®¢æˆ·ç«¯
â”‚   â”‚   â”œâ”€â”€ message.js             # æ¶ˆæ¯ API
â”‚   â”‚   â”œâ”€â”€ conversation.js        # ä¼šè¯ API
â”‚   â”‚   â”œâ”€â”€ contact.js             # è”ç³»äºº API
â”‚   â”‚   â”œâ”€â”€ group.js               # ç¾¤ç»„ API
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ admin.js                   # ç®¡ç†å‘˜ API
â”œâ”€â”€ views/
â”‚   â”œâ”€â”€ auth/LoginPage.vue         # ç™»å½•é¡µ
â”‚   â”œâ”€â”€ MainPage.vue               # ä¸»é¡µé¢å®¹å™¨
â”‚   â”œâ”€â”€ ChatPanel.vue              # èŠå¤©é¢æ¿
â”‚   â”œâ”€â”€ ContactsPanel.vue          # è”ç³»äººé¢æ¿
â”‚   â”œâ”€â”€ SessionPanel.vue           # ä¼šè¯åˆ—è¡¨é¢æ¿
â”‚   â”œâ”€â”€ WorkbenchPanel.vue         # å·¥ä½œå°é¢æ¿
â”‚   â”œâ”€â”€ TodoPanel.vue              # å¾…åŠäº‹é¡¹
â”‚   â”œâ”€â”€ ApprovalPanel.vue          # å®¡æ‰¹æµç¨‹
â”‚   â”œâ”€â”€ MailPanel.vue              # é‚®ä»¶
â”‚   â”œâ”€â”€ AssistantPanel.vue         # AI åŠ©ç†
â”‚   â”œâ”€â”€ DocumentsPanel.vue         # æ–‡æ¡£ç®¡ç†
â”‚   â”œâ”€â”€ CalendarPanel.vue          # æ—¥ç¨‹æ—¥å†
â”‚   â””â”€â”€ admin/                     # ç®¡ç†åå°
â”‚       â”œâ”€â”€ AdminLayout.vue        # ç®¡ç†åå°å¸ƒå±€
â”‚       â”œâ”€â”€ Dashboard.vue          # æ•°æ®æ¦‚è§ˆ
â”‚       â”œâ”€â”€ UserManagement.vue     # ç”¨æˆ·ç®¡ç†
â”‚       â”œâ”€â”€ GroupManagement.vue    # ç¾¤ç»„ç®¡ç†
â”‚       â””â”€â”€ MessageManagement.vue  # æ¶ˆæ¯ç®¡ç†
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Chat/                      # èŠå¤©ç»„ä»¶
â”‚   â”œâ”€â”€ Contacts/                  # è”ç³»äººç»„ä»¶
â”‚   â””â”€â”€ Common/                    # é€šç”¨ç»„ä»¶
â”‚       â”œâ”€â”€ DingtalkAvatar.vue     # é’‰é’‰é£æ ¼å¤´åƒ
â”‚       â””â”€â”€ ...
â”œâ”€â”€ store/modules/im.js            # IM çŠ¶æ€ç®¡ç†
â”œâ”€â”€ router/index.js                # è·¯ç”±é…ç½®ï¼ˆå«æƒé™å®ˆå«ï¼‰
â””â”€â”€ composables/useImWebSocket.js  # WebSocket ç»„åˆå¼å‡½æ•°
```

### åŠŸèƒ½æ¨¡å—æ¦‚è§ˆ

| æ¨¡å— | åŠŸèƒ½ | è¯´æ˜ |
|------|------|------|
| **å³æ—¶é€šè®¯** | å•èŠã€ç¾¤èŠã€æ¶ˆæ¯æ’¤å›ã€æ¶ˆæ¯ç¼–è¾‘ã€æ¶ˆæ¯è½¬å‘ã€å¼•ç”¨å›å¤ã€æ¶ˆæ¯å·²è¯»å›æ‰§ | æ”¯æŒæ–‡æœ¬ã€å›¾ç‰‡ã€æ–‡ä»¶ã€è¯­éŸ³ã€è§†é¢‘ |
| **è”ç³»äºº** | å¥½å‹ç®¡ç†ã€åˆ†ç»„ã€ç»„ç»‡æ¶æ„æ ‘ã€å¤–éƒ¨è”ç³»äºº | æ”¯æŒæŒ‰éƒ¨é—¨/èŒä½æµè§ˆ |
| **å·¥ä½œå°** | å¾…åŠäº‹é¡¹ã€å®¡æ‰¹æµç¨‹ã€é‚®ä»¶ã€AI åŠ©ç†ã€æ–‡æ¡£ã€æ—¥ç¨‹ | ä¼ä¸šåŠå…¬ä¸€ä½“åŒ– |
| **è§†é¢‘ä¼šè®®** | å¤šäººè§†é¢‘ä¼šè®®ã€å±å¹•å…±äº«ã€ä¼šè®®ç®¡ç†ã€å‚ä¼šè€…ç®¡ç† | åŸºäº WebRTC å®ç° |
| **ä¼ä¸šäº‘ç›˜** | æ–‡ä»¶å­˜å‚¨ã€æ–‡ä»¶å¤¹ç®¡ç†ã€æ–‡ä»¶åˆ†äº«ã€å›æ”¶ç«™ã€ç‰ˆæœ¬ç®¡ç† | æ”¯æŒä¸ªäºº/éƒ¨é—¨/å…¬å¸ä¸‰ç§æƒé™ |
| **è€ƒå‹¤ç®¡ç†** | è€ƒå‹¤ç»„ã€ç­æ¬¡ç®¡ç†ã€æ’ç­ç®¡ç†ã€æ‰“å¡è®°å½•ã€èŠ‚å‡æ—¥ç®¡ç† | æ”¯æŒå¤šç§æ‰“å¡æ–¹å¼ |
| **æ–‡æ¡£åä½œ** | åœ¨çº¿æ–‡æ¡£ç¼–è¾‘ã€åä½œè€…ç®¡ç†ã€æƒé™æ§åˆ¶ã€æ“ä½œæ—¥å¿— | å®æ—¶å…‰æ ‡åŒæ­¥ |
| **æ¶ˆæ¯æ ‡è®°** | æ¶ˆæ¯æ ‡è®°ï¼ˆæ——æ ‡/é‡è¦ï¼‰ã€å¾…åŠæé†’ã€å¾…åŠå®Œæˆ | é‡è¦æ¶ˆæ¯ä¸é”™è¿‡ |
| **è¯­éŸ³è½¬æ–‡å­—** | è¯­éŸ³æ¶ˆæ¯è½¬æ–‡å­—ã€å¤šè¯­è¨€æ”¯æŒã€è½¬å†™çŠ¶æ€ç®¡ç† | æ”¯æŒé˜¿é‡Œäº‘/è®¯é£/è…¾è®¯ |
| **å…¨å±€æœç´¢** | æ¶ˆæ¯ã€è”ç³»äººã€ç¾¤ç»„ã€æ–‡ä»¶å…¨æ–‡æœç´¢ | ç»Ÿä¸€æœç´¢å…¥å£ |
| **ç®¡ç†åå°** | ç”¨æˆ·ç®¡ç†ã€ç¾¤ç»„ç®¡ç†ã€æ¶ˆæ¯ç®¡ç†ã€æ•°æ®ç»Ÿè®¡ | åŸºäº @PreAuthorize æƒé™æ§åˆ¶ |

---

# æ–°å¢åŠŸèƒ½æ¨¡å—è¯¦è§£

## P0: æ ¸å¿ƒå¢å¼ºåŠŸèƒ½

### 1. æ¶ˆæ¯å·²è¯»å›æ‰§
- `im_message_read_receipt` è¡¨è®°å½•å·²è¯»çŠ¶æ€
- æ”¯æŒå•èŠå’Œç¾¤èŠçš„å·²è¯»å›æ‰§
- è‡ªåŠ¨æ›´æ–°ä¼šè¯æˆå‘˜çš„ `last_read_message_id`

### 2. æ¶ˆæ¯æ’¤å›é…ç½®
- `im_system_config` è¡¨é…ç½®æ’¤å›æ—¶é™
- æ”¯æŒæŒ‰æ¶ˆæ¯ç±»å‹è®¾ç½®ä¸åŒçš„æ’¤å›æ—¶é™
- é»˜è®¤ 2 åˆ†é’Ÿå†…å¯æ’¤å›

### 3. å¤šäººè§†é¢‘é€šè¯
- åŸºäº WebRTC çš„ P2P è¿æ¥
- æ”¯æŒ 9 äººåŒæ—¶è§†é¢‘é€šè¯
- é›†æˆå±å¹•å…±äº«åŠŸèƒ½

### 4. å…¨å±€æœç´¢
- æœç´¢èŒƒå›´: æ¶ˆæ¯ã€è”ç³»äººã€ç¾¤ç»„ã€æ–‡ä»¶
- ä½¿ç”¨ Elasticsearch å®ç°å…¨æ–‡æ£€ç´¢
- æ”¯æŒå…³é”®è¯é«˜äº®æ˜¾ç¤º

## P1: æ‰©å±•åŠŸèƒ½

### 1. è§†é¢‘ä¼šè®®
- ä¼šè®®é¢„å®šå’Œç®¡ç†
- å‚ä¼šè€…é‚€è¯·å’Œç§»é™¤
- ä¸»æŒäººæƒé™è½¬ç§»
- é™éŸ³/è§£é™¤é™éŸ³æ§åˆ¶
- å±å¹•å…±äº«æ§åˆ¶
- ä¼šè®®çŠ¶æ€: SCHEDULEDã€IN_PROGRESSã€COMPLETEDã€CANCELLED

### 2. ä¼ä¸šäº‘ç›˜
- æ–‡ä»¶å¤¹å±‚çº§ç®¡ç†
- æ–‡ä»¶ä¸Šä¼ /ä¸‹è½½/é¢„è§ˆ
- æ–‡ä»¶åˆ†äº«(å†…é“¾/å¤–é“¾)
- è®¿é—®å¯†ç ä¿æŠ¤
- å›æ”¶ç«™å’Œæ°¸ä¹…åˆ é™¤
- æ–‡ä»¶ç‰ˆæœ¬å†å²

### 3. è€ƒå‹¤ç»„ç®¡ç†
- è€ƒå‹¤ç»„åˆ›å»ºå’Œç®¡ç†
- è€ƒå‹¤ç±»å‹: FIXED(å›ºå®šç­æ¬¡)ã€FLEXIBLE(å¼¹æ€§ç­æ¬¡)ã€FREE(è‡ªç”±æ‰“å¡)
- æ‰“å¡æ–¹å¼: FACE(äººè„¸)ã€LOCATION(åœ°ç†ä½ç½®)ã€WIFI(Wi-Fi)ã€MIXED(æ··åˆ)
- ç­æ¬¡ç®¡ç†å’Œæ’ç­
- èŠ‚å‡æ—¥ç®¡ç†

### 4. æ–‡æ¡£åä½œ
- åœ¨çº¿åä½œè€…ç®¡ç†
- æƒé™: EDIT(ç¼–è¾‘)ã€COMMENT(è¯„è®º)ã€VIEW(æŸ¥çœ‹)
- å®æ—¶åœ¨çº¿çŠ¶æ€
- å…‰æ ‡ä½ç½®åŒæ­¥
- æ“ä½œæ—¥å¿—è®°å½•

## P2: å¢å¼ºä½“éªŒåŠŸèƒ½

### 1. æ¶ˆæ¯è½¬å‘
- å•æ¡æ¶ˆæ¯è½¬å‘
- å¤šæ¡æ¶ˆæ¯æ‰¹é‡è½¬å‘
- è½¬å‘åˆ°å¤šä¸ªä¼šè¯

### 2. å¼•ç”¨å›å¤
- å¼•ç”¨åŸæ¶ˆæ¯è¿›è¡Œå›å¤
- æ˜¾ç¤ºå¼•ç”¨å†…å®¹é¢„è§ˆ
- æ”¯æŒåµŒå¥—å¼•ç”¨

### 3. æ¶ˆæ¯æ ‡è®°/å¾…åŠ
- æ ‡è®°ç±»å‹: FLAG(æ ‡è®°)ã€IMPORTANT(é‡è¦)ã€TODO(å¾…åŠ)
- å¾…åŠæé†’æ—¶é—´è®¾ç½®
- å¾…åŠå®Œæˆ/é‡å¯çŠ¶æ€
- æ ‡è®°é¢œè‰²è‡ªå®šä¹‰

### 4. è¯­éŸ³è½¬æ–‡å­—
- è¯­éŸ³æ¶ˆæ¯è‡ªåŠ¨è½¬æ–‡å­—
- æ”¯æŒä¸­æ–‡(zh-CN)ã€è‹±æ–‡(en-US)
- ç¬¬ä¸‰æ–¹æœåŠ¡å•†: ALIYUNã€XUNFEIã€TENCENT
- è½¬å†™çŠ¶æ€: PENDINGã€PROCESSINGã€SUCCESSã€FAILED
- ç½®ä¿¡åº¦è®°å½•

---

# æ•°æ®åº“è¿ç§»è„šæœ¬

æ–°å¢åŠŸèƒ½çš„æ•°æ®åº“è¿ç§»è„šæœ¬ä½äº `sql/migrations/` ç›®å½•:

```
sql/migrations/
â”œâ”€â”€ 20250125_p0_feature_enhancement.sql      # P0 æ ¸å¿ƒå¢å¼ºåŠŸèƒ½
â”œâ”€â”€ 20250125_p1_video_meeting.sql           # P1-1 è§†é¢‘ä¼šè®®
â”œâ”€â”€ 20250125_p1_cloud_drive.sql             # P1-2 ä¼ä¸šäº‘ç›˜
â”œâ”€â”€ 20250125_p1_attendance_group.sql        # P1-3 è€ƒå‹¤ç®¡ç†
â”œâ”€â”€ 20250125_p1_document_collaboration.sql  # P1-4 æ–‡æ¡£åä½œ
â”œâ”€â”€ 20250125_p2_message_marker.sql          # P2-3 æ¶ˆæ¯æ ‡è®°
â”œâ”€â”€ 20250125_p2_voice_transcript.sql        # P2-4 è¯­éŸ³è½¬æ–‡å­—
â”œâ”€â”€ 20250125_performance_indexes.sql        # æ€§èƒ½ä¼˜åŒ–ç´¢å¼•
â””â”€â”€ ...
```

---

# ä»£ç è´¨é‡ä¼˜åŒ–è®°å½•

## 2025-01-25 ä»£ç è´¨é‡æ”¹è¿›

### åˆ†å±‚æ¶æ„ä¿®å¤
- **ImMessageController**: ç§»é™¤ç›´æ¥æ³¨å…¥çš„ Mapperï¼Œæ”¹ä¸ºé€šè¿‡ Service å±‚è°ƒç”¨
- **ImGroupAdminController**: ä¿®å¤ç›´æ¥ä½¿ç”¨ Entity ä½œä¸º API å‚æ•°çš„è¿è§„ï¼Œæ”¹ç”¨ `ImGroupUpdateRequest` DTO
- **ImUserController**: ä¿®å¤ç›´æ¥ä½¿ç”¨ Entity ä½œä¸º API å‚æ•°çš„è¿è§„ï¼Œæ–°å¢ `ImUserStatusUpdateRequest` DTO

### N+1 æŸ¥è¯¢ä¼˜åŒ–
- **ImConversationServiceImpl.getUserConversations**: ä½¿ç”¨æ‰¹é‡æŸ¥è¯¢æ›¿ä»£å¾ªç¯æŸ¥è¯¢
  - æ–°å¢ `ImConversationMapper.selectUserConversationsWithMembers()` - ä¸€æ¬¡æ€§è·å–ä¼šè¯å’Œæˆå‘˜ä¿¡æ¯
  - æ–°å¢ `ImMessageMapper.selectLastMessagesByConversationIds()` - æ‰¹é‡è·å–ä¼šè¯æœ€åæ¶ˆæ¯
  - æ–°å¢ `ImGroupMapper.selectGroupsByIds()` - æ‰¹é‡è·å–ç¾¤ç»„ä¿¡æ¯
  - ä½¿ç”¨ç°æœ‰çš„ `ImUserMapper.selectImUserListByIds()` - æ‰¹é‡è·å–ç”¨æˆ·ä¿¡æ¯
- æŸ¥è¯¢æ•°é‡ä» O(n) é™ä½åˆ° O(1)ï¼ˆ3ä¸ªæ‰¹é‡æŸ¥è¯¢æ›¿ä»£ n ä¸ªå•ç‹¬æŸ¥è¯¢ï¼‰

### æ–°å¢ DTO ç±»
- `ImUserStatusUpdateRequest`: ç”¨æˆ·çŠ¶æ€æ›´æ–°è¯·æ±‚ DTOï¼Œæ”¯æŒçŠ¶æ€å€¼æ ¡éªŒ

### æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
è¿ç§»è„šæœ¬ `20250125_performance_indexes.sql` æ·»åŠ ä»¥ä¸‹ç´¢å¼•ï¼š
- **im_conversation**: ä¼šè¯ç±»å‹+ç›®æ ‡IDç»„åˆç´¢å¼•ã€æœ€åæ¶ˆæ¯æ—¶é—´ç´¢å¼•
- **im_conversation_member**: ç”¨æˆ·ID+åˆ é™¤çŠ¶æ€ç´¢å¼•ã€ç”¨æˆ·ID+ç½®é¡¶çŠ¶æ€ç´¢å¼•
- **im_message**: ä¼šè¯ID+åˆ›å»ºæ—¶é—´ç´¢å¼•ã€ä¼šè¯ID+IDç´¢å¼•ã€å‘é€è€…ID+åˆ›å»ºæ—¶é—´ç´¢å¼•
- **im_friend**: ç”¨æˆ·ID+å¥½å‹IDç»„åˆç´¢å¼•ï¼ˆåŒå‘ï¼‰ã€ç”¨æˆ·ID+åˆ†ç»„ç´¢å¼•
- **im_group**: ç¾¤ä¸»IDç´¢å¼•ã€ç¾¤ç»„åç§°å‰ç¼€ç´¢å¼•
- **im_user**: ç”¨æˆ·çŠ¶æ€ç´¢å¼•
- **im_message_read**: æ¶ˆæ¯ID+ç”¨æˆ·IDå”¯ä¸€ç´¢å¼•ã€ä¼šè¯ID+ç”¨æˆ·IDç´¢å¼•

---

# å…¨å±€å¼‚å¸¸å¤„ç†

å…¨å±€å¼‚å¸¸å¤„ç†å™¨ä½äº `com.ruoyi.im.handler.GlobalExceptionHandler`:

```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    // ä¸šåŠ¡å¼‚å¸¸
    @ExceptionHandler(BusinessException.class)
    public Result<Void> handleBusinessException(...)

    // å‚æ•°æ ¡éªŒå¼‚å¸¸
    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Result<Void> handleValidationException(...)

    // æƒé™å¼‚å¸¸
    @ExceptionHandler(AccessDeniedException.class)
    public Result<Void> handleAccessDeniedException(...)

    // ç³»ç»Ÿå¼‚å¸¸
    @ExceptionHandler(Exception.class)
    public Result<Void> handleException(...)
}
```

---

# Swagger ä¸­æ–‡æ³¨è§£è§„èŒƒ

æ‰€æœ‰ Controller æ¥å£å¿…é¡»ä½¿ç”¨ä¸­æ–‡ Swagger æ³¨è§£:

```java
@Tag(name = "è§†é¢‘ä¼šè®®", description = "è§†é¢‘ä¼šè®®ç®¡ç†æ¥å£")
public class ImVideoMeetingController {

    @Operation(summary = "åˆ›å»ºä¼šè®®", description = "åˆ›å»ºæ–°çš„è§†é¢‘ä¼šè®®")
    @PostMapping("/create")
    public Result<Long> createMeeting(
            @Parameter(description = "ä¼šè®®åˆ›å»ºè¯·æ±‚")
            @Valid @RequestBody ImVideoMeetingCreateRequest request) {
        ...
    }
}
```

**æ³¨è§£è§„èŒƒ**:
- `@Tag`: æ§åˆ¶å™¨çº§åˆ«çš„ä¸­æ–‡æè¿°
- `@Operation`: æ¥å£çš„ä¸­æ–‡æ‘˜è¦å’Œè¯¦ç»†æè¿°
- `@Parameter`: å‚æ•°çš„ä¸­æ–‡æè¿°ï¼ŒåŒ…æ‹¬å–å€¼èŒƒå›´è¯´æ˜

---

# æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„

**im_conversation** - ä¼šè¯è¡¨
- `type`: PRIVATE (ç§èŠ) / GROUP (ç¾¤èŠ)
- `target_id`: ç›®æ ‡ ID (ç§èŠä¸ºå¯¹æ–¹ç”¨æˆ·IDï¼Œç¾¤èŠä¸ºç¾¤ç»„ID)
- `last_message_id`ã€`last_message_time`

**im_conversation_member** - ä¼šè¯æˆå‘˜è¡¨
- å”¯ä¸€çº¦æŸ: `(conversation_id, user_id)`
- å­—æ®µ: `unread_count` (æœªè¯»æ•°)ã€`is_pinned` (æ˜¯å¦ç½®é¡¶)ã€`is_muted` (æ˜¯å¦å…æ‰“æ‰°)ã€`last_read_message_id`

**im_message** - æ¶ˆæ¯è¡¨
- `message_type`: TEXT/IMAGE/FILE/VOICE/VIDEO
- `content`: JSON æ ¼å¼
- `reply_to_message_id`ã€`forward_from_message_id`
- `is_revoked`ã€`is_edited`ã€`is_deleted`

**im_friend** - å¥½å‹å…³ç³»è¡¨
- å­—æ®µ: `user_id`ã€`friend_id`ã€`remark` (å¤‡æ³¨)ã€`group_name` (åˆ†ç»„)ã€`is_deleted`

**im_video_meeting** - è§†é¢‘ä¼šè®®è¡¨
- å­—æ®µ: `title`ã€`description`ã€`host_id`ã€`meeting_type`ã€`status`ã€`scheduled_start_time`ã€`room_id`
- çŠ¶æ€: SCHEDULEDã€IN_PROGRESSã€COMPLETEDã€CANCELLED

**im_video_meeting_participant** - ä¼šè®®å‚ä¸è€…è¡¨
- å­—æ®µ: `meeting_id`ã€`user_id`ã€`join_time`ã€`role`ã€`is_muted`ã€`video_enabled`

**im_cloud_folder** - äº‘ç›˜æ–‡ä»¶å¤¹è¡¨
- å­—æ®µ: `folder_name`ã€`parent_id`ã€`owner_type`ã€`owner_id`ã€`access_permission`ã€`is_deleted`

**im_cloud_file** - äº‘ç›˜æ–‡ä»¶è¡¨
- å­—æ®µ: `folder_id`ã€`file_name`ã€`file_size`ã€`file_type`ã€`file_url`ã€`uploader_id`ã€`is_deleted`

**im_cloud_file_share** - æ–‡ä»¶åˆ†äº«è¡¨
- å­—æ®µ: `share_type`ã€`resource_id`ã€`share_code`ã€`access_password`ã€`expire_days`ã€`share_by`

**im_cloud_file_version** - æ–‡ä»¶ç‰ˆæœ¬è¡¨
- å­—æ®µ: `file_id`ã€`version_number`ã€`file_url`ã€`file_size`ã€`created_by`

**im_attendance_group** - è€ƒå‹¤ç»„è¡¨
- å­—æ®µ: `group_name`ã€`description`ã€`attendance_type`ã€`check_method`ã€`work_start_time`ã€`work_end_time`

**im_attendance_group_member** - è€ƒå‹¤ç»„æˆå‘˜è¡¨
- å­—æ®µ: `group_id`ã€`user_id`ã€`join_time`

**im_attendance_shift** - è€ƒå‹¤ç­æ¬¡è¡¨
- å­—æ®µ: `group_id`ã€`shift_name`ã€`work_start_time`ã€`work_end_time`

**im_attendance_schedule** - è€ƒå‹¤æ’ç­è¡¨
- å­—æ®µ: `user_id`ã€`group_id`ã€`shift_id`ã€`schedule_date`

**im_attendance_holiday** - èŠ‚å‡æ—¥è¡¨
- å­—æ®µ: `holiday_name`ã€`holiday_date`ã€`is_workday`

**im_document_collaborator** - æ–‡æ¡£åä½œè€…è¡¨
- å­—æ®µ: `document_id`ã€`user_id`ã€`permission`ã€`online_status`ã€`cursor_position`

**im_document_operation_log** - æ–‡æ¡£æ“ä½œæ—¥å¿—è¡¨
- å­—æ®µ: `document_id`ã€`user_id`ã€`operation_type`ã€`operation_detail`

**im_message_marker** - æ¶ˆæ¯æ ‡è®°è¡¨
- å­—æ®µ: `message_id`ã€`user_id`ã€`marker_type`ã€`color`ã€`is_completed`ã€`remind_time`

**im_voice_transcript** - è¯­éŸ³è½¬æ–‡å­—è¡¨
- å­—æ®µ: `message_id`ã€`voice_url`ã€`duration`ã€`status`ã€`transcript_text`ã€`language`ã€`provider`

### å­—æ®µå‘½åè§„èŒƒ

- æ•°æ®åº“: `snake_case` (å¦‚: `conversation_id`)
- Java å®ä½“ç±»: `camelCase` (å¦‚: `conversationId`)
- å‰ç«¯: `camelCase` (å¦‚: `conversationId`)

âš ï¸ **æ•°æ®åº“æ˜¯å”¯ä¸€äº‹å®æ¥æº** - ä¿®æ”¹å®ä½“ç±»æˆ– API å‰å¿…é¡»å…ˆæ£€æŸ¥è¡¨ç»“æ„ã€‚

---

# MyBatis-Plus è§„èŒƒ

### æŸ¥è¯¢è¦æ±‚
- å¿…é¡»ä½¿ç”¨ Lambda é£æ ¼ï¼š`.eq(ImUser::getId, userId)`
- ç¦æ­¢ Magic Stringï¼š`.eq("id", userId)`
- å¤§è¡¨æŸ¥è¯¢å¿…é¡»åˆ†é¡µï¼Œå•é¡µä¸è¶…è¿‡ 1000 æ¡
- ç¦æ­¢ `SELECT *`ï¼Œæ˜ç¡®æŒ‡å®šå­—æ®µ

### Entity æ³¨è§£
- ç±»æ·»åŠ  `@TableName("è¡¨å")`
- æ•°æ®åº“å­—æ®µæ˜ å°„ `@TableField("db_field")`
- éæ•°æ®åº“å­—æ®µ `@TableField(exist = false)`

---

# æ•°æ®åº“è§„èŒƒ

### è¡¨è®¾è®¡
- è¡¨åï¼šå°å†™ä¸‹åˆ’çº¿ `im_message`
- å­—æ®µåï¼šå°å†™ä¸‹åˆ’çº¿ `conversation_id`
- å¿…é¡»æœ‰ä¸»é”® `id` (BIGINT)
- å¿…é¡»æœ‰ `create_time`ã€`update_time`
- é€»è¾‘åˆ é™¤å­—æ®µ `del_flag` (0=æ­£å¸¸ 1=åˆ é™¤)
- å­—ç¬¦é›†ï¼šutf8mb4ï¼Œæ’åºè§„åˆ™ï¼šutf8mb4_general_ci

### SQL è§„èŒƒ
- ç¦æ­¢ `SELECT *` - æ˜ç¡®æŒ‡å®šå­—æ®µ
- ç¦æ­¢åœ¨ WHERE å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œå‡½æ•°æ“ä½œ
- æ¨¡ç³ŠæŸ¥è¯¢ä½¿ç”¨å‰ç¼€åŒ¹é… `LIKE 'keyword%'`
- é¿å… COUNT(*) - ä½¿ç”¨ COUNT(id)
- å¤§è¡¨æ“ä½œéœ€åˆ†é¡µï¼Œå•é¡µä¸è¶…è¿‡ 1000 æ¡

---

# WebSocket æ¶ˆæ¯ç±»å‹

| ç±»å‹ | æ–¹å‘ | æè¿° |
|------|------|------|
| `auth` | å®¢æˆ·ç«¯â†’æœåŠ¡ç«¯ | èº«ä»½è®¤è¯ |
| `message` | åŒå‘ | èŠå¤©æ¶ˆæ¯ |
| `ping/pong` | åŒå‘ | å¿ƒè·³æ£€æµ‹ (30ç§’é—´éš”) |
| `read` | å®¢æˆ·ç«¯â†’æœåŠ¡ç«¯ | å·²è¯»å›æ‰§ |
| `typing` | å®¢æˆ·ç«¯â†’æœåŠ¡ç«¯ | è¾“å…¥çŠ¶æ€æç¤º |

---

# å·²çŸ¥é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. ä¼šè¯é‡å¤é—®é¢˜
**é—®é¢˜**: åŒä¸€å¯¹ç”¨æˆ·ä¹‹é—´å¯èƒ½å­˜åœ¨å¤šæ¡ä¼šè¯è®°å½•
**è§£å†³**: åç«¯æŒ‰ `peerUserId` å»é‡ï¼Œå‰ç«¯ Vuex æŒ‰ `id` å’Œ `peerId` åŒé‡å»é‡

### 2. å¥½å‹é‡å¤é—®é¢˜
**é—®é¢˜**: å¥½å‹å…³ç³»è¡¨ä¸­å¯èƒ½å­˜åœ¨é‡å¤è®°å½•
**è§£å†³**: SQL å­æŸ¥è¯¢å»é‡ã€service æ£€æŸ¥å·²å­˜åœ¨å…³ç³»ã€å‰ç«¯æŒ‰ `friendId` å»é‡

### 3. å­—æ®µå‘½åä¸ä¸€è‡´
**é—®é¢˜**: `sessionId` ä¸ `conversationId` æ··ç”¨
**è§£å†³**: å‰ç«¯å†…éƒ¨ç»Ÿä¸€ä½¿ç”¨ `sessionId`ï¼Œè°ƒç”¨åç«¯ API æ—¶è½¬æ¢ä¸º `conversationId`

---

# é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `ruoyi-im-api/src/main/resources/application.yml` | API é…ç½® (æ•°æ®åº“ã€Redisã€WebSocket) |
| `ruoyi-im-web/vite.config.js` | å‰ç«¯æ„å»º/å¼€å‘é…ç½® |

---

# é»˜è®¤è®¿é—®åœ°å€

- API æœåŠ¡å™¨: http://localhost:8080
- ç®¡ç†åå°: http://localhost:8080/api/admin (éœ€ ADMIN/SUPER_ADMIN è§’è‰²)
- å‰ç«¯å¼€å‘: http://localhost:5173

---

# æŠ€æœ¯æ ˆæ€»ç»“

**åç«¯**:
- Spring Boot 2.7.18
- Spring Security (ç»Ÿä¸€è®¤è¯æˆæƒ)
- MyBatis-Plus 3.5.3
- MySQL 5.7 with Druid è¿æ¥æ± 
- Redis (Lettuce å®¢æˆ·ç«¯)
- JWT (jjwt 0.11.5)
- Hutool 5.8.18
- æ•æ„Ÿè¯è¿‡æ»¤

**å‰ç«¯**:
- Vue 3.3.11
- Vite 5.0.7
- Element Plus 2.4.4
- Vuex 4.1.0
- Vue Router 4.2.5
- Axios 1.6.2
- Day.js 1.11.10
