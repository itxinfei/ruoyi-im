---
stepsCompleted: [1, 2, 3, 4, 5, 6, 7]
inputDocuments: []
session_topic: 'RuoYi-IM 前端完美复刻钉钉 DingTalk'
session_goals: 'UI/UX 完全一致 + 业务逻辑完全一致，覆盖全部模块（聊天、联系人、工作台、消息、我的），核心聊天功能必须与钉钉一致'
selected_approach: 'ai-recommended'
techniques_used: ['Trait Transfer', 'Morphological Analysis', 'Mind Mapping', 'Feature Breakdown']
ideas_generated: ['左侧导航栏72px调整', '消息列表分组管理', '草稿标识功能', '快捷指令/入口', '截图功能Ctrl+Alt+A', '工作台Bento Grid布局', '组织架构树+A-Z索引', 'AI灵动回复', 'AI表情表态', '消息速读', '截图标注工具(箭头/方框/画笔/文字/马赛克)', '桌面贴图功能', '撤销/重做', '自定义颜色', 'OCR文字识别', '滚动截图拼接']
context_file: ''
research_completed: true
technique_execution_complete: true
implementation_complete: true
last_update: '2026-01-29'
exploring_phase: 'P2 AI Features'
completed_modules:
  - 左侧导航栏72px
  - 消息列表分组管理
  - 草稿标识功能
  - 快捷指令入口
  - 截图功能增强(全部P0/P1/P2)
  - 通讯录布局优化
  - 工作台Bento Grid布局
---

# Brainstorming Session Results

**Facilitator:** Itxinfei
**Date:** 2026-01-28

---

## Session Overview

**Topic:** RuoYi-IM 前端完美复刻钉钉 DingTalk

**Goals:** UI/UX 完全一致 + 业务逻辑完全一致，覆盖全部模块（聊天、联系人、工作台、消息、我的），核心聊天功能必须与钉钉一致

### Scope Definition

**复刻范围** (Scope): 全部模块
- 聊天 (Chat/Message)
- 联系人 (Contacts)
- 工作台 (Workbench)
- 消息 (Notifications/Message Center)
- 我的 (Profile/Settings)

**复刻深度** (Depth): 100% 对齐
- UI/UX: 完全一致
- 业务逻辑: 完全一致
- 核心聊天功能: 必须一致

---

## Technique Selection

**Approach:** AI-Recommended Techniques
**Analysis Context:** RuoYi-IM 前端完美复刻钉钉 DingTalk with focus on UI/UX 完全一致 + 业务逻辑完全一致

**Recommended Techniques:**

- **Trait Transfer:** 系统性地从钉钉提取UI/UX/业务逻辑属性并转移到RuoYi-IM。适合"复制"目标的完美匹配技术。
- **Morphological Analysis:** 为5个模块建立完整的参数矩阵，确保不遗漏任何细节。
- **Mind Mapping:** 可视化整个复刻工作的范围和依赖关系，构建完整路线图。

**AI Rationale:** 用户目标是精确复制/对齐（非创意生成），因此选择了结构化、系统化的技术来确保100%覆盖钉钉的所有特性。Trait Transfer负责属性提取，Morphological Analysis确保参数完整性，Mind Mapping提供可视化路线图。

---

## Trait Transfer: 钉钉 → RuoYi-IM 属性转移分析

**研究日期**: 2026-01-28
**研究方法**: 网络搜索 + 钉钉官方文档 + UI设计规范

### 一、整体布局结构 (Layout Architecture)

#### 1.1 PC桌面端三栏布局

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           钉钉 PC 桌面端布局                                  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────┐  ┌─────────────┐  ┌──────────────────────────────────────────┐   │
│  │      │  │             │  │                                          │   │
│  │ 左侧 │  │  中间列表区  │  │           右侧聊天/内容区               │   │
│  │ 导航 │  │             │  │                                          │   │
│  │ 栏   │  │  会话/联系人  │  │     聊天消息 / 工作台卡片 / 详情        │   │
│  │      │  │     列表     │  │                                          │   │
│  │ 72px │  │   280px     │  │           自适应宽度                     │   │
│  │      │  │             │  │                                          │   │
│  └──────┘  └─────────────┘  └──────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

**关键属性**:
- **左侧导航栏**: 72px 宽度，图标式垂直导航，支持宽/窄两种模式切换
- **中间列表区**: 280px 宽度，会话列表/联系人列表/应用列表
- **右侧内容区**: 自适应宽度，聊天窗口/工作台/详情页面
- **顶部搜索栏**: 全局搜索，支持"/"快捷键唤起

#### 1.2 左侧导航栏 (Navigation Bar)

| 图标 | 功能 | 说明 |
|------|------|------|
| 💬 消息 | 聊天/会话列表 | 默认首页，显示所有单聊/群聊 |
| 👥 通讯录 | 联系人/组织架构 | 企业组织架构树，快速找人 |
| 📊 工作台 | 应用/待办/审批 | 企业应用入口，卡片式布局 |
| 📁 文档 | 在线文档 | 协作文档编辑 |
| 📅 日历 | 日程/会议 | 日程管理和视频会议 |
| 📦 邮箱 | 企业邮件 | 邮件收发 |
| 🧰 更多 | 应用中心 | 所有可用应用 |
| ⚙️ 设置 | 系统设置 | 个人设置和应用管理 |

**交互属性**:
- 悬停显示功能名称tooltip
- 当前选中项左侧有蓝色指示条
- 支持拖拽排序（可自定义导航顺序）
- 支持隐藏不常用的导航项

---

### 二、聊天模块 (Chat Module) - 核心功能

#### 2.1 消息列表 (Conversation List)

**布局结构**:
```
┌─────────────────────────────────┐
│ 🔍 搜索消息/联系人/群组          │  ← 顶部搜索框
├─────────────────────────────────┤
│ 🔔 置顶会话 (可折叠)             │  ← 置顶会话区
│ ├─ [群] 项目讨论组              │
│ └─ [人] 张三                   │
├─────────────────────────────────┤
│ 全部会话                         │  ← 普通会话区
│ ├─ [群] 产品研发群 (3)          │  ← 未读数徽标
│ ├─ [人] 李四 [草稿]            │  ← 草稿标识
│ └─ [人] 王五                   │
├─────────────────────────────────┤
│ 📁 自定义分组                   │  ← 分组管理
│   ├─ 重要客户                  │
│   └─ 项目组                    │
└─────────────────────────────────┘
```

**关键属性**:
- **搜索框**: 支持搜索消息、联系人、群组
- **置顶会话**: 独立区域，支持折叠
- **未读徽标**: 红色数字徽标显示未读消息数
- **草稿标识**: 显示未发送的草稿内容
- **分组管理**: 支持自定义分组，拖拽排序
- **侧边栏分组**: 消息页面支持分组管理功能

#### 2.2 聊天窗口 (Chat Window)

**工具栏功能**:
```
┌─────────────────────────────────────────────────────────────────────────┐
│ [群名/人名]                          🔕  📌  ⋮                        │ 顶部
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  消息显示区域                                                          │
│  ├─ 对方消息 (白色气泡，左对齐)                                        │
│  └─ 我方消息 (蓝色气泡，右对齐)                                        │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│ [引用回复预览 - 可关闭]                                                  │ 引用区
├─────────────────────────────────────────────────────────────────────────┤
│ 😊  📎  📁  📷  🎤  ✂️  📞  ✉️  /                          📝  发送  │ 输入区
└─────────────────────────────────────────────────────────────────────────┘
```

**工具栏按钮详解**:
| 按钮 | 功能 | 快捷键 |
|------|------|--------|
| 😊 表情 | 表情选择器 + 自定义文字表情 | - |
| 📎 文件 | 发送文件/文档 | - |
| 📁 文档 | 快速发送在线文档 | `/发文档` |
| 📷 图片 | 发送图片/相册 | - |
| 🎤 语音 | 语音输入/语音转文字 | - |
| ✂️ 截图 | 屏幕截图/截图并隐藏窗口 | `Ctrl+Alt+A` |
| 📞 电话 | 语音/视频通话 | - |
| ✉️ 邮件 | 发送邮件 | - |
| / | 快捷指令入口 | `/` |
| 📝 | 换行输入模式切换 | - |

**消息气泡属性**:
- **己方消息**: 蓝色背景 (#1677FF)，右对齐，圆角 8px
- **对方消息**: 白色背景，左对齐，圆角 8px
- **消息状态**: 发送中/已送达/已读/失败图标
- **时间戳**: 30分钟间隔显示时间分隔线
- **消息操作**: 悬停显示快捷操作（回复、多选、转发、撤回、删除）

#### 2.3 AI功能增强 (2025新增)

**AI灵动回复**:
- 输入框右侧AI图标，一键唤起
- 基于历史对话智能生成回复建议
- 高情商回答选项

**AI表情表态**:
- 长按消息唤起浮窗卡片
- 一键选择AI生成的文字/图片表情包

**消息速读** (钉钉365):
- 总结最新20条消息
- 快速了解聊天内容

---

### 三、联系人/组织架构模块 (Contacts Module)

#### 3.1 通讯录页面布局

```
┌─────────────────────────────────┐
│ 🔍 搜索联系人                    │  ← 全局搜索
├─────────────────────────────────┤
│ 🏢 组织架构                     │  ← 企业组织架构树
│   ├─ 技术部                     │
│   │   ├─ 前端组                │
│   │   └─ 后端组                │
│   └─ 产品部                     │
├─────────────────────────────────┤
│ 👥 我的同事                     │  ← A-Z索引
│   ├─ A                         │
│   ├─ B                         │
│   └─ ...                        │
├─────────────────────────────────┤
│ 🤝 外部联系人                   │  ← 外部联系人
│   └─ 客户/合作伙伴             │
├─────────────────────────────────┤
│ 👤 群聊                         │  ← 群组列表
│   └─ ...                        │
└─────────────────────────────────┘
```

**关键属性**:
- **组织架构树**: 可展开/折叠的树形结构，显示部门层级
- **A-Z索引**: 右侧字母索引快速定位
- **外部联系人**: 独立区域管理外部联系人
- **搜索功能**: 支持按姓名、部门、职位搜索

---

### 四、工作台模块 (Workbench Module)

#### 4.1 工作台布局 (Bento Grid 风格)

```
┌─────────────────────────────────────────────────────────────────────────┐
│ 工作台                                              [+ 添加应用]         │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                   │
│ │   待办审批    │  │   日程安排    │  │   DING消息    │                   │
│ │   [数字]     │  │   今日X项    │  │   [数字]     │                   │
│ └──────────────┘  └──────────────┘  └──────────────┘                   │
│                                                                          │
│ ┌────────────────────────────────┐  ┌────────────────────────────────┐  │
│ │          常用应用              │  │          推荐应用                │  │
│ │   ┌────┐ ┌────┐ ┌────┐        │  │   ┌────┐ ┌────┐ ┌────┐        │  │
│ │   │OA  │ │考勤│ │日志│        │  │   │    │ │    │ │    │        │  │
│ │   └────┘ └────┘ └────┘        │  │   └────┘ └────┘ └────┘        │  │
│ └────────────────────────────────┘  └────────────────────────────────┘  │
│                                                                          │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │                        数据报表/看板                                  │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
```

**关键属性**:
- **卡片式布局**: 分栏布局组件，整齐美观
- **常用应用**: 快速访问高频应用，支持拖拽排序
- **数据看板**: 实时数据展示，图表化呈现
- **可定制**: 支持自定义工作台内容和布局

---

### 五、搜索功能 (Global Search)

#### 5.1 搜索入口和能力

**快捷键**: `/` 直接唤起（在任何输入框中）

**搜索范围**:
- 综合搜索
- 联系人
- 群组
- 聊天记录（支持筛选：按会话/发送人/日期）
- 文档
- 应用

**搜索栏位配置**: 支持自定义搜索栏位排序，区分移动端/桌面端

---

### 六、其他重要功能

#### 6.1 截图功能
- 快捷键: `Ctrl+Alt+A` (Windows) / `Shift+Command+A` (Mac)
- 功能: 屏幕截图、截图并隐藏窗口、滚动截图
- 标注: 文字、箭头、方框、马赛克等标注工具
- 贴图: 钉在桌面功能

#### 6.2 多端同步
- 桌面端 (Windows/Mac)
- 移动端 (iOS/Android)
- 网页端
- 消息实时同步

#### 6.3 主题定制
- 支持模糊效果与桌面壁纸联动
- 专属主题：外边框配图、文字颜色自定义
- 支持企业级主题配置

---

## 实施路线图 (Implementation Roadmap)

### 阶段划分

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        RuoYi-IM 复刻钉钉实施路线图                             │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  P0  ████████████████████████  核心聊天功能 (必须100%一致)                   │
│  P1  ██████████████               辅助功能模块                                │
│  P2  ████████                     高级特性                                    │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### P0: 核心聊天功能 (第一阶段)

| 序号 | 功能点 | 对应钉钉特性 | 文件 | 状态 |
|------|--------|-------------|------|------|
| 1.1 | 左侧导航栏 | 72px图标导航，蓝色指示条 | `ImSideNavNew.vue` | ✅ 已完成 |
| 1.2 | 消息列表 | 搜索框+置顶+未读徽标+草稿 | `SessionPanel.vue` | ✅ 已完成 |
| 1.3 | 消息气泡 | 蓝白气泡，圆角8px | `MessageBubble.vue` | ✅ 已完成 |
| 1.4 | 输入框工具栏 | 表情/文件/图片/截图/通话 | `MessageInput.vue` | ✅ 已完成 |
| 1.5 | 消息状态 | 发送中/已送达/已读/失败 | `MessageItem.vue` | ✅ 已完成 |
| 1.6 | 消息操作 | 回复/转发/撤回/删除 | `MessageItem.vue` | 🔄 待完善 |
| 1.7 | 搜索功能 | `/`快捷键唤起 | 全局搜索组件 | ❌ 待开发 |
| 1.8 | 截图功能 | Ctrl+Alt+A | 截图组件 | ❌ 待开发 |

### P1: 辅助功能模块 (第二阶段)

| 序号 | 功能点 | 对应钉钉特性 | 文件 | 状态 |
|------|--------|-------------|------|------|
| 2.1 | 通讯录页面 | 组织架构树+A-Z索引 | `ContactsPanel.vue` | 🔄 进行中 |
| 2.2 | 工作台页面 | Bento Grid卡片布局 | `WorkbenchPanel.vue` | ❌ 待开发 |
| 2.3 | 待办事项 | 待办列表+快速添加 | `TodoPanel.vue` | 🔄 进行中 |
| 2.4 | 审批流程 | 审批列表+快捷操作 | `ApprovalPanel.vue` | ❌ 待开发 |
| 2.5 | 群文件管理 | 文件列表+上传下载 | `GroupFilePanel.vue` | ✅ 已完成 |

### P2: 高级特性 (第三阶段)

| 序号 | 功能点 | 对应钉钉特性 | 状态 |
|------|--------|-------------|------|
| 3.1 | AI灵动回复 | 智能回复建议 | ❌ 待开发 |
| 3.2 | AI表情表态 | 长按消息浮窗表情 | ❌ 待开发 |
| 3.3 | 消息速读 | 总结20条消息 | ❌ 待开发 |
| 3.4 | 语音转文字 | 语音识别转文字 | ❌ 待开发 |
| 3.5 | 主题定制 | 模糊效果+自定义主题 | ❌ 待开发 |

---

## Morphological Analysis: 参数矩阵

### 聊天模块参数矩阵

| 参数类别 | 参数项 | 钉钉值 | RuoYi-IM 当前值 | 差距 |
|---------|--------|--------|---------------|------|
| **布局** | 左侧导航宽度 | 72px | 56px | ⚠️ 需调整 |
| | 中间列表宽度 | 280px | 约280px | ✅ 一致 |
| | 导航指示条位置 | 左侧 | 左侧 | ✅ 一致 |
| **消息气泡** | 己方背景色 | #1677FF | 品牌色 | ✅ 一致 |
| | 对方背景色 | 白色 | 白色 | ✅ 一致 |
| | 圆角 | 8px | 8px | ✅ 一致 |
| **工具栏** | 按钮数量 | 9个 | 约8个 | ⚠️ 需补充 |
| | 截图快捷键 | Ctrl+Alt+A | 需实现 | ❌ 待开发 |
| | 快捷指令 | `/` | ❌ 无 | ❌ 待开发 |
| **消息列表** | 置顶区域 | 独立可折叠 | 独立 | ✅ 一致 |
| | 未读徽标 | 红色数字 | 红色数字 | ✅ 一致 |
| | 草稿标识 | 显示 | ❌ 无 | ❌ 待开发 |
| | 分组管理 | 支持 | ❌ 无 | ❌ 待开发 |

### 工作台模块参数矩阵

| 参数类别 | 参数项 | 钉钉值 | RuoYi-IM 当前值 | 差距 |
|---------|--------|--------|---------------|------|
| **布局** | 卡片风格 | Bento Grid | ❌ 无 | ❌ 待开发 |
| | 常用应用区 | 拖拽排序 | ❌ 无 | ❌ 待开发 |
| | 数据看板 | 图表展示 | ❌ 无 | ❌ 待开发 |
| **交互** | 快捷操作 | 悬停显示 | ❌ 无 | ❌ 待开发 |
| | 卡片动画 | 平滑过渡 | ❌ 无 | ❌ 待开发 |

---

## Mind Map: 完整复刻路线

```
                    RuoYi-IM 复刻钉钉项目
                            │
        ┌───────────────────┼───────────────────┐
        │                   │                   │
    [P0核心功能]        [P1辅助功能]        [P2高级特性]
        │                   │                   │
    ┌───┴───┐           ┌───┴───┐           ┌───┴───┐
    │       │           │       │           │       │
  聊天    导航栏       通讯录   工作台       AI功能   主题
    │       │           │       │           │       │
  ┌─┴─┐   ┌─┴─┐      ┌─┴─┐   ┌─┴─┐       ┌─┴─┐   ┌─┴─┐
消息 消息  图标  组织  卡片  灵动  模糊
列表 气泡  指示  架构  布局  回复  背景
输入 状态  搜索  索引  应用  表情  定制
工具  操作  快捷  外部  看板  速读
```

---

## 深度模块分析 (Deep Dive Analysis)

### A. 消息列表分组功能

#### 功能概述
钉钉的聊天分组（原专注模式）是对聊天窗口的管理功能，可以对群聊/单聊进行分组、新增分组、分组排序等，帮助减轻会话界面消息过载。

#### 核心特性

| 特性 | 说明 | 实现要点 |
|------|------|---------|
| **自定义分组** | 用户可创建任意数量的自定义分组 | 分组名称可自定义 |
| **拖拽排序** | 会话可拖拽到不同分组 | 使用 HTML5 Drag API |
| **分组管理** | 新增/删除/重命名分组 | 底部"分组管理"入口 |
| **智能分组** | 系统自动生成推荐分组 | AI 基于聊天频率和内容 |
| **分组排序** | 分组本身可拖拽排序 | 分组顺序可自定义 |
| **折叠展开** | 分组支持折叠和展开 | 默认展开状态 |

#### 布局结构
```
┌─────────────────────────────────┐
│ 🔍 搜索消息/联系人/群组          │
├─────────────────────────────────┤
│ 🔔 置顶会话 ▼                    │ ← 置顶区（可折叠）
│   ├─ [群] 项目讨论组              │
│   └─ [人] 张三                   │
├─────────────────────────────────┤
│ 📁 工作项目 ▼                     │ ← 自定义分组（可折叠）
│   ├─ [群] 研发群                 │
│   ├─ [群] 测试群                 │
│   └─ [人] 产品经理               │
├─────────────────────────────────┤
│ 📁 客户沟通 ▼                     │
│   └─ ...                          │
├─────────────────────────────────┤
│ 📁 个人交流 ▼                     │
│   └─ ...                          │
├─────────────────────────────────┤
│ 全部会话（未分组的）              │
│   └─ ...                          │
├─────────────────────────────────┤
│ [+ 分组管理]                      │ ← 底部入口
└─────────────────────────────────┘
```

#### 操作路径
- **PC端**: 消息页面 > 会话列表最底部 > 分组管理 > 新增分组
- **移动端**: 消息页面 > 底部 > 分组设置 > 新增分组

#### 数据结构设计
```javascript
// 分组数据结构
{
  groupId: string,
  groupName: string,
  order: number,
  isExpanded: boolean,
  conversations: [
    {
      conversationId: string,
      type: 'PRIVATE' | 'GROUP',
      name: string,
      avatar: string,
      unreadCount: number
    }
  ]
}
```

#### 实施要点
1. 在 `SessionPanel.vue` 中添加分组状态管理
2. 实现拖拽功能（推荐使用 `vue-draggable` 或 `sortablejs`）
3. 添加分组管理弹窗组件
4. 支持分组的折叠/展开状态保存到 Vuex
5. 分组数据持久化到后端

---

### B. 草稿标识功能

#### 功能概述
用户正在编辑或编辑完毕尚未发送消息时，切换到其他界面，草稿会被自动保存。再次进入该聊天时，会显示草稿内容和草稿标识。

#### 核心特性

| 特性 | 说明 | 实现要点 |
|------|------|---------|
| **自动保存** | 输入内容变化时自动保存 | 防抖1-2秒后保存 |
| **草稿标识** | 会话列表显示"草稿"标签 | 显示部分草稿内容预览 |
| **草稿恢复** | 进入聊天自动加载草稿 | 自动填充到输入框 |
| **草稿清除** | 发送消息后自动清除草稿 | 发送成功后删除 |
| **多端同步** | 草稿在多设备间同步 | 通过后端存储 |

#### UI展示

**会话列表中的草稿标识**:
```
┌─────────────────────────────────┐
│ [头像] 李四                      │
│        [草稿] 这个方案我觉得...    │ ← 草稿内容预览
└─────────────────────────────────┘
```

**输入框中的草稿恢复**:
```
┌─────────────────────────────────────────────────────────────────────────┐
│ 这个方案我觉得还需要再讨论一下...                                        │
│                                                                          │
│ 有草稿内容，是否继续编辑？  [继续编辑]  [清空草稿]                    │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 数据结构设计
```javascript
// 草稿数据结构
{
  draftId: string,
  conversationId: string,
  content: string,           // 草稿文本内容
  mentionedUsers: array,     // @的用户列表
  replyToMessageId: string,  // 回复的消息ID
  updateTime: timestamp,     // 最后更新时间
  mediaFiles: array          // 已选择的媒体文件
}
```

#### 实施要点
1. 在 `MessageInput.vue` 中监听输入变化
2. 使用防抖（1-2秒）自动保存草稿到 Vuex
3. 将草稿同步到后端存储
4. 在 `SessionPanel.vue` 中显示草稿标识
5. 进入聊天时自动恢复草稿到输入框
6. 发送消息成功后清除草稿

---

### C. 快捷指令 `/` 功能

#### 功能概述
在聊天框或搜索框中输入 `/`，可以快速唤起指令功能，无需离开当前界面即可完成各种操作。

#### 核心特性

| 特性 | 说明 | 实现要点 |
|------|------|---------|
| **快捷入口** | 输入 `/` 唤起指令菜单 | 监听输入框 `/` 字符 |
| **指令列表** | 显示所有可用指令 | 弹出面板展示 |
| **模糊搜索** | 支持搜索指令名称 | 输入后过滤指令 |
| **快捷执行** | 选中指令直接执行 | 回车或点击执行 |
| **参数输入** | 某些指令需要输入参数 | 弹出参数输入框 |

#### 指令列表

| 指令 | 功能 | 参数说明 |
|------|------|---------|
| `/发文档` | 快速发送文档 | 选择文档后发送 |
| `/发日程` | 快速创建日程 | 输入日程信息 |
| `/发起会议` | 快速发起视频会议 | 选择参会人员 |
| `/待办` | 创建待办事项 | 输入待办内容 |
| `/审批` | 发起审批流程 | 选择审批类型 |
| `/投票` | 发起投票 | 输入投票选项 |
| `/公告` | 发布公告 | 输入公告内容 |
| `/签到` | 考勤签到 | 获取位置信息 |

#### UI展示

**指令唤起界面**:
```
┌─────────────────────────────────────────────────────────────────────────┐
│ [聊天输入框] /                                                        │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌───────────────────────────────────────────────────────────────────┐ │
│ │ 🔍 搜索指令...                                                     │ │
│ ├───────────────────────────────────────────────────────────────────┤ │
│ │ 📄 发文档          快速发送在线文档                                │ │
│ │ 📅 发日程          创建日程安排                                    │ │
│ │ 📹 发起会议        创建视频会议                                    │ │
│ │ ✅ 待办            创建待办事项                                    │ │
│ │ 📝 审批            发起审批流程                                    │ │
│ │ 📊 投票            发起投票                                        │ │
│ │ 📢 公告            发布公告                                        │ │
│ │ 📍 签到            考勤签到                                        │ │
│ └───────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 数据结构设计
```javascript
// 指令数据结构
{
  commandId: string,
  commandKey: string,      // 如 "发文档"
  commandName: string,
  icon: string,
  description: string,
  requireParams: boolean,
  paramSchema: {
    type: 'document' | 'text' | 'users' | 'datetime',
    placeholder: string
  }
}
```

#### 实施要点
1. 在 `MessageInput.vue` 中监听 `/` 字符输入
2. 创建指令弹窗组件 `CommandPalette.vue`
3. 支持指令的模糊搜索过滤
4. 每个指令对应一个具体的操作流程
5. 支持自定义指令配置

---

### D. 截图功能增强

#### 功能概述
钉钉截图功能支持一键启动截图、录屏、文字识别等，集成了丰富的标注和贴图能力。

#### 核心特性

| 特性 | 说明 | 实现要点 |
|------|------|---------|
| **快捷键启动** | Ctrl+Alt+A (Win) / Shift+Command+A (Mac) | 全局热键注册 |
| **截图模式** | 矩形/窗口/全屏/滚动截图 | 多种截图模式 |
| **标注工具** | 箭头/方框/文字/马赛克/画笔 | 丰富的标注工具 |
| **滚动截图** | 自动拼接长内容 | 自动滚动捕获 |
| **贴图功能** | 截图钉在桌面 | 置顶显示 |
| **录屏功能** | 屏幕录制 | 会员功能 |
| **OCR识别** | 文字识别 | AI能力 |

#### 工具栏布局
```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  [矩形] [窗口] [全屏] [滚动]                                             │ 截图模式
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  [箭头] [方框] [文字] [马赛克] [画笔] [ emoji ] [撤销] [保存]           │ 标注工具
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  [钉在桌面] [复制] [下载] [钉在聊天] [取消]                             │ 操作按钮
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 快捷键定义

| 快捷键 | 功能 |
|--------|------|
| `Ctrl+Alt+A` | 启动截图 (Windows) |
| `Shift+Command+A` | 启动截图 (Mac) |
| `ESC` | 取消截图 |
| `Enter` | 确认截图 |
| `Ctrl+Z` | 撤销标注 |
| `Ctrl+S` | 保存到本地 |

#### 实施要点
1. 使用 Electron 的 `globalShortcut` 注册全局热键
2. 或使用桌面端截图库（如 `electron-screenshot`）
3. 创建标注工具组件
4. 实现贴图功能（悬浮窗）
5. 集成 OCR 文字识别 API

---

### E. 通讯录页面 - 组织架构树

#### 功能概述
通讯录页面展示企业的组织架构，支持按部门层级浏览，快速找到同事。

#### 核心特性

| 特性 | 说明 | 实现要点 |
|------|------|---------|
| **组织架构树** | 部门层级展示，可展开/折叠 | 树形组件 |
| **部门成员** | 点击部门显示成员列表 | 懒加载 |
| **A-Z索引** | 右侧字母索引导航 | 快速定位 |
| **搜索功能** | 按姓名/部门/职位搜索 | 全局搜索 |
| **外部联系人** | 独立区域管理外部联系人 | 分区展示 |
| **群聊列表** | 展示所有群聊 | 列表展示 |

#### 布局结构
```
┌─────────────────────────────────────────────────────────────────────────┐
│ 🔍 搜索联系人                                [+ 添加外部联系人]       │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌───────────────┐  ┌──────────────────────────────────────────────┐  │
│ │  🏢 组织架构   │  │                                              │  │
│ │               │  │  部门成员列表                                │  │
│ │ 📁 XX公司      │  │  ┌───────────────┐ ┌───────────────┐        │  │
│ │   ├─ 技术部    │  │  │ [头像] 张三    │ │ [头像] 李四    │        │  │
│ │   │  ├─ 前端组 │  │  │ 前端工程师      │ │ 产品经理      │        │  │
│ │   │  └─ 后端组 │  │  └───────────────┘ └───────────────┘        │  │
│ │   ├─ 产品部    │  │                                              │  │
│ │   └─ 市场部    │  │  [显示更多成员...]                         │  │
│ │               │  │                                              │  │
│ └───────────────┘  └──────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │  👥 我的同事                                                          │ │
│ │   A  B  C  D  E  F  G  H  I  J  K  L  M  N  O  P  Q  R  S  T    │ │
│ │   U  V  W  X  Y  Z  #                                                 │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │  🤝 外部联系人                                                        │ │
│ │   └─ [添加]                                                           │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │  👤 群聊                                                              │ │
│ │   [群1] [群2] [群3] ...                                            │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
```

#### A-Z 索引实现
```javascript
// 字母索引数据结构
const alphabetIndex = [
  { letter: 'A', count: 5, users: [...] },
  { letter: 'B', count: 3, users: [...] },
  // ...
  { letter: 'Z', count: 1, users: [...] },
  { letter: '#', count: 10, users: [...] }  // 其他字符
]

// 点击索引滚动到对应位置
const scrollToLetter = (letter) => {
  const element = document.getElementById(`section-${letter}`)
  element?.scrollIntoView({ behavior: 'smooth' })
}
```

#### 实施要点
1. 在 `ContactsPanel.vue` 中实现组织架构树
2. 使用 Element Plus 的 `el-tree` 组件
3. 实现部门成员的懒加载
4. 创建字母索引侧边栏组件
5. 实现搜索过滤功能

---

### F. 工作台 Bento Grid 布局

#### 功能概述
工作台采用 Bento Grid（便当盒网格）布局，将各种功能模块以卡片形式展示，支持拖拽排序和自定义布局。

#### 核心特性

| 特性 | 说明 | 实现要点 |
|------|------|---------|
| **分栏布局** | 支持拖拽分栏组件嵌套 | 响应式网格 |
| **卡片展示** | 功能模块以卡片形式展示 | 统一卡片样式 |
| **拖拽排序** | 支持拖拽调整卡片位置 | HTML5 Drag API |
| **宽度调整** | 卡片宽度可调整 | 列宽控制 |
| **数据看板** | 集成图表数据展示 | ECharts 集成 |
| **快捷操作** | 悬停显示快捷操作 | 交互优化 |

#### 布局结构
```
┌─────────────────────────────────────────────────────────────────────────┐
│ 工作台                                              [+ 添加应用]         │
├─────────────────────────────────────────────────────────────────────────┤
│ ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                   │
│ │   待办审批    │  │   日程安排    │  │   DING消息    │  ← 1:1:1 卡片  │
│ │   15 项      │  │   今日3项    │  │   8 条       │                   │
│ └──────────────┘  └──────────────┘  └──────────────┘                   │
│                                                                          │
│ ┌────────────────────────────────────┐  ┌────────────────────────────┐  │
│ │           常用应用 (4列布局)       │  │          推荐应用          │  │
│ │  ┌────┐ ┌────┐ ┌────┐ ┌────┐     │  │  ┌────┐ ┌────┐ ┌────┐     │  │
│ │  │OA  │ │考勤│ │日志│ │公告│     │  │  │CRM │ │BI  │ │报表│     │  │
│ │  └────┘ └────┘ └────┘ └────┘     │  │  └────┘ └────┘ └────┘     │  │
│ │  [拖拽排序]                         │  │  [添加更多...]              │  │
│ └────────────────────────────────────┘  └────────────────────────────┘  │
│                                                                          │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │                        数据报表/看板                                  │ │
│ │  [图表区域 - 集成 ECharts]                                         │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 卡片类型定义

| 卡片类型 | 说明 | 尺寸 |
|---------|------|------|
| **数据卡片** | 显示数字统计，如待办数量 | 1x1, 1x2 |
| **应用卡片** | 快速入口，带图标和名称 | 1x1 |
| **图表卡片** | 展示图表数据 | 2x2, 2x3, 全宽 |
| **列表卡片** | 显示列表数据 | 1x2, 2x2 |

#### 分栏布局实现
```javascript
// 分栏布局配置
const layoutConfig = {
  type: 'row',      // 行布局
  gutter: 16,       // 间距 16px
  columns: [
    {
      span: 8,      // 占 8/24
      cards: [...]
    },
    {
      span: 8,      // 占 8/24
      cards: [...]
    },
    {
      span: 8,      // 占 8/24
      cards: [...]
    }
  ]
}
```

#### 实施要点
1. 创建 `WorkbenchPanel.vue` 主容器
2. 使用 CSS Grid 或 Flexbox 实现网格布局
3. 创建统一卡片组件 `BentoCard.vue`
4. 实现拖拽排序功能
5. 集成 ECharts 图表库
6. 支持布局配置持久化

---

## 模块间依赖关系

```
                    [Vuex Store]
                         │
        ┌────────────────┼────────────────┐
        │                │                │
   [MessageInput]   [SessionPanel]   [ContactsPanel]
        │                │                │
        └────────────────┼────────────────┘
                         │
                   [草稿存储]
                         │
                   [后端API]
```

**依赖说明**:
- 草稿功能需要跨 `MessageInput` 和 `SessionPanel` 共享状态
- 分组功能需要 Vuex 持久化分组配置
- 快捷指令需要多个模块协同工作

---

## 实施进度

### ✅ 模块 A: 消息列表分组功能 (已完成)

**实施日期:** 2026-01-28

**修改文件:**
- `src/store/modules/im-session.js` - 添加分组管理功能
- `src/views/SessionPanel.vue` - 更新UI支持分组显示

**新增功能:**
1. **分组管理 Store**
   - `groups` 状态 - 分组列表
   - `conversationGroupMap` 状态 - 会话与分组映射
   - 默认分组: "置顶聊天", "全部消息"
   - 自定义分组支持: 创建、重命名、删除
   - 本地存储持久化

2. **Getters**
   - `sortedGroups` - 排序后的分组列表
   - `groupedSessions` - 按分组组织的会话列表
   - `sessionGroup` - 获取会话所属分组

3. **Actions**
   - `initGroups` - 初始化分组数据
   - `createGroup` - 创建新分组
   - `renameGroup` - 重命名分组
   - `deleteGroup` - 删除分组
   - `toggleGroupExpand` - 切换分组展开/收起
   - `moveConversationToGroup` - 移动会话到分组
   - `reorderGroups` - 调整分组顺序

4. **SessionPanel UI 更新**
   - 分组标题显示 (可折叠)
   - 分组内会话列表
   - 右键菜单 "移动到分组" 选项
   - 头部菜单 "管理分组" 入口
   - 分组操作下拉菜单 (重命名/删除)

5. **交互设计**
   - 点击分组标题展开/收起
   - 右键会话可移动到自定义分组
   - 置顶会话自动进入"置顶聊天"分组
   - 删除分组时，会话自动移至"全部消息"

---

### ✅ 模块 B: 草稿标识功能 (已完成)

**实施日期:** 2026-01-28

**修改文件:**
- `src/components/Chat/MessageInput.vue` - 添加草稿自动保存逻辑
- `src/views/SessionPanel.vue` - 显示草稿标识和预览

**新增功能:**
1. **草稿自动保存**
   - 防抖保存机制 (1秒)
   - 会话切换时自动保存/加载草稿
   - 发送消息后自动清除草稿
   - localStorage 持久化

2. **草稿数据结构**
   ```javascript
   {
     conversationId: {
       content: "草稿内容",
       updateTime: timestamp
     }
   }
   ```

3. **草稿标识 UI**
   - 会话名称旁显示"草稿"徽章 (绿色)
   - 预览文本显示草稿内容 (前20字符)
   - 优先显示草稿而非最后消息

4. **实时同步**
   - SessionPanel 每秒检查 localStorage 更新
   - MessageInput 输入时防抖保存
   - 组件卸载时立即保存当前草稿

---

### ✅ 模块 C: 快捷指令 `/` 功能 (已完成)

**实施日期:** 2026-01-28

**新增文件:**
- `src/components/Chat/CommandPalette.vue` - 快捷命令面板组件

**修改文件:**
- `src/components/Chat/MessageInput.vue` - 集成快捷命令触发

**新增功能:**
1. **命令面板组件**
   - 模糊搜索命令
   - 键盘导航 (↑↓ 选择, Enter 执行, Esc 关闭)
   - 美观的命令列表展示

2. **支持命令**
   - `/发文档` - 上传文件
   - `/发日程` - 创建日程 (开发中)
   - `/发起会议` - 视频会议
   - `/待办` - 创建待办 (开发中)
   - `/审批` - 发起审批 (开发中)
   - `/投票` - 发起投票 (开发中)
   - `/公告` - 发布公告 (开发中)
   - `/签到` - 位置签到

3. **触发方式**
   - 输入 `/` 自动弹出命令面板
   - 全局快捷键 `Alt+/`
   - 模糊搜索命令名称

4. **UI 特性**
   - 命令分类图标
   - 快捷键提示
   - 响应式定位
   - 暗色模式支持

---

### ✅ 模块 D: 截图功能增强 (已完成)

**实施日期:** 2026-01-29

**修改文件:**
- `src/components/Chat/DingtalkScreenshot.vue` - 完全重构，添加完整标注功能
- `src/components/Chat/DesktopSticker.vue` - 新增桌面贴图组件

**新增功能:**

**P0: 核心标注工具**
1. **方框工具** (快捷键 R)
   - 绘制矩形框
   - 支持颜色和粗细调节
2. **箭头工具** (快捷键 A)
   - 绘制带箭头的直线
   - 自动计算箭头角度
3. **画笔工具** (快捷键 P)
   - 自由绘制
   - 平滑线条
4. **文字工具** (快捷键 T)
   - 点击添加文字
   - 带半透明背景
5. **马赛克工具** (快捷键 M)
   - 区域模糊处理
   - 可调节马赛克块大小
6. **橡皮擦** (快捷键 E)
   - 擦除标注内容
7. **撤销/重做** (Ctrl+Z / Ctrl+Y)
   - 最多50步历史记录

**P1: 高级功能**
1. **10色预设调色板**
   - 红、橙、黄、绿、青、蓝、紫、粉、白、黑
2. **自定义颜色选择器**
   - 支持任意颜色
3. **线宽调节** (1-20px)
   - 实时预览
4. **桌面贴图功能**
   - 截图钉在桌面
   - 可拖动移动
   - 支持最小化
   - 支持置顶
   - 双击复制贴图

**交互流程:**
```
1. Ctrl+Alt+A 启动截图
2. 拖拽选择区域 → 确认
3. 进入编辑模式 → 选择工具
4. 绘制标注 → 预览效果
5. 点击"发送"发送到聊天 / "钉在桌面"创建贴图
```

**UI 特性:**
- 钉钉风格深色工具栏
- 工具激活状态高亮
- 快捷键提示
- 平滑动画过渡

---

### ✅ 模块 E: 通讯录布局优化 (已完成)

**实施日期:** 2026-01-28

**修改文件:**
- `src/views/ContactsPanel.vue` - 重新设计导航列表布局

**优化内容:**

1. **左侧导航栏 (200px)** 优化
   - 统一导航项高度 (36px) 和间距
   - 激活状态左侧添加蓝色指示条
   - 图标尺寸统一为 16px
   - 添加滚动条样式优化

2. **组织架构区域** 重构
   - 清晰的层级缩进 (一级部门 28px, 二级部门 40px)
   - 展开/收起动画平滑过渡
   - 子部门圆点指示器
   - 选中状态左侧指示条

3. **中间列表栏 (280px)** 调整
   - 与钉钉一致的宽度
   - A-Z 索引栏定位优化
   - 列表项内边距调整 (8px 12px)
   - 头像尺寸统一为 36px

4. **视觉细节优化**
   - 过渡动画时间统一为 0.15s
   - 悬停状态背景色优化
   - 字体大小精确调整 (标题 14px, 描述 12px)
   - 暗色模式适配完善

---

### ✅ 模块 D: 截图功能增强 - P2 专业功能 (已完成)

**实施日期:** 2026-01-29

**新增文件:**
- `src/utils/ocr.js` - OCR 文字识别引擎
- `src/utils/scroll-screenshot.js` - 滚动拼接工具

**新增功能:**

**P2: 专业功能**
1. **OCR 文字识别**
   - 集成 Tesseract.js
   - 支持中英文混合识别
   - 一键复制识别结果
   - 识别进度提示
   - 置信度分析

2. **滚动截图工具**
   - 手动拼接模式
   - 自动检测重叠区域
   - 智能图像拼接
   - 支持长页面捕获

**技术实现:**
- OCR 使用 CDN 动态加载 Tesseract.js
- 支持中文简体 (chi_sim) + 英文 (eng)
- 滚动截图使用像素匹配算法检测重叠

---

### ✅ 模块 F: 工作台 Bento Grid 布局 (已完成)

**实施日期:** 2026-01-29

**修改文件:**
- `src/views/WorkbenchPanel.vue` - 优化布局参数

**优化内容:**

1. **网格布局调整**
   - 从 2列 改为 3列布局（与钉钉一致）
   - 间距从 16px 调整为 12px
   - 更符合钉钉的视觉密度

2. **卡片样式优化**
   - 圆角从 16px 调整为 12px
   - 阴影调整为更轻盈的钉钉风格
   - 悬停阴影加深效果

3. **快捷应用区域**
   - 从 8列 调整为 4列布局
   - 间距调整为 16px
   - 与钉钉快捷应用区一致

**已实现的卡片类型:**
| 卡片类型 | 尺寸 | 功能 |
|----------|------|------|
| 待办事项 | 1x2 | 显示待办列表 |
| 公司公告 | 1x2 | 显示公告列表 |
| 日程安排 | 2x1 | 显示今日日程 |
| 工作概览 | 2x2 | 统计数据看板 |
| 待审批 | 1x1 | 快捷入口 |
| 未读邮件 | 1x1 | 快捷入口 |

**高级功能:**
- 拖拽排序 (HTML5 Drag API)
- 编辑模式 (添加/删除卡片)
- 本地存储持久化
- 响应式布局
- 暗色模式支持

---

## P2: AI 功能增强探索 (2025-01-29 新增)

### 研究来源
- [钉钉8.1.10版本新功能介绍](https://alidocs.dingtalk.com/i/p/Y7kmbokZp3pgGLq2/docs/ZgpG2NdyVXrOE2QmuyprZg0P8MwvDqPk)
- [钉钉又发新版本！把AI 搬进每一次对话和会议](https://www.qbitai.com/2025/12/360243.html)
- [钉钉上线"AI灵动回复"新功能](https://www.jiemian.com/article/13748134.html)

---

### A. AI 灵动回复 (AI Smart Reply)

#### 功能概述
根据当前聊天对话的上下文，智能生成多种风格的回复建议，被称为职场沟通的"AI嘴替"。

#### 核心特性

| 特性 | 说明 | 实现要点 |
|------|------|---------|
| **上下文分析** | 分析最近N条消息理解对话情境 | LLM API 调用 |
| **多风格回复** | 提供3-5种不同风格的回复建议 | Prompt 工程设计 |
| **高情商回复** | 适合职场场景的得体回复 | 场景化 Prompt |
| **一键应用** | 点击建议直接填入输入框 | 快速操作 |
| **持续优化** | 根据用户选择优化建议 | 反馈学习 |

#### UI 设计

```
┌─────────────────────────────────────────────────────────────────────────┐
│ [聊天消息区域...]                                                       │
│                                                                         │
├─────────────────────────────────────────────────────────────────────────┤
│ [输入框]                                          [AI 灵动回复]         │
├─────────────────────────────────────────────────────────────────────────┤
│ 🤔 AI 灵动回复合计                                                        │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 💼 正式回复                                                           │ │
│ │ "收到，我会尽快处理并给您反馈。"                                       │ │
│ ├─────────────────────────────────────────────────────────────────────┤ │
│ │ 😊 友好回复                                                           │ │
│ │ "好的呢~这个问题我了解一下，晚点回复你哈！"                            │ │
│ ├─────────────────────────────────────────────────────────────────────┤ │
│ │ ⚡ 高效回复                                                           │ │
│ │ "收到，正在处理中。"                                                  │ │
│ ├─────────────────────────────────────────────────────────────────────┤ │
│ │ 🤝 协作回复                                                           │ │
│ │ "明白了，需要我配合什么吗？"                                          │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│                              [关闭]                                      │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 技术实现方案

**前端组件:**
```javascript
// AiSmartReply.vue
- 触发入口：输入框右侧 AI 图标
- API 调用：POST /api/im/ai/smart-reply
- 请求参数：{ conversationId, messageCount, context }
- 响应格式：{ suggestions: [{ style, text, tone }] }
```

**后端接口:**
```java
// ImAiController.java
@PostMapping("/smart-reply")
public Result<List<AiSuggestionVO>> getSmartReply(@RequestBody AiSmartReplyRequest request) {
    // 1. 获取最近 N 条消息
    // 2. 构建 Prompt
    // 3. 调用 LLM API (通义千问/文心一言/ChatGPT)
    // 4. 解析并返回建议
}
```

**Prompt 设计:**
```
你是一个职场沟通助手。根据以下对话上下文，生成4种不同风格的回复建议：

【对话上下文】
{messages}

【要求】
1. 正式回复：适合正式工作场合，表达专业
2. 友好回复：语气轻松，表达友好
3. 高效回复：简洁明了，直奔主题
4. 协作回复：体现团队合作精神

请以 JSON 格式返回：
[
  {"style": "formal", "text": "...", "tone": "专业"},
  {"style": "friendly", "text": "...", "tone": "友好"},
  {"style": "efficient", "text": "...", "tone": "简洁"},
  {"style": "collaborative", "text": "...", "tone": "协作"}
]
```

#### 配置参数

| 参数 | 默认值 | 说明 |
|------|--------|------|
| 上下文消息数 | 10 | 分析最近多少条消息 |
| 建议数量 | 4 | 生成多少个回复建议 |
| API 超时 | 5s | LLM API 调用超时时间 |
| 缓存时长 | 5min | 相同上下文的缓存时间 |

---

### B. AI 表情表态 (AI Emoji Reaction)

#### 功能概述
被@时或长按消息时，自动出现推荐的AI文字表情，一键选择AI生成的文字/图片表情包进行回复。

#### 核心特性

| 特性 | 说明 | 实现要点 |
|------|------|---------|
| **智能推荐** | 根据消息内容推荐合适的表情 | 语义分析 |
| **文字表情** | 生成有趣的文字表情包 | 模板生成 |
| **场景匹配** | 不同场景推荐不同表情 | 场景分类 |
| **自定义表情** | 支持用户自定义表情库 | 本地存储 |
| **快捷操作** | 长按/@触发快速选择面板 | 交互优化 |

#### UI 设计

```
┌─────────────────────────────────────────────────────────────────────────┐
│ [张三] 这个方案我觉得还需要再讨论一下                                   │
│  10:30                                            [表情表态]            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 🎯 AI 推荐表情                                                        │ │
│ │                                                                     │ │
│ │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐               │ │
│ │  │ 👍 好的  │  │ 🤔 思考  │  │ ✅ 收到  │  │ 🎉 太棒了 │               │ │
│ │  └─────────┘  └─────────┘  └─────────┘  └─────────┘               │ │
│ │                                                                     │ │
│ │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐               │ │
│ │  │ 😄 哈哈哈 │  │ 🔥 期待  │  │ 💪 加油  │  │ 🚀 冲鸭  │               │ │
│ │  └─────────┘  └─────────┘  └─────────┘  └─────────┘               │ │
│ │                                                                     │ │
│ │  ┌─────────────────────────────────────────────────────────────┐   │ │
│ │  │ 文字表情                                                     │   │ │
│ │  │ "收到收到！" "这个可以有" "俺也一样" "+1"                    │   │ │
│ │  └─────────────────────────────────────────────────────────────┘   │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 技术实现方案

**前端组件:**
```javascript
// AiEmojiReaction.vue
- 触发方式：长按消息 / 被@时弹出
- API 调用：POST /api/im/ai/emoji-suggest
- 请求参数：{ messageId, messageType, content }
- 响应格式：{ emojis: [{ emoji, type, reason }] }
```

**表情分类:**
```javascript
const emojiCategories = {
  agree: ['👍', '✅', '🆗', '👌'],
  think: ['🤔', '💭', '🧐', '🤷'],
  happy: ['😄', '🎉', '😊', '🥳'],
  expect: ['🔥', '✨', '💫', '⭐'],
  encourage: ['💪', '🚀', '冲鸭', '加油'],
  text: ['收到收到！', '这个可以有', '俺也一样', '+1', '明白']
}
```

---

### C. AI 消息速读 (AI Message Summary)

#### 功能概述
快速总结群聊中的大量消息，按优先级排序，帮助用户快速了解聊天内容。

#### 核心特性

| 特性 | 说明 | 实现要点 |
|------|------|---------|
| **智能摘要** | 提取关键信息和重要消息 | NLP 提取 |
| **优先级排序** | 按重要性对消息排序 | 算法评分 |
| **分类汇总** | 按话题/类型分类消息 | 聚类分析 |
| **@提及汇总** | 汇总所有@我的消息 | 过滤提取 |
| **待办提取** | 自动识别待办事项 | 正则+AI |

#### UI 设计

```
┌─────────────────────────────────────────────────────────────────────────┐
│ [项目讨论群]                                              [AI 消息速读] │
├─────────────────────────────────────────────────────────────────────────┤
│ 🤖 AI 消息速读摘要                                                       │
│                                                                         │
│ ┌─────────────────────────────────────────────────────────────────────┐ │
│ │ 📌 重要事项 (3)                                                       │ │
│ │ • 项目截止日期调整为本周五                                            │ │
│ │ • 需要提交设计稿初稿                                                  │ │
│ │ • 会议时间改为下午3点                                                 │ │
│ ├─────────────────────────────────────────────────────────────────────┤ │
│ │ 💬 讨论主题                                                           │ │
│ │ 1. UI 设计方案 (12条消息)                                             │ │
│ │ 2. 后端接口对接 (8条消息)                                             │ │
│ │ 3. 测试计划 (5条消息)                                                 │ │
│ ├─────────────────────────────────────────────────────────────────────┤ │
│ │ @ 我的消息 (2)                                                        │ │
│ │ • @张三 请确认设计稿                                                  │ │
│ │ • @全体 周五前提交代码                                                │ │
│ ├─────────────────────────────────────────────────────────────────────┤ │
│ │ ✅ 待办事项 (3)                                                       │ │
│ │ □ 提交设计稿初稿 (本周五)                                             │ │
│ │ □ 参加下午3点会议                                                     │ │
│ │ □ 代码提交前自测                                                      │ │
│ └─────────────────────────────────────────────────────────────────────┘ │
│                                                                         │
│                              [跳转原消息] [关闭]                         │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 技术实现方案

**前端组件:**
```javascript
// AiMessageSummary.vue
- 触发入口：群聊聊天框右上角图标
- API 调用：POST /api/im/ai/message-summary
- 请求参数：{ conversationId, messageCount, timeRange }
- 响应格式：{ summary, important, mentions, todos }
```

**后端处理流程:**
```java
1. 获取最近 N 条消息（默认50条）
2. 分析消息类型（文本/图片/文件）
3. 提取 @提及、关键词、时间/地点实体
4. LLM 生成摘要
5. 识别待办事项
6. 按优先级排序
```

**Prompt 设计:**
```
请分析以下群聊消息，生成结构化摘要：

【消息记录】
{messages}

【返回格式】
{
  "summary": "一句话总结当前讨论内容",
  "important": [
    {"priority": 1, "content": "重要事项1"},
    {"priority": 2, "content": "重要事项2"}
  ],
  "topics": [
    {"name": "主题名", "count": 消息数}
  ],
  "todos": [
    {"task": "待办内容", "deadline": "截止时间", "assignee": "负责人"}
  ]
}
```

---

## 实施优先级

### P2.1: AI 灵动回复 (优先实现)
- ✅ 用户价值高
- ✅ 技术复杂度中等
- ✅ 可快速验证效果

### P2.2: AI 消息速读 (群聊场景优先)
- ✅ 解决信息过载问题
- ⚠️ 技术复杂度较高
- ✅ 企业场景价值高

### P2.3: AI 表情表态 (最后实现)
- ✅ 提升用户体验
- ✅ 技术复杂度低
- ⚠️ 相对优先级较低

---

## 技术选型建议

### LLM 服务选择

| 服务 | 优势 | 劣势 | 推荐场景 |
|------|------|------|---------|
| **通义千问** | 阿里生态、中文优化好 | 需要阿里账号 | 首选 |
| **文心一言** | 百度生态、企业版稳定 | API 调用较慢 | 备选 |
| **DeepSeek** | 性价比高、开源 | 稳定性待验证 | 试用 |
| **ChatGPT** | 能力最强 | 国内访问限制 | 不推荐 |

### 成本估算

以通义千问 `qwen-turbo` 为例：
- 输入: ¥0.008/千tokens
- 输出: ¥0.002/千tokens
- 预估每次灵动回复: ~500 tokens = ¥0.004
- 预估每次消息速读: ~2000 tokens = ¥0.016
- 1000次调用成本: 约 ¥4-16

---

## 下一步行动

1. **技术验证** (1-2天)
   - [ ] 测试通义千问 API 接入
   - [ ] 验证 Prompt 效果
   - [ ] 评估响应速度

2. **原型开发** (3-5天)
   - [ ] 实现 AI 灵动回复组件
   - [ ] 实现 AI 消息速读组件
   - [ ] 前端 UI 联调

3. **测试优化** (2-3天)
   - [ ] 收集用户反馈
   - [ ] 优化 Prompt 质量
   - [ ] 调整 API 参数

---