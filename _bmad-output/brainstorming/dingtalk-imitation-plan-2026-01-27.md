---
stepsCompleted: [1]
inputDocuments: []
session_topic: 'RuoYi-IM 参考野火IM功能完善计划'
session_goals: '参考野火IM与当前系统的功能差距，识别缺失功能，制定分阶段实施计划，完善IM体验'
selected_approach: ''
techniques_used: []
ideas_generated: []
context_file: ''
session_date: 2026-01-27
updated_date: 2026-02-05
---

# 野火IM功能参考计划

**Facilitator:** Itxinfei
**Date:** 2026-01-27 | **Updated:** 2026-02-05
**目标:** 参考野火IM功能，完善RuoYi-IM系统
**参考:** [野火IM开发手册](https://docs.wildfirechat.cn/)

---

## 会话概述

**主题:** RuoYi-IM 参考野火IM功能完善计划
**目标:** 参考野火IM与当前系统的功能差距，识别缺失功能，制定分阶段实施计划

---

## 第一部分：野火IM核心功能清单

### 1. 消息类型

| 功能 | 野火IM描述 | 当前状态 | 优先级 |
|------|----------|----------|--------|
| 文本消息 | 基础文字聊天，支持表情 | ✅ 已完成 | P0 |
| 图片消息 | 发送/接收图片，支持预览 | ✅ 已完成 | P0 |
| 语音消息 | 按住说话，语音转文字 | ✅ 已完成 | P0 |
| 视频消息 | 发送短视频 | ✅ 已完成 | P0 |
| 文件消息 | 各类型文件发送 | ✅ 已完成 | P0 |
| 位置消息 | 发送地理位置 | ✅ 已完成 | P0 |
| 链接预览 | 自动解析URL显示预览 | ✅ 已完成 | P0 |
| 表情消息 | 自定义表情包 | ✅ 已完成 | P0 |
| @消息 | @成员提醒 | ✅ 已完成 | P0 |
| **表情回复** | 快捷表情反应（点赞/爱心等） | ❌ 未实现 | P0 |
| **代码块** | 识别代码格式高亮显示 | ❌ 未实现 | P1 |
| **合并转发** | 多条消息打包转发 | 🚧 部分完成 | P1 |
| **机器人消息** | 机器人自动回复 | 🚧 API存在 | P1 |

### 2. 消息操作

| 功能 | 野火IM描述 | 当前状态 | 优先级 |
|------|----------|----------|--------|
| 复制 | 复制文本内容 | ✅ 已完成 | P0 |
| 引用回复 | 引用消息进行回复 | ✅ 已完成 | P0 |
| 撤回 | 2分钟内撤回消息 | ✅ 已完成 | P0 |
| 编辑 | 编辑已发送消息 | ✅ 已完成 | P0 |
| 转发 | 转发到其他会话 | ✅ 已完成 | P0 |
| 多选转发 | 批量转发多条消息 | ✅ 已完成 | P0 |
| 收藏 | 收藏重要消息 | ✅ 已完成 | P0 |
| 标记 | 标记为待办/重要 | ✅ 已完成 | P0 |
| **消息置顶** | 在会话中置顶重要消息 | ❌ 未实现 | P1 |
| **引用查看** | 点击引用跳转到原消息 | 🚧 部分完成 | P1 |

### 3. 消息状态

| 功能 | 野火IM描述 | 当前状态 | 优先级 |
|------|----------|----------|--------|
| 发送中 | 消息发送中状态 | ✅ 已完成 | P0 |
| 已发送 | 消息已送达 | ✅ 已完成 | P0 |
| **已读回执** | 显示已读人数/详情 | ❌ 未实现 | P0 |
| 发送失败 | 失败可重发 | ✅ 已完成 | P0 |

### 4. 会话功能

| 功能 | 野火IM描述 | 当前状态 | 优先级 |
|------|----------|----------|--------|
| 单聊 | 一对一聊天 | ✅ 已完成 | P0 |
| 群聊 | 多人群组聊天 | ✅ 已完成 | P0 |
| 会话置顶 | 置顶重要会话 | ✅ 已完成 | P0 |
| 会话免打扰 | 消息免打扰 | ✅ 已完成 | P0 |
| **会话标记** | 标记重要会话 | ❌ 未实现 | P1 |
| **草稿箱** | 未发送消息草稿 | ❌ 未实现 | P2 |

### 5. 群组功能

| 功能 | 野火IM描述 | 当前状态 | 优先级 |
|------|----------|----------|--------|
| 创建群组 | 创建新群组 | ✅ 已完成 | P0 |
| 群组设置 | 群名称/头像/描述 | ✅ 已完成 | P0 |
| 成员管理 | 添加/移除成员 | ✅ 已完成 | P0 |
| 角色管理 | 群主/管理员/成员 | ✅ 已完成 | P0 |
| **群公告** | 发布群公告 | 🚧 API存在 | P1 |
| **群文件** | 群文件管理 | 🚧 API存在 | P1 |
| **群禁言** | 禁止群员发言 | ❌ 未实现 | P1 |
| **群投票** | 群内投票功能 | ❌ 未实现 | P2 |
| **群打卡** | 群内打卡功能 | ❌ 未实现 | P2 |

### 6. 通话功能

| 功能 | 野火IM描述 | 当前状态 | 优先级 |
|------|----------|----------|--------|
| 一对一语音 | 单人语音通话 | 🚧 UI完成 | P1 |
| 一对一视频 | 单人视频通话 | 🚧 UI完成 | P1 |
| **多人语音** | 群语音会议 | ❌ 未实现 | P1 |
| **多人视频** | 群视频会议 | ❌ 未实现 | P1 |
| **屏幕共享** | 共享屏幕 | ❌ 未实现 | P2 |

### 7. 搜索功能

| 功能 | 野火IM描述 | 当前状态 | 优先级 |
|------|----------|----------|--------|
| 全局搜索 | 搜索消息/联系人/群组 | 🚧 API存在 | P0 |
| 搜索历史记录 | 搜索聊天记录 | 🚧 UI缺失 | P1 |
| **按日期搜索** | 按时间筛选消息 | ❌ 未实现 | P1 |
| **按类型搜索** | 按文件类型筛选 | ❌ 未实现 | P1 |
| **按发送者搜索** | 按成员筛选消息 | ❌ 未实现 | P1 |

### 8. 文件管理

| 功能 | 野火IM描述 | 当前状态 | 优先级 |
|------|----------|----------|--------|
| 文件发送 | 发送各类型文件 | ✅ 已完成 | P0 |
| 文件接收 | 接收并保存文件 | ✅ 已完成 | P0 |
| **文件预览** | 在线预览文件 | ❌ 未实现 | P1 |
| **文件管理** | 群文件管理 | 🚧 API存在 | P1 |
| **云盘** | 个人/企业云盘 | ❌ 未实现 | P2 |

### 9. 野火IM特色功能

| 功能 | 野火IM描述 | 当前状态 | 优先级 |
|------|----------|----------|--------|
| **机器人消息** | 机器人自动回复 | 🚧 API存在 | P1 |
| **已读回执** | 显示谁读了消息 | ❌ 未实现 | P0 |
| **拍一拍** | 双击头像互动 | ❌ 未实现 | P2 |
| **频道订阅** | 公众号式订阅 | ❌ 未实现 | P2 |
| **朋友圈** | 朋友圈功能 | ❌ 未实现 | P3 |
| **日程** | 日程管理 | 🚧 API存在 | P2 |
| **待办** | 待办事项 | 🚧 API存在 | P2 |
| **审批** | 审批流程 | 🚧 API存在 | P2 |

### 10. 交互细节

| 功能 | 野火IM描述 | 当前状态 | 优先级 |
|------|----------|----------|--------|
| 输入状态 | "正在输入..."提示 | ✅ 已完成 | P0 |
| 在线状态 | 显示在线/离线 | ✅ 已完成 | P0 |
| **截图** | 截图功能 | ❌ 未实现 | P1 |
| **快捷回复** | 快捷回复语 | ❌ 未实现 | P2 |
| **消息撤回提示** | "XXX撤回了一条消息" | ✅ 已完成 | P0 |
| **消息合并** | 连续消息合并显示 | ❌ 未实现 | P1 |
| **按时间分组** | 消息按时间分组 | ❌ 未实现 | P1 |

---

## 第二部分：功能缺口分析

### P0 核心缺失功能（必须实现）

1. **表情回复（快捷反应）** - 企业IM最常用的交互方式
2. **已读回执（群聊）** - 显示已读人数和列表
3. **消息置顶** - 会话内重要消息置顶
4. **全局搜索UI** - 已有API但缺少前端界面

### P1 重要缺失功能

5. 群公告 - 已有API，需要前端实现
6. 群文件管理 - 已有API，需要前端实现
7. 合并转发 - 部分完成，需要完善
8. 代码块识别和语法高亮
9. 截图功能
10. 消息合并显示（连续消息）
11. 按时间分组显示

### P2 增强功能

12. 机器人消息 - 已有API，需要UI
13. 日程管理
14. 待办事项
15. 审批流程
16. 快捷回复
17. 草稿箱
18. 会话标记

---

## 第三部分：分阶段实施计划

### Phase 1: 核心交互功能（1-2周）

**目标：** 实现野火IM参考的核心交互体验

1. **表情回复（快捷反应）**
   - 消息悬停显示表情栏
   - 支持：👍 ❤️ 😂 😮 😢 👏
   - 点击后消息下显示表情聚合
   - API设计：POST /api/im/message/{messageId}/reaction

2. **已读回执**
   - 单聊：显示"已读"状态
   - 群聊：显示"已读 X人"，点击查看详情
   - 数据表：im_message_read_receipt
   - WebSocket推送：read消息类型

3. **消息置顶**
   - 消息可置顶到会话顶部
   - 数据表：im_message.pinned字段
   - 置顶消息样式区分

### Phase 2: 群组增强功能（1-2周）

4. **群公告组件**
   - GroupAnnouncementDialog.vue
   - 发布/查看群公告
   - 公告置顶显示

5. **群文件管理**
   - GroupFilePanel.vue
   - 文件上传/下载/删除
   - 文件分类管理

6. **合并转发完善**
   - 选择多条消息
   - 生成转发预览
   - 转发消息类型：COMBINE_FORWARD

### Phase 3: 消息显示优化（1周）

7. **消息合并**
   - 同一用户连续消息合并显示
   - 只显示最后一个头像

8. **按时间分组**
   - 30分钟间隔显示时间分隔线
   - 每10条消息显示一次时间

9. **代码块识别**
   - 检测```代码块```
   - 语法高亮显示
   - 支持复制代码

### Phase 4: 搜索与截图（1周）

10. **全局搜索UI**
    - 搜索输入框
    - 结果分类：消息/联系人/群组/文件
    - 高亮关键词

11. **截图功能**
    - 调用系统截图API
    - 截图后直接发送

### Phase 5: 高级功能（2-3周）

12. **机器人消息**
    - 机器人发送对话框
    - 类型：自动回复/关键词触发
    - 消息接收/统计

13. **日程/待办/审批**
    - 集成现有API
    - 消息卡片展示

---

## 第四部分：技术实施要点

### 表情回复实现

```javascript
// 消息下方的表情栏
<div class="message-reactions" @click.stop>
  <button
    v-for="emoji in quickEmojis"
    :key="emoji"
    @click="handleReaction(emoji)"
    class="reaction-btn"
  >
    {{ emoji }}
  </button>
</div>

// 表情聚合显示
<div class="reaction-aggregate">
  <div v-for="(users, emoji) in reactions" :key="emoji" class="reaction-item">
    <span>{{ emoji }}</span>
    <span class="count">{{ users.length }}</span>
  </div>
</div>
```

### 已读回执实现

```javascript
// 数据结构
{
  messageId: 123,
  readUsers: [
    { userId: 1, userName: '张三', avatar: '...', readTime: '2026-01-27 10:30' },
    { userId: 2, userName: '李四', avatar: '...', readTime: '2026-01-27 10:31' }
  ],
  readCount: 2,
  totalCount: 5
}

// 群聊已读显示
<div class="read-receipt" @click="showReadDetail">
  <span class="read-count">已读 {{ readCount }}</span>
  <span class="total-count">/ {{ totalCount }}</span>
</div>
```

### 消息合并显示

```javascript
// 消息列表处理
const processedMessages = computed(() => {
  const result = []
  let prevMsg = null

  for (const msg of messages) {
    const shouldMerge = prevMsg &&
      prevMsg.senderId === msg.senderId &&
      prevMsg.isOwn === msg.isOwn &&
      (msg.timestamp - prevMsg.timestamp) < 3 * 60 * 1000 // 3分钟内

    if (shouldMerge) {
      result[result.length - 1].messages.push(msg)
    } else {
      result.push({
        type: 'message-group',
        senderId: msg.senderId,
        senderName: msg.senderName,
        avatar: msg.avatar,
        messages: [msg]
      })
    }
    prevMsg = msg
  }

  return result
})
```

---

## 第五部分：API补充需求

### 需要新增的API

```
POST /api/im/message/{messageId}/reaction       # 添加表情回复
DELETE /api/im/message/{messageId}/reaction/{type} # 取消表情回复
GET  /api/im/message/{messageId}/reactions        # 获取表情回复列表

POST /api/im/message/{messageId}/pin               # 置顶消息
DELETE /api/im/message/{messageId}/pin              # 取消置顶

GET  /api/im/message/{messageId}/read-users         # 获取已读用户列表
POST /api/im/message/{messageId}/mark-read           # 标记已读

GET  /api/im/group/{groupId}/announcement           # 获取群公告
POST /api/im/group/{groupId}/announcement           # 发布群公告

GET  /api/im/group/{groupId}/files                  # 获取群文件
POST /api/im/group/{groupId}/files                  # 上传群文件
```

---

## 第六部分：优先级排序

**按用户价值和技术复杂度综合排序：**

| 排序 | 功能 | 价值 | 复杂度 | 工期 |
|------|------|------|--------|------|
| 1 | 表情回复 | ⭐⭐⭐⭐⭐ | 🟢 简单 | 2天 |
| 2 | 已读回执 | ⭐⭐⭐⭐⭐ | 🟡 中等 | 3天 |
| 3 | 消息置顶 | ⭐⭐⭐⭐ | 🟢 简单 | 1天 |
| 4 | 全局搜索UI | ⭐⭐⭐⭐ | 🟡 中等 | 3天 |
| 5 | 消息合并显示 | ⭐⭐⭐ | 🟢 简单 | 2天 |
| 6 | 按时间分组 | ⭐⭐⭐ | 🟢 简单 | 1天 |
| 7 | 群公告 | ⭐⭐⭐⭐ | 🟡 中等 | 2天 |
| 8 | 群文件 | ⭐⭐⭐⭐ | 🟡 中等 | 3天 |
| 9 | 代码块 | ⭐⭐⭐ | 🟡 中等 | 2天 |
| 10 | 截图 | ⭐⭐⭐ | 🟢 简单 | 1天 |

---

*会话设置完成，准备进入技术发现阶段...*
