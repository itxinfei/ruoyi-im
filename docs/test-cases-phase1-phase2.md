# IM 聊天功能测试用例 - Phase 1 & Phase 2

**测试范围**: 消息发送状态 + 文件上传优化
**测试时间**: 1天
**测试人员**: 2-3名用户
**创建时间**: 2026-01-30

---

## 📋 测试概览

### 功能模块
1. **Phase 1**: 消息发送状态（4天开发）
   - WebSocket 幂等性
   - 发送状态 UI（发送中、成功、失败）
   - 失败重试机制

2. **Phase 2**: 文件上传优化（2.5天开发）
   - 拖拽上传
   - 粘贴上传
   - 上传进度显示

### 测试环境
- **浏览器**: Chrome 120+, Edge 120+, Firefox 120+
- **网络**: 正常网络 + 模拟弱网
- **数据**: 测试账号（2个用户互发消息）

---

## ✅ Phase 1 测试用例

### 1.1 消息发送 - 成功流程

#### 用例 1.1.1: 发送文本消息
**优先级**: P0

**前置条件**:
- 已登录系统
- 已选择会话

**测试步骤**:
1. 在输入框输入文本："测试消息1"
2. 点击"发送"按钮
3. 观察消息状态变化

**预期结果**:
- ✅ 消息立即显示在聊天界面（乐观 UI）
- ✅ 消息右侧显示灰色发送中图标（三个小点跳动）
- ✅ 0.5秒内图标变为绿色对勾
- ✅ 绿色对勾保持显示
- ✅ 对方用户能收到消息

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 1.1.2: 发送图片消息
**优先级**: P0

**前置条件**:
- 已登录系统
- 已选择会话
- 准备测试图片（1MB 以内）

**测试步骤**:
1. 点击图片上传按钮
2. 选择测试图片
3. 观察上传进度
4. 等待发送完成

**预期结果**:
- ✅ 图片显示在聊天界面
- ✅ 显示发送中状态
- ✅ 上传完成后显示成功状态
- ✅ 对方能收到图片

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 1.1.3: 发送文件消息
**优先级**: P1

**测试步骤**:
1. 点击文件上传按钮
2. 选择测试文件（PDF、Word 等）
3. 观察发送流程

**预期结果**:
- ✅ 文件成功上传
- ✅ 显示发送成功状态
- ✅ 对方能下载文件

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

### 1.2 消息发送 - 失败流程

#### 用例 1.2.1: 网络断开时发送消息
**优先级**: P0

**前置条件**:
- 已登录系统
- 已选择会话
- 准备断开网络

**测试步骤**:
1. 输入消息："网络断开测试"
2. 断开网络（开发者工具 → Network → Offline）
3. 点击"发送"按钮
4. 观察消息状态

**预期结果**:
- ✅ 消息显示在界面
- ✅ 发送中图标显示
- ✅ 3-5秒后变为红色感叹号
- ✅ 鼠标悬停显示"点击重试"
- ✅ 点击红色图标触发重试

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 1.2.2: 服务器错误时发送消息
**优先级**: P1

**前置条件**:
- 已登录系统
- 模拟服务器 500 错误

**测试步骤**:
1. 发送消息
2. 服务器返回错误
3. 观察错误处理

**预期结果**:
- ✅ 消息标记为失败
- ✅ 显示红色感叹号
- ✅ 可以点击重试
- ✅ 显示错误提示

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

### 1.3 消息重试机制

#### 用例 1.3.1: 失败消息重试
**优先级**: P0

**前置条件**:
- 有一条失败的消息

**测试步骤**:
1. 点击失败消息的红色感叹号
2. 观察重试流程
3. 恢复网络连接
4. 消息应该发送成功

**预期结果**:
- ✅ 点击后消息状态变为"发送中"
- ✅ 网络恢复后消息发送成功
- ✅ 状态变为绿色对勾
- ✅ 失败缓存被清理
- ✅ 重试次数正确记录

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 1.3.2: 重试次数限制
**优先级**: P1

**前置条件**:
- 有一条失败的消息
- 网络持续断开

**测试步骤**:
1. 点击重试（第1次）
2. 等待失败
3. 点击重试（第2次）
4. 等待失败
5. 点击重试（第3次）
6. 等待失败
7. 尝试第4次重试

**预期结果**:
- ✅ 前3次可以正常重试
- ✅ 第4次点击显示"重试次数已达上限"
- ✅ 重试图标变为禁用状态
- ✅ 5分钟后缓存自动清理

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

### 1.4 WebSocket 幂等性

#### 用例 1.4.1: 重复发送验证
**优先级**: P0

**前置条件**:
- 已登录系统
- 已选择会话
- 打开浏览器开发者工具

**测试步骤**:
1. 发送消息："幂等性测试"
2. 记录消息 ID 和时间戳
3. 快速再次发送相同消息
4. 检查消息列表

**预期结果**:
- ✅ 每条消息有唯一的 clientMsgId
- ✅ 相同内容的消息分别存储
- ✅ 无消息丢失
- ✅ 无消息重复

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

## ✅ Phase 2 测试用例

### 2.1 拖拽上传

#### 用例 2.1.1: 拖拽单张图片
**优先级**: P0

**测试步骤**:
1. 从文件管理器选择一张图片
2. 拖拽到输入框区域
3. 观察视觉反馈
4. 松开鼠标

**预期结果**:
- ✅ 拖拽时输入框显示蓝色边框
- ✅ 显示"松开即可发送文件"提示
- ✅ 松开后显示文件预览对话框
- ✅ 预览对话框显示图片缩略图
- ✅ 显示文件名和大小
- ✅ 可以添加描述
- ✅ 点击"发送"后文件上传成功

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 2.1.2: 拖拽多个文件
**优先级**: P1

**测试步骤**:
1. 选择3个文件（图片、PDF、Word）
2. 同时拖拽到输入框
3. 松开鼠标

**预期结果**:
- ✅ 预览对话框显示所有3个文件
- ✅ 每个文件显示正确的图标/缩略图
- ✅ 可以单独删除某个文件
- ✅ 点击发送后所有文件依次上传
- ✅ 显示上传进度

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 2.1.3: 拖拽非图片文件
**优先级**: P1

**测试步骤**:
1. 选择非图片文件（PDF、Word、Excel 等）
2. 拖拽到输入框
3. 松开鼠标

**预期结果**:
- ✅ 预览对话框正确显示
- ✅ 显示文件图标（不是缩略图）
- ✅ 显示文件类型和大小
- ✅ 可以上传成功

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 2.1.4: 取消拖拽上传
**优先级**: P2

**测试步骤**:
1. 拖拽文件到输入框
2. 在预览对话框中点击"取消"
3. 或删除所有文件后关闭

**预期结果**:
- ✅ 对话框关闭
- ✅ 文件未上传
- ✅ 界面恢复正常
- ✅ 无副作用

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

### 2.2 粘贴上传

#### 用例 2.2.1: 粘贴图片（截图）
**优先级**: P0

**测试步骤**:
1. 使用系统截图工具（Win: Win+Shift+S, Mac: Cmd+Shift+4）
2. 截取一张图片
3. 在输入框中按 Ctrl+V 粘贴

**预期结果**:
- ✅ 图片自动识别
- ✅ 显示预览对话框
- ✅ 显示图片缩略图
- ✅ 可以添加描述
- ✅ 发送成功

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 2.2.2: 粘贴文件（从文件管理器）
**优先级**: P1

**测试步骤**:
1. 在文件管理器中复制文件（Ctrl+C）
2. 在输入框中粘贴（Ctrl+V）

**预期结果**:
- ✅ 文件被识别
- ✅ 显示预览对话框
- ✅ 显示文件信息
- ✅ 发送成功

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 2.2.3: 粘贴多个文件
**优先级**: P2

**测试步骤**:
1. 在文件管理器中选择多个文件
2. 复制（Ctrl+C）
3. 在输入框中粘贴（Ctrl+V）

**预期结果**:
- ✅ 所有文件被识别
- ✅ 预览对话框显示所有文件
- ✅ 可以单独删除
- ✅ 批量上传成功

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 2.2.4: 粘贴文字 + 图片混合
**优先级**: P2

**测试步骤**:
1. 复制一段文字
2. 粘贴到输入框
3. 再粘贴一张图片

**预期结果**:
- ✅ 文字正常显示在输入框
- ✅ 图片显示预览对话框
- ✅ 两者互不干扰

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

### 2.3 上传进度显示

#### 用例 2.3.1: 上传进度条准确性
**优先级**: P0

**测试步骤**:
1. 上传一个大文件（10MB+）
2. 观察进度条变化

**预期结果**:
- ✅ 进度条从 0% 平滑增长到 100%
- ✅ 进度条有闪光动画效果
- ✅ 百分比数字准确
- ✅ 无跳跃或卡顿

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 2.3.2: 上传速度显示
**优先级**: P1

**测试步骤**:
1. 上传文件
2. 观察速度显示

**预期结果**:
- ✅ 显示实时速度（如 2.5 MB/s）
- ✅ 速度单位正确（B/s, KB/s, MB/s）
- ✅ 速度动态变化

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 2.3.3: 剩余时间估算
**优先级**: P2

**测试步骤**:
1. 上传多个文件
2. 观察剩余时间显示

**预期结果**:
- ✅ 显示预计剩余时间
- ✅ 时间格式正确（秒、分钟、小时）
- ✅ 时间动态更新
- ✅ 上传完成后显示完成

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 2.3.4: 取消上传
**优先级**: P1

**测试步骤**:
1. 开始上传文件
2. 点击进度对话框的关闭按钮

**预期结果**:
- ✅ 上传立即停止
- ✅ 文件未保存到服务器
- ✅ 界面恢复正常
- ✅ 可以重新上传

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

#### 用例 2.3.5: 多文件上传进度
**优先级**: P1

**测试步骤**:
1. 同时上传3个文件
2. 观察进度列表

**预期结果**:
- ✅ 显示总体进度（如 2/3）
- ✅ 每个文件有独立进度条
- ✅ 当前上传的文件高亮显示
- ✅ 已完成的文件显示绿色勾
- ✅ 失败的文件显示红色叉

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

## 🔧 边界条件测试

### 用例 BC.1: 网络切换
**优先级**: P1

**测试步骤**:
1. 在 WiFi 环境下发送消息
2. 切换到移动网络
3. 继续发送消息

**预期结果**:
- ✅ 网络切换不影响消息发送
- ✅ WebSocket 自动重连
- ✅ 未发送消息自动重试

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

### 用例 BC.2: 刷新页面
**优先级**: P0

**测试步骤**:
1. 发送一条消息（发送中状态）
2. 立即刷新页面（F5）
3. 观察消息状态

**预期结果**:
- ✅ 消息仍然显示
- ✅ 状态正确（成功/失败）
- ✅ 失败消息可以重试
- ✅ 无消息丢失

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

### 用例 BC.3: 大文件上传
**优先级**: P2

**测试步骤**:
1. 尝试上传 100MB 文件
2. 观察进度和性能

**预期结果**:
- ✅ 进度正常显示
- ✅ 浏览器不卡顿
- ✅ 上传成功
- ✅ 内存占用正常

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

### 用例 BC.4: 特殊字符文件名
**优先级**: P2

**测试步骤**:
1. 上传文件名包含特殊字符的文件（如 `测试文件(1).pdf`、`文件&文件.doc`）
2. 观察文件名显示

**预期结果**:
- ✅ 文件名正确显示
- ✅ 上传成功
- ✅ 无乱码

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

## 🌐 兼容性测试

### 浏览器兼容性

| 浏览器 | 版本 | 消息发送 | 文件上传 | 拖拽 | 粘贴 | 备注 |
|--------|------|----------|----------|------|------|------|
| Chrome | 120+ | ☐ | ☐ | ☐ | ☐ | 主测浏览器 |
| Edge | 120+ | ☐ | ☐ | ☐ | ☐ |  |
| Firefox | 120+ | ☐ | ☐ | ☐ | ☐ |  |
| Safari | 17+ | ☐ | ☐ | ☐ | ☐ | Mac 测试 |

---

## 📊 性能测试

### 用例 PERF.1: 消息发送性能
**测试步骤**:
1. 快速连续发送10条消息
2. 记录响应时间

**预期结果**:
- ✅ 每条消息响应时间 < 500ms
- ✅ 界面无卡顿
- ✅ 消息顺序正确

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

### 用例 PERF.2: 文件上传性能
**测试步骤**:
1. 上传10MB 文件
2. 记录上传时间

**预期结果**:
- ✅ 上传时间合理（取决于网络）
- ✅ CPU 占用 < 50%
- ✅ 内存占用增长 < 100MB

**实际结果**: _________________________

**状态**: ☐ 通过 ☐ 失败

---

## 📝 测试记录

### 测试执行记录

| 用例编号 | 测试人 | 执行时间 | 结果 | 备注 |
|----------|--------|----------|------|------|
| 1.1.1 |  | 2026-01-30 |  |  |
| 1.1.2 |  | 2026-01-30 |  |  |
| ... |  |  |  |  |

---

### 问题汇总

| 问题编号 | 严重程度 | 问题描述 | 发现人 | 状态 |
|----------|----------|----------|--------|------|
| BUG-001 | P0 |  |  | 待修复 |
| BUG-002 | P1 |  |  | 待修复 |

**严重程度定义**:
- P0: 阻塞性问题，必须修复
- P1: 重要问题，影响体验
- P2: 一般问题，可后续优化
- P3: 优化建议

---

## ✅ 测试完成标准

### 必须通过的用例
- 所有 P0 优先级用例 100% 通过
- P1 优先级用例 ≥ 90% 通过
- P2 优先级用例 ≥ 70% 通过

### 验收标准
1. ✅ 消息发送成功率 > 99%
2. ✅ 失败重试成功率 > 95%
3. ✅ 文件上传成功率 > 98%
4. ✅ 无 P0 级别遗留 Bug
5. ✅ P1 级别遗留 Bug < 3个

---

## 📞 测试支持

**测试环境**: http://localhost:5173
**测试账号**:
- 用户1: test1 / 123456
- 用户2: test2 / 123456

**问题反馈**: 记录到问题汇总表

---

**测试负责人**: _________________
**测试日期**: _________________
**签字**: _________________
