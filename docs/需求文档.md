# RuoYi-IM 企业即时通讯系统需求文档

> **项目定位**：内网部署的企业即时通讯系统，满足几十人规模企业的日常沟通需求
> **核心原则**：IM聊天功能做好，其他功能类似钉钉即可，不追求100%复刻

---

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | v2.0 |
| 创建日期 | 2025-01-08 |
| 更新日期 | 2026-01-16 |
| 项目状态 | 开发中 |

## UI参考版本

| 项目 | 版本 |
|------|------|
| UI设计参考 | 钉钉 PC 客户端 7.6.x (2024-2025) |
| 设计文档 | `docs/plans/2025-01-15-dingtalk-76-ui-design.md` |

---

## 一、项目概述

### 1.1 项目背景

**核心诉求**：企业需要一个内网部署的即时通讯系统，数据完全存储在企业内部服务器，保障数据安全。

适用场景：
- 几十人规模的内网办公环境
- 对数据安全有要求的企业（金融、政府、科研等）
- 需要与现有系统（若依权限系统）集成的场景

### 1.2 部署架构

```
┌─────────────────────────────────────────┐
│            企业内网环境                  │
│                                         │
│  ┌─────────────────────────────────┐   │
│  │  应用服务器                      │   │
│  │  - ruoyi-im-web (Vue 3 前端)    │   │
│  │  - ruoyi-im-api (Spring Boot)   │   │
│  │  - ruoyi-im-admin (若依管理后台) │   │
│  └─────────────────────────────────┘   │
│                    │                    │
│                    ▼                    │
│  ┌─────────────────────────────────┐   │
│  │  数据存储                        │   │
│  │  - MySQL（聊天记录、用户数据）   │   │
│  │  - Redis（在线状态、会话缓存）   │   │
│  │  - 本地文件系统（上传文件）      │   │
│  └─────────────────────────────────┘   │
│                                         │
│  ✅ 数据不经过任何第三方服务器          │
│  ✅ 完全内网部署                        │
└─────────────────────────────────────────┘
```

### 1.3 技术栈

| 层次 | 技术选型 | 版本 | 说明 |
|------|----------|------|------|
| **前端** | | | |
| 前端框架 | Vue 3 | 3.3.11 | 组合式API |
| UI组件库 | Element Plus | 2.4.4 | 企业级组件 |
| 构建工具 | Vite | 5.0.7 | 快速构建 |
| 状态管理 | Vuex | 4.1.0 | 全局状态 |
| 实时通信 | WebSocket | 原生API | 消息推送 |
| **后端** | | | |
| 后端框架 | Spring Boot | 2.7.18 | 基于若依 |
| ORM框架 | MyBatis Plus | 3.5.3 | 数据访问 |
| 安全框架 | Spring Security + JWT | - | 权限认证 |
| 缓存 | Redis | 3.0+ | 状态缓存 |
| 数据库 | MySQL | 5.7/8.0 | 数据持久化 |

---

## 二、功能范围

### 2.1 功能优先级

| 优先级 | 定义 | 包含模块 |
|--------|------|----------|
| **P0** | 核心功能，必须做好 | 消息聊天、群聊、通讯录 |
| **P1** | 重要功能，类似钉钉即可 | 工作台（考勤/审批/日程）、DING消息 |
| **P2** | 扩展功能，可延后 | 邮箱、文档协作、视频通话 |

### 2.2 P0核心功能（必须做好）

#### 消息模块

| 功能 | 说明 | 状态 |
|------|------|------|
| 单聊 | 一对一消息收发 | ✅ 基本完成 |
| 群聊 | 多人群组聊天 | ✅ 基本完成 |
| 消息类型 | 文本、图片、文件、表情 | ✅ 基本完成 |
| 消息状态 | 发送中/已发送/已读 | ✅ 基本完成 |
| 消息撤回 | 2分钟内可撤回 | ✅ 基本完成 |
| 消息转发 | 单条/合并转发 | ⚠️ 待完善 |
| 会话列表 | 最近消息、置顶、免打扰 | ✅ 基本完成 |

#### 通讯录模块

| 功能 | 说明 | 状态 |
|------|------|------|
| 组织架构 | 企业-部门-成员层级 | ✅ 基本完成 |
| 好友关系 | 添加好友、好友列表 | ✅ 基本完成 |
| 成员搜索 | 按姓名/手机号搜索 | ✅ 基本完成 |
| 在线状态 | 显示好友在线/离线 | ✅ 基本完成 |

### 2.3 P1功能（类似钉钉即可）

#### 工作台模块

| 功能 | 说明 | 状态 |
|------|------|------|
| 考勤打卡 | 上班/下班打卡 | ✅ 基本完成 |
| 审批流程 | 请假/报销/出差审批 | ✅ 基本完成 |
| 日程管理 | 日程创建、提醒 | ✅ 基本完成 |
| 工作报告 | 日志提交、查看 | ✅ 基本完成 |

#### DING消息

| 功能 | 说明 | 状态 |
|------|------|------|
| DING发送 | 重要消息强提醒 | ✅ 基本完成 |
| 已读回执 | 查看DING已读状态 | ✅ 基本完成 |

### 2.4 P2功能（可延后）

| 功能 | 说明 | 状态 |
|------|------|------|
| 邮箱 | 收发邮件 | ⚠️ 后端完成，前端待开发 |
| 文档协作 | 在线文档、多人编辑 | ⚠️ 部分完成 |
| 视频通话 | WebRTC视频通话 | ⚠️ 后端完成，前端待开发 |

---

## 三、系统架构

### 3.1 模块结构

```
ruoyi-im-web/           # 前端（Vue 3）
├── src/
│   ├── views/im/       # 聊天界面
│   ├── views/workbench/# 工作台
│   ├── store/          # Vuex状态管理
│   └── utils/          # 工具函数

ruoyi-im-api/           # 后端API（Spring Boot）
├── src/main/java/com/ruoyi/im/
│   ├── controller/     # REST API
│   ├── service/        # 业务逻辑
│   ├── mapper/         # 数据访问
│   ├── domain/         # 实体类
│   └── websocket/      # WebSocket端点

ruoyi-im-admin/         # 管理后台（若依）
```

### 3.2 前后端交互

```
前端 (Vue 3)  ──HTTP──►  后端 (Spring Boot)
                         ├── MessageController  (消息)
                         ├── ConversationController (会话)
                         ├── ContactController (联系人)
                         └── GroupController (群组)

前端 (WebSocket) ──实时──► 后端 WebSocket端点
                         ├── 消息推送
                         ├── 在线状态
                         └── 已读回执
```

### 3.3 核心数据表

```
# 消息相关
im_message              # 消息表
im_conversation         # 会话表
im_conversation_member  # 会话成员表

# 群组相关
im_group                # 群组表
im_group_member         # 群组成员表

# 联系人相关
im_friend               # 好友关系表
im_friend_request       # 好友申请表
im_department           # 部门表

# 工作台相关
im_attendance           # 考勤记录
im_approval             # 审批流程
im_schedule_event       # 日程事件

# 系统相关
im_user                 # 用户表
im_config               # 用户配置
```

---

## 四、性能要求

针对几十人规模的内网环境：

| 指标 | 要求 | 说明 |
|------|------|------|
| 消息推送延迟 | ≤500ms | WebSocket实时推送 |
| 页面加载时间 | ≤3s | 首屏渲染 |
| 并发在线用户 | ≥100人 | 满足内网几十人需求 |
| 文件上传 | ≤100MB | 单文件大小限制 |

---

## 五、安全要求

| 安全措施 | 实现方式 |
|----------|----------|
| 网络隔离 | 内网部署，不暴露公网 |
| 传输加密 | HTTPS/WSS加密传输 |
| 权限控制 | 基于若依的RBAC权限 |
| 数据加密 | 敏感数据AES-256加密 |
| 操作审计 | 记录关键操作日志 |

---

## 六、验收标准

### IM核心功能验收

1. **消息收发**
   - [ ] 文本消息发送/接收正常
   - [ ] 图片/文件上传/下载正常
   - [ ] 消息状态（发送中/已发送/已读）正确

2. **群聊功能**
   - [ ] 创建群组正常
   - [ ] 群成员管理（添加/移除）正常
   - [ ] 群消息正常推送

3. **通讯录**
   - [ ] 组织架构显示正常
   - [ ] 好友添加/列表正常
   - [ ] 在线状态正确显示

### 工作台功能验收

1. **考勤打卡**
   - [ ] 上班/下班打卡正常
   - [ ] 打卡记录查询正常

2. **审批流程**
   - [ ] 创建审批正常
   - [ ] 审批流程流转正常

---

## 七、当前进度

| 模块 | 后端 | 前端 | 整体 |
|------|------|------|------|
| 消息模块 | 98% | 95% | 96% |
| 通讯录 | 95% | 75% | 85% |
| 工作台 | 95% | 95% | 95% |
| 群组 | 95% | 95% | 95% |
| DING消息 | 90% | 85% | 88% |

**整体完成度**：约 94%

---

## 八、待完成事项

### P0（必须完成）
1. [ ] 消息前端API对接（部分组件）
2. [ ] 群组功能完善

### P1（重要功能）
1. [ ] 视频通话前端UI
2. [ ] 邮箱前端开发

### P2（可延后）
1. [ ] 文档实时协作
2. [ ] 应用中心

---

## 九、参考文档

| 文档 | 说明 |
|------|------|
| `需求与代码差距分析报告.md` | 项目进度详细分析 |
| `数据库架构文档.md` | 数据表结构详细设计 |
| `API接口文档.md` | 后端API接口清单 |
| `部署运维指南.md` | 部署和运维说明 |
| `plans/2025-01-15-dingtalk-76-ui-design.md` | 钉钉 7.6.x UI设计规范 |
| `plans/2025-01-16-im-admin-layout-design.md` | 管理后台UI设计 |

---

## 变更记录

| 版本 | 日期 | 变更内容 |
|------|------|----------|
| v2.0 | 2026-01-16 | 重写文档，聚焦IM核心，简化功能范围 |
| v1.0 | 2025-01-08 | 初始版本，追求100%复刻钉钉 |
