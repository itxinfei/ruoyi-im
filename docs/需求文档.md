# 钉钉5.6 Web版复刻需求规格说明书

> **项目定位**: 100%复刻钉钉PC 5.6版本的Web版即时通讯与协同办公系统
> **技术架构**: 前端Vue 3 + 后端若依框架（RuoYi）
> **部署方式**: 私有化部署，数据自主管控

## 文档信息

| 项目 | 内容 |
|------|------|
| 文档版本 | v3.0 |
| 创建日期 | 2025-01-08 |
| 更新日期 | 2026-01-14 |
| 参考版本 | 钉钉PC 5.6 |
| 文档状态 | 钉钉5.6对齐版 |

---

## 一、项目概述

### 1.1 项目背景

**核心诉求：数据安全，内网部署**

随着企业数字化转型的深入，即时通讯已成为企业协同办公的基础设施。然而，使用第三方公共IM服务（如钉钉、企业微信等）存在以下**数据安全隐患**：

| 风险类型 | 具体描述 |
|----------|----------|
| **数据外泄风险** | 聊天记录、文件传输等企业核心数据存储在第三方服务器 |
| **不可控风险** | 无法控制数据的访问权限、存储位置、销毁方式 |
| **合规风险** | 某些行业（金融、政府、军工）禁止数据外传 |
| **依赖风险** | 依赖外部服务，服务中断影响业务连续性 |

**解决方案**：本项目开发一个**Web版钉钉5.6的完整复刻版本**，部署在企业**内网服务器**上，所有数据（聊天记录、文件、用户信息等）完全存储在企业自有服务器中，从根本上杜绝数据外泄风险。

### 1.2 项目目标

**100%复刻钉钉PC 5.6版本**，在浏览器中实现原生应用般的体验：

| 维度 | 目标描述 |
|------|----------|
| **UI一致性** | 像素级复刻钉钉5.6的界面布局、颜色、字体、图标、动画效果 |
| **功能完整性** | 消息、DING、工作台、通讯录、文档、应用中心、邮箱全覆盖 |
| **交互一致性** | 完全复刻钉钉5.6的操作逻辑、快捷键、右键菜单、拖拽交互 |
| **业务逻辑一致性** | 消息流转、审批流程、考勤规则等业务逻辑与钉钉5.6保持一致 |
| **数据安全性** | **内网部署，数据不经过任何第三方服务器，完全自主管控** |

### 1.3 部署架构（内网隔离）

```
┌─────────────────────────────────────────────────────────────┐
│                    企业内网环境（隔离）                        │
│                                                              │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              应用服务器（内网）                        │   │
│  │  ┌───────────────────────────────────────────────┐  │   │
│  │  │  ruoyi-im-web (Vue 3 前端)                    │  │   │
│  │  │  员工通过内网IP访问                           │  │   │
│  │  └───────────────────────────────────────────────┘  │   │
│  │  ┌───────────────────────────────────────────────┐  │   │
│  │  │  ruoyi-im-api (Spring Boot 后端)              │  │   │
│  │  │  - WebSocket服务                              │  │   │
│  │  │  - RESTful API                               │  │   │
│  │  └───────────────────────────────────────────────┘  │   │
│  │  ┌───────────────────────────────────────────────┐  │   │
│  │  │  ruoyi-im-admin (若依管理后台)                 │  │   │
│  │  │  系统管理、用户管理、权限管理                 │  │   │
│  │  └───────────────────────────────────────────────┘  │   │
│  └─────────────────────────────────────────────────────┘   │
│                           │                                   │
│                           ▼                                   │
│  ┌─────────────────────────────────────────────────────┐   │
│  │              数据存储（内网服务器）                    │   │
│  │  - MySQL（聊天记录、用户数据、业务数据）              │   │
│  │  - Redis（在线状态、会话缓存）                       │   │
│  │  - 本地文件系统（上传文件、图片、视频）               │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                              │
│  ❌ 与外网隔离 - 数据不经过任何第三方服务器                   │
│  ❌ 不依赖云服务 - 所有服务部署在内网                         │
│  ✅ 完全自主管控 - 企业拥有数据的完全控制权                   │
└─────────────────────────────────────────────────────────────┘
```

### 1.4 数据安全保证

| 安全措施 | 实现方式 |
|----------|----------|
| **网络隔离** | 部署在企业内网，与外网物理/逻辑隔离 |
| **数据存储** | 所有数据存储在内网服务器，不经过任何第三方 |
| **访问控制** | 基于若依框架的权限管理，细粒度控制访问权限 |
| **传输加密** | 内网环境可选启用HTTPS/WSS加密传输 |
| **数据加密** | 敏感数据支持AES-256加密存储 |
| **审计日志** | 完整记录用户操作，可追溯任何数据访问 |
| **备份恢复** | 支持内网备份策略，数据不离开内网 |

### 1.5 技术选型

#### 1.5.1 整体架构

本项目采用**双前端架构**设计，针对不同用户群体使用不同的技术栈：

```
┌─────────────────────────────────────────────────────────────┐
│                     用户端前端（Vue 3 + Element Plus）         │
│              ruoyi-im-web - 企业员工日常使用界面               │
├─────────────────────────────────────────────────────────────┤
│  IM聊天界面  │  工作台  │  审批中心  │  通讯录  │  应用中心    │
├─────────────────────────────────────────────────────────────┤
│                     后端层（Spring Boot 2.7）                 │
├───────────────┬──────────────────────────────────────────────┤
│ ruoyi-im-api  │      ruoyi-im-admin (若依管理后台)            │
│  核心业务API   │      平台管理模块（Thymeleaf + jQuery）      │
├───────────────┴──────────────────────────────────────────────┤
│                   ruoyi-common / ruoyi-framework              │
│                    公共基础组件/框架层                         │
├─────────────────────────────────────────────────────────────┤
│              数据层（MySQL + Redis + 文件存储）                │
└─────────────────────────────────────────────────────────────┘
```

#### 1.5.2 用户端技术栈（ruoyi-im-web）

| 层次 | 技术选型 | 版本 | 说明 |
|------|----------|------|------|
| 前端框架 | Vue 3 | 3.3.11 | 采用组合式API，TypeScript开发 |
| UI组件库 | Element Plus | 2.4.4 | 企业级UI组件库 |
| 构建工具 | Vite | 5.0.7 | 快速构建与热更新 |
| 状态管理 | Vuex | 4.1.0 | 全局状态管理 |
| 路由管理 | Vue Router | 4.2.5 | 单页面路由 |
| HTTP请求 | Axios | 1.6.2 | HTTP客户端 |
| 实时通信 | WebSocket | - | 原生WebSocket API |
| 富文本编辑 | Quill | 1.3.7 | 消息格式化编辑 |
| 国际化 | Vue I18n | 9.8.0 | 多语言支持 |
| 工具库 | Lodash-es | 4.17.21 | JavaScript工具库 |
| 加密库 | JSEncrypt | 3.3.2 | RSA加密 |
| 日期处理 | Day.js | 1.11.10 | 日期时间处理 |

#### 1.5.3 管理后台技术栈（ruoyi-im-admin）

| 层次 | 技术选型 | 版本 | 说明 |
|------|----------|------|------|
| 后端框架 | Spring Boot | 2.7.18 | 基于若依框架 |
| 模板引擎 | Thymeleaf | - | 服务端渲染 |
| 前端框架 | jQuery | - | DOM操作与交互 |
| 安全框架 | Spring Security + JWT | - | 权限认证与授权 |
| 持久层 | MyBatis | - | 数据访问层 |
| 数据库连接池 | Druid | 1.2.23 | 阿里数据库连接池 |
| 分页插件 | PageHelper | 1.4.7 | MyBatis分页插件 |
| API文档 | Swagger | 3.0.0 | 接口文档生成 |
| 日志框架 | Logback | 1.2.13 | 日志记录 |
| 工具库 | Lombok | 1.18.30 | 简化Java代码 |
| JSON解析 | FastJSON | 1.2.83 | 阿里JSON解析器 |

#### 1.5.4 核心通信技术栈

| 技术组件 | 技术选型 | 版本 | 说明 |
|----------|----------|------|------|
| 实时通信 | WebSocket + Netty | - | 高性能双向通信 |
| 消息队列 | Redis List | 3.0+ | 异步消息推送 |
| 缓存中间件 | Redis | 3.0+ | 用户状态、未读消息计数 |
| 数据库 | MySQL | 5.7.44 | 数据持久化 |
| 文件存储 | 本地文件系统 | - | 基础版文件存储 |

---

## 二、产品定位与核心特性

### 2.1 产品定义

面向中大型企业的私有化即时通讯与协同办公平台，支持本地服务器/私有云部署，提供组织管理、即时通讯、工作台、审批流转、应用聚合等核心能力，实现企业数据全量自主管控。

### 2.2 核心特性

#### 2.2.1 私有化部署
- 支持本地服务器/私有云部署
- 数据全量存储于企业自有服务器
- 支持部署环境隔离（开发/测试/生产）
- 生产环境可关闭外部网络访问

#### 2.2.2 完整IM能力
- 单聊、群聊消息收发
- 消息回执与已读状态
- 文件/图片传输
- 消息撤回/编辑
- 聊天记录查询

#### 2.2.3 灵活组织架构
- 复用若依sys_dept/sys_user实现企业-部门-成员层级管理
- 支持自定义组织架构配置
- 支持组织架构同步与导入

#### 2.2.4 协同办公能力
- 可定制化工作台
- 审批流程引擎
- 应用中心聚合

### 2.3 适用场景

| 场景 | 描述 |
|------|------|
| 数据敏感型企业 | 金融、政府、科研等对数据安全要求高的行业 |
| 内部协同需求 | 需要统一通讯与办公平台的中大型企业 |
| 系统集成需求 | 需要将通讯能力与企业现有系统集成的场景 |

---

## 三、系统架构设计

### 3.1 模块划分

```
┌─────────────────────────────────────────────────────────────┐
│              用户端前端（ruoyi-im-web - Vue 3）              │
│  IM聊天界面 │ 工作台 │ 审批中心 │ 通讯录 │ 应用中心 │ 文档中心 │
├─────────────────────────────────────────────────────────────┤
│              管理后台前端（ruoyi-im-admin - Thymeleaf）      │
│              系统管理 │ 用户管理 │ 角色管理 │ 菜单管理        │
├─────────────────────────────────────────────────────────────┤
│                     后端层（Spring Boot 2.7）                 │
├───────────────┬──────────────────────────────────────────────┤
│ ruoyi-im-api  │      ruoyi-im-admin (若依管理后台)            │
│  核心业务API   │      平台管理模块                            │
│  - 消息服务    │      - 用户审核                              │
│  - 好友服务    │      - 群组管控                              │
│  - 群组服务    │      - 消息审计                              │
│  - 审批服务    │      - 系统配置                              │
│  - 文档服务    │                                              │
├───────────────┴──────────────────────────────────────────────┤
│                   ruoyi-common / ruoyi-framework              │
│                    公共基础组件/框架层                         │
│  - 工具类库    │  - 安全框架（Shiro）                        │
│  - 异常处理    │  - 日志框架（Logback）                       │
│  - 数据库配置    │  - Redis配置                               │
├─────────────────────────────────────────────────────────────┤
│              数据层（MySQL + Redis + 文件存储）                │
│  - 用户数据    │  - 消息数据                                  │
│  - 好友关系    │  - 群组数据                                  │
│  - 审批流程    │  - 文档数据                                  │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 核心模块说明

| 模块 | 技术栈 | 定位 | 主要职责 |
|------|--------|------|----------|
| ruoyi-im-web | Vue 3 + Element Plus | 用户端前端 | IM聊天界面、工作台、审批中心、通讯录、应用中心、文档中心等企业员工日常使用界面 |
| ruoyi-im-admin | Thymeleaf + jQuery | 管理后台前端 | 系统管理、用户管理、角色管理、菜单管理等管理员操作界面 |
| ruoyi-im-api | Spring Boot | 核心业务中台 | 提供用户认证、好友关系、消息收发、群组管理、审批流程、文档协作等核心接口 |
| ruoyi-system | Spring Boot | 若依系统模块 | 复用若依的用户管理、角色管理、部门管理、菜单管理等基础功能 |
| ruoyi-common | Java | 公共工具模块 | 提供通用工具类、异常处理、常量定义等公共能力 |
| ruoyi-framework | Spring Boot | 框架集成模块 | 集成Shiro、MyBatis、Redis、Swagger等框架配置 |

### 3.3 模块间关系

```
用户端调用关系：
ruoyi-im-web (Vue 3)  -->  ruoyi-im-api  -->  ruoyi-system

管理后台调用关系：
ruoyi-im-admin (Thymeleaf)  -->  ruoyi-im-admin (后端)  -->  ruoyi-system

独立关系：
ruoyi-im-api  ⊥  ruoyi-im-admin (无接口调用，数据独立)
```

### 3.4 前后端交互架构

```
┌─────────────────────────────────────────────────────────────┐
│                    用户端（ruoyi-im-web）                     │
│  Vue 3 + Element Plus + Vite                                │
│  - RESTful API调用（Axios）                                  │
│  - WebSocket实时通信（原生WebSocket API）                     │
└────────────────────┬────────────────────────────────────────┘
                     │
        ┌────────────┴────────────┐
        │                         │
        ▼                         ▼
┌──────────────────┐    ┌──────────────────┐
│  HTTP接口        │    │  WebSocket接口   │
│  (Spring MVC)   │    │  (Netty Server)  │
└──────────────────┘    └──────────────────┘
        │                         │
        └────────────┬────────────┘
                     ▼
        ┌──────────────────────────┐
        │   ruoyi-im-api          │
        │   - MessageController  │
        │   - ContactController   │
        │   - GroupController     │
        │   - ApprovalController  │
        └──────────────────────────┘
                     │
                     ▼
        ┌──────────────────────────┐
        │   Service层             │
        │   - MessageService      │
        │   - ContactService       │
        │   - GroupService         │
        │   - ApprovalService      │
        └──────────────────────────┘
                     │
                     ▼
        ┌──────────────────────────┐
        │   Mapper层              │
        │   - MessageMapper       │
        │   - ContactMapper       │
        │   - GroupMapper         │
        │   - ApprovalMapper      │
        └──────────────────────────┘
                     │
                     ▼
        ┌──────────────────────────┐
        │   数据存储层            │
        │   - MySQL 5.7.44         │
        │   - Redis 3.0+           │
        │   - 本地文件系统         │
        └──────────────────────────┘
```

---

## 四、功能需求说明（完全复刻钉钉PC 5.6功能）

> **复刻原则**：本章节功能模块100%对应钉钉PC 5.6客户端实际功能，确保Web版本功能完整性。

### 4.0 复刻范围声明

本项目100%复刻钉钉PC 5.6版本的以下模块：

| 序号 | 模块 | 复刻内容 | 备注 |
|------|------|----------|------|
| 1 | 消息模块 | 单聊、群聊、消息收发、多媒体消息、消息状态、已读回执 | 核心模块 |
| 2 | DING消息 | DING发送、强提醒、定时发送、已读回执 | 核心模块 |
| 3 | 工作台 | 考勤打卡、审批流程、公告通知、日志系统、日程管理 | 核心模块 |
| 4 | 通讯录 | 企业组织架构、联系人、部门管理 | 核心模块 |
| 5 | 文档 | 在线文档、在线表格、协作编辑、版本历史 | 核心模块 |
| 6 | 邮箱 | 收发邮件、邮件管理 | 核心模块 |
| 7 | 应用中心 | 应用市场、应用管理 | 核心模块 |

### 4.0.1 功能优先级定义

| 优先级 | 定义 | 实现要求 | 交付标准 |
|--------|------|----------|----------|
| **P0** | 核心功能，系统必须具备的基础能力 | 必须完整实现，不可裁减 | 功能完整，测试通过，无已知严重Bug |
| **P1** | 重要功能，提升用户体验的关键特性 | 建议完整实现，可根据实际情况简化 | 功能完整，测试通过，允许非严重Bug |
| **P2** | 增强功能，锦上添花的特性 | 可根据项目进度选择性实现 | 功能基本可用，允许已知小Bug |

#### 4.0.1 功能优先级详细划分

| 模块 | 子模块 | 功能点 | 优先级 | 实现说明 |
|------|--------|--------|--------|----------|
| **消息模块** | 核心消息 | 单聊消息收发 | P0 | 文本、图片、文件、表情，必须完整实现 |
| **消息模块** | 核心消息 | 群聊消息收发 | P0 | 群组创建、成员管理、消息广播 |
| **消息模块** | 核心消息 | 消息已读回执 | P0 | 消息送达状态、已读状态显示 |
| **消息模块** | 核心消息 | 消息撤回 | P0 | 2分钟内可撤回，超时不可撤回 |
| **消息模块** | 消息类型 | 图片消息 | P0 | 支持JPG、PNG、GIF，最大10MB |
| **消息模块** | 消息类型 | 文件消息 | P0 | 支持常用文档格式，最大100MB |
| **消息模块** | 消息类型 | 语音消息 | P1 | 录制组件已完成，支持按住录制、试听、发送 |
| **消息模块** | 消息类型 | 视频消息 | P1 | MP4格式，最大50MB |
| **消息模块** | 语音通话 | 一对一语音 | P1 | 浮动窗口、静音/扬声器切换、通话计时 |
| **消息模块** | 视频通话 | 一对一视频 | P1 | WebRTC实现，支持音视频通话 |
| **消息模块** | 消息类型 | 位置消息 | P1 | 地图定位，位置分享 |
| **消息模块** | 会话管理 | 会话列表 | P0 | 最近消息预览，按时间排序 |
| **消息模块** | 会话管理 | 置顶会话 | P0 | 重要会话置顶显示 |
| **消息模块** | 会话管理 | 会话免打扰 | P0 | 单会话免打扰设置 |
| **消息模块** | 会话管理 | 消息搜索 | P1 | 按关键词、时间范围搜索聊天记录 |
| **消息模块** | 消息扩展 | 消息转发 | P0 | 单条转发、合并转发 |
| **消息模块** | 消息扩展 | 消息收藏 | P0 | 收藏重要消息 |
| **消息模块** | 消息扩展 | 消息回复 | P0 | 引用回复特定消息 |
| **消息模块** | 消息扩展 | 消息编辑 | P1 | 2分钟内可编辑 |
| **消息模块** | 消息状态 | 发送状态追踪 | P0 | 发送中/已发送/已读/发送失败状态显示 |
| **通讯录模块** | 组织架构 | 树形架构展示 | P0 | 企业-部门-成员三级结构 |
| **通讯录模块** | 组织架构 | 部门管理 | P0 | 部门查看、成员列表 |
| **通讯录模块** | 成员管理 | 成员搜索 | P0 | 按姓名、部门、职位搜索 |
| **通讯录模块** | 成员管理 | 成员详情 | P0 | 头像、职位、联系方式展示 |
| **通讯录模块** | 好友关系 | 添加好友 | P0 | 发起好友申请 |
| **通讯录模块** | 好友关系 | 好友列表 | P0 | 显示已添加好友 |
| **通讯录模块** | 好友关系 | 黑名单 | P1 | 屏蔽指定用户消息 |
| **工作台模块** | 应用中心 | 应用卡片 | P0 | 常用应用快捷入口 |
| **工作台模块** | 应用中心 | 应用管理 | P1 | 应用添加、排序、移除 |
| **工作台模块** | 考勤打卡 | 上下班打卡 | P0 | 定位打卡（需要定位权限） |
| **工作台模块** | 考勤打卡 | 打卡记录 | P0 | 历史打卡记录查询 |
| **工作台模块** | 审批流程 | 请假审批 | P0 | 请假申请、审批流程 |
| **工作台模块** | 审批流程 | 报销审批 | P1 | 报销申请、审批流程 |
| **工作台模块** | 审批流程 | 出差审批 | P1 | 出差申请、审批流程 |
| **工作台模块** | 审批流程 | 自定义审批 | P1 | 企业自定义审批流程 |
| **工作台模块** | 公告通知 | 发布公告 | P0 | 公告发布、附件上传 |
| **工作台模块** | 公告通知 | 公告阅读 | P0 | 公告查看、已读统计 |
| **工作台模块** | 日志系统 | 日志撰写 | P0 | 工作日志提交 |
| **工作台模块** | 日志系统 | 日志查看 | P0 | 查看下属日志 |
| **工作台模块** | 日程管理 | 日程创建 | P0 | 日程安排、时间提醒 |
| **工作台模块** | 日程管理 | 日程分享 | P0 | 分享日程给同事 |
| **DING消息** | 核心功能 | DING发送 | P1 | 重要消息强提醒 |
| **DING消息** | 核心功能 | 定时DING | P1 | 定时发送提醒消息 |
| **DING消息** | 核心功能 | 已读回执 | P1 | 查看DING消息已读状态 |
| **文档模块** | 在线文档 | 文档创建 | P1 | 富文本文档创建 |
| **文档模块** | 在线文档 | 多人协作 | P1 | 实时协作编辑 |
| **文档模块** | 在线表格 | 表格创建 | P1 | Excel式表格 |
| **文档模块** | 协作功能 | 版本历史 | P1 | 查看历史版本 |
| **文档模块** | 协作功能 | 评论功能 | P1 | 文档内评论 |
| **邮箱模块** | 核心功能 | 收发邮件 | P2 | 基础邮件功能 |
| **应用中心** | 应用市场 | 应用浏览 | P2 | 应用列表展示 |
| **应用中心** | 应用市场 | 应用安装 | P2 | 一键安装应用 |

### 4.1 钉钉PC 5.6左侧导航栏（100%复刻）

钉钉PC 5.6客户端左侧导航栏包含以下核心功能入口（按从上到下顺序）：

| 序号 | 功能模块 | 钉钉5.6功能说明 | 复刻要求 |
|------|----------|----------------|----------|
| 1 | **消息** | 单聊、群聊、消息收发、多媒体消息、多端同步 | 100%复刻 |
| 2 | **DING** | 重要通知、短信/电话提醒、定时提醒、已读回执 | 100%复刻 |
| 3 | **工作台** | 企业办公应用中心、考勤打卡、审批、公告、应用管理 | 100%复刻 |
| 4 | **文档** | 在线文档、在线表格、白板、脑图、协作编辑 | 100%复刻 |
| 5 | **通讯录** | 企业组织架构、联系人、部门管理 | 100%复刻 |
| 6 | **邮箱** | 邮箱、消息助手提醒 | 100%复刻 |
| 7 | **应用中心** | 应用市场、企业定制应用 | 100%复刻 |

### 4.2 消息模块（100%复刻钉钉5.6消息功能）

#### 4.2.1 核心功能
| 功能点 | 钉钉5.6功能说明 | Web实现要求 |
|--------|--------------|----------|
| 单聊 | 一对一即时通讯 | 支持文本、表情、图片、文件发送，Enter发送，Shift+Enter换行 |
| 群聊 | 多人群组聊天 | 支持创建群组、添加/移除成员、群公告、群文件 |
| 消息类型 | 文字、表情、图片、文件、语音、视频、位置 | 按钉钉5.6标准实现 |
| 消息状态 | 发送中、已发送、已读/未读、发送失败 | 显示消息发送状态，支持重试 |
| 消息操作 | 撤回（2分钟内）、转发、复制、收藏、删除 | 完全复刻钉钉5.6交互逻辑 |
| 多端同步 | PC端与移动端消息同步 | 基于WebSocket实现实时同步 |
| 消息搜索 | 搜索聊天记录 | 按关键词、时间范围搜索 |
| 语音通话 | 一对一语音通话 | 浮动窗口UI，支持静音、扬声器切换、通话计时 |
| 视频通话 | 一对一视频通话 | WebRTC实现，支持音视频通话 |
| 语音消息 | 按住录制语音 | 支持按住录制、试听、发送，可锁定录音模式 |
| @提及 | @群成员提醒 | 完全复刻钉钉5.6的@体验 |
| 表情回应 | 消息表情反应 | 支持对消息进行表情回应 |

#### 4.2.2 会话列表功能（钉钉5.6样式）
| 功能点 | 钉钉5.6样式说明 | Web实现要求 |
|--------|--------------|----------|
| 最近会话 | 按时间倒序排列，显示最新消息预览 | 样式完全一致 |
| 置顶会话 | 重要会话可置顶，保持在列表顶部 | 样式完全一致 |
| 消息免打扰 | 对单个会话设置免打扰，不显示消息提醒 | 样式完全一致 |
| 会话分组 | 支持按"全部"、"单聊"、"群聊"筛选 | 样式完全一致 |

### 4.3 DING消息模块（100%复刻钉钉5.6 DING功能）

#### 4.3.1 核心功能
| 功能点 | 钉钉5.6功能说明 | Web实现要求 |
|--------|--------------|----------|
| DING发送 | 支持文字、语音、图片、文件，一键发送给单人或群组 | 完全复刻UI和交互 |
| 强提醒方式 | 支持应用内提醒、短信提醒、电话提醒（强提醒功能） | Web版使用应用内+浏览器通知 |
| 定时发送 | 设置定时发送DING，重要事项不遗漏 | 完全复刻 |
| 已读回执 | 查看DING消息的已读/未读状态 | 完全复刻UI |
| DING模板 | 常用DING模板（会议提醒、工作安排等） | 完全复刻 |
| 消息额度 | 企业DING消息额度管理 | 完全复刻 |

### 4.4 工作台模块（100%复刻钉钉5.6工作台）

#### 4.4.1 核心功能
| 子模块 | 钉钉5.6功能说明 | Web实现要求 |
|--------|--------------|----------|
| **考勤打卡** | 上班打卡、下班打卡、外勤打卡、打卡记录查看 | 完全复刻UI和流程 |
| **审批** | 请假审批、报销审批、出差审批、自定义审批流程 | 完全复刻UI和流程 |
| **公告** | 企业公告发布、已读/未读统计、公告附件 | 完全复刻UI |
| **日志** | 工作日志提交、日志查看、日志点评 | 完全复刻UI |
| **日程** | 日程安排、会议邀请、日程提醒 | 完全复刻UI |
| **任务** | 任务分配、任务跟踪、任务统计 | 完全复刻UI |

#### 4.4.2 应用管理（钉钉5.6样式）
| 功能点 | 钉钉5.6样式说明 | Web实现要求 |
|--------|--------------|----------|
| 常用应用 | 设置常用应用快捷入口，一键访问 | 完全复刻布局 |
| 应用添加 | 从应用中心添加应用到工作台 | 完全复刻交互 |
| 应用排序 | 自定义应用显示顺序 | 完全复刻拖拽 |

### 4.5 文档模块（100%复刻钉钉5.6文档功能）

#### 4.5.1 核心功能
| 子功能 | 钉钉5.6功能说明 | Web实现要求 |
|--------|--------------|----------|
| **在线文档** | 富文本文档协作编辑，支持评论、修订 | 完全复刻编辑器UI |
| **在线表格** | Excel式表格协作，支持公式、图表 | 完全复刻表格UI |
| **表单** | 在线表单收集、数据汇总分析 | 完全复刻表单UI |
| **白板** | 在线白板协作，支持绘图、贴纸 | 完全复刻白板UI |
| **脑图** | 思维导图，支持多人协作编辑 | 完全复刻脑图UI |

#### 4.5.2 协作功能
| 功能点 | 钉钉5.6样式说明 | Web实现要求 |
|--------|--------------|----------|
| 实时协作 | 多人同时编辑，显示光标位置 | WebSocket实现 |
| 协作光标 | 显示协作者头像和名字 | 完全复刻样式 |
| 评论@ | 对文档内容评论，@成员通知 | 完全复刻交互 |
| 版本历史 | 查看文档历史版本，支持版本对比 | 完全复刻UI |

### 4.6 通讯录模块（100%复刻钉钉5.6通讯录）

#### 4.6.1 核心功能
| 功能点 | 钉钉5.6样式说明 | Web实现要求 |
|--------|--------------|----------|
| **企业组织架构** | 树形展示企业-部门-成员层级结构 | 完全复刻树形UI |
| **部门管理** | 查看部门成员、部门信息 | 完全复刻列表UI |
| **成员搜索** | 按姓名、部门、职位搜索成员 | 完全复刻搜索UI |
| **成员详情** | 查看成员头像、职位、联系方式 | 完全复刻详情卡片 |
| **添加好友** | 向企业成员发起好友申请 | 完全复刻申请流程 |

### 4.7 邮箱模块（100%复刻钉钉5.6邮箱）

#### 4.7.1 核心功能
| 功能点 | 钉钉5.6样式说明 | Web实现要求 |
|--------|--------------|----------|
| 收件箱 | 查看收到的邮件 | 完全复刻邮件列表UI |
| 发件箱 | 查看已发送的邮件 | 完全复刻邮件列表UI |
| 写邮件 | 编辑和发送邮件 | 完全复刻编辑器UI |
| 邮件附件 | 支持附件上传和下载 | 完全复刻附件UI |
| 邮件提醒 | 新邮件红点提醒 | 完全复刻提醒样式 |

### 4.8 用户反馈模块（新增功能）

#### 4.8.1 核心功能
| 功能点 | 说明 |
|--------|------|
| **问题反馈** | 用户可提交系统问题和建议 |
| **反馈分类** | 问题类型：功能建议/Bug/性能/其他 |
| **图片上传** | 支持上传截图辅助说明问题 |
| **反馈历史** | 查看历史反馈记录和处理状态 |
| **管理员回复** | 管理员可对反馈进行回复和处理 |

#### 4.8.2 数据表设计
```sql
im_feedback                -- 用户反馈表
  - id                      反馈ID
  - user_id                 提交用户ID
  - feedback_type           反馈类型
  - title                   反馈标题
  - content                 反馈内容
  - images                  图片附件（JSON数组）
  - status                  处理状态
  - admin_reply             管理员回复
  - create_time             创建时间
```

### 4.9 应用中心模块（复刻钉钉应用中心）

#### 4.9.1 应用分类
| 分类 | 说明 |
|------|------|
| **办公协同** | 审批、考勤、日志、会议室等 |
| **人事管理** | 招聘、培训、绩效等 |
| **财务报销** | 费用报销、发票管理等 |
| **客户管理** | CRM、客户关系管理 |
| **数据分析** | 数据报表、BI工具 |
| **AI应用** | AI助手、智能创作等 |

#### 4.8.2 应用管理
| 功能点 | 说明 |
|--------|------|
| 应用安装 | 从应用市场安装应用到企业 |
| 应用配置 | 配置应用参数和权限 |
| 应用使用 | 在工作台或消息中使用应用 |
| 应用卸载 | 移除不需要的应用 |

### 4.10 系统管理模块（复刻若依+扩展）

| 功能点 | 说明 |
|--------|------|
| 用户管理 | 复用若依用户管理，扩展IM相关字段 |
| 角色管理 | 复用若依角色管理，扩展IM权限配置 |
| 菜单管理 | 复用若依菜单管理，管理IM模块菜单 |
| 系统配置 | IM系统参数配置（消息保留时长、文件存储路径等） |
| 数据审计 | 聊天记录审计、敏感操作日志 |

---

## 五、UI设计规范（钉钉PC 5.6完整复刻）

> **重要声明**：本规范100%复刻钉钉PC 5.6版本的UI设计，所有尺寸、颜色、字体、间距、交互效果必须与钉钉5.6保持像素级一致。
>
> **验证标准**：将Web版界面与钉钉PC 5.6界面并排对比，肉眼无法分辨差异。

### 5.1 整体布局结构

#### 5.1.1 布局模式

钉钉PC客户端采用**"四栏式"布局**（针对聊天场景），从左到右依次为：

```
┌─────────────────────────────────────────────────────────────────┐
│ 顶部导航栏 TopBar（高度：48px）                                    │
│ [Logo+搜索] [用户信息] [功能图标] [窗口控制]                        │
├──────┬───────────┬──────────────────────────────────────────────────┤
│左侧栏│ 中间会话区 │ 右侧聊天窗口区 ChatWindow                          │
│Side  │ Session   │                                               │
│Bar   │ List      │                                               │
│68px  │  320px    │ 自适应剩余宽度（flex: 1）                        │
├──────┴───────────┴──────────────────────────────────────────────────┤
│ 消息、DING、工作台、文档、通讯录、邮箱、应用中心                       │
└─────────────────────────────────────────────────────────────────┘
```

#### 5.1.2 布局尺寸规范（以1920×1080为基准）

| 区域 | 宽度 | 高度 | 说明 |
|------|------|------|------|
| 顶部导航栏 | 100% | 48px | 全局顶部，包含搜索、用户信息 |
| 左侧导航栏 | 68px | calc(100vh - 48px) | 核心功能入口，图标式导航 |
| 中间会话区 | 320px | calc(100vh - 48px) | 会话列表，支持滚动 |
| 右侧内容区 | flex: 1 | calc(100vh - 48px) | 聊天窗口/工作台等内容区 |

#### 5.1.3 最小尺寸要求

| 属性 | 数值 | 说明 |
|------|------|------|
| 窗口最小宽度 | 1200px | 低于此宽度出现横向滚动条 |
| 窗口最小高度 | 700px | 低于此高度出现纵向滚动条 |
| 内容区域最小宽度 | 800px | 右侧聊天区最小宽度 |

### 5.2 颜色规范

#### 5.2.1 品牌色系

| 颜色名称 | 颜色值 | 变量名 | 应用场景 |
|----------|--------|--------|----------|
| 品牌色 | #1890FF | --color-primary | 主按钮、链接、选中状态 |
| 品牌色-hover | #40A9FF | --color-primary-hover | 按钮悬停 |
| 品牌色-active | #096DD9 | --color-primary-active | 按钮按下 |
| 品牌色-disabled | #D9D9D9 | --color-primary-disabled | 禁用状态 |
| 品牌色-浅色 | #E6F7FF | --color-primary-light | 选中背景 |

#### 5.2.2 中性色系

| 颜色名称 | 颜色值 | 应用场景 |
|----------|--------|----------|
| 标题色 | #262626 | 一级标题、重要信息 |
| 正文色 | #333333 | 正文内容、消息内容 |
| 次要文字 | #666666 | 副标题、次要信息 |
| 辅助文字 | #999999 | 时间戳、提示信息 |
| 禁用文字 | #CCCCCC | 禁用状态文字 |
| 边框色 | #E8E8E8 | 分割线、边框 |
| 边框色-hover | #D9D9D9 | 边框悬停 |
| 背景色-base | #F5F7FA | 页面整体背景 |
| 背景色-white | #FFFFFF | 卡片、面板背景 |

#### 5.2.3 功能色系

| 颜色名称 | 颜色值 | 背景色 | 应用场景 |
|----------|--------|--------|----------|
| 成功 | #52C41A | #F6FFED | 发送成功、已读状态 |
| 警告 | #FAAD14 | #FFFBE6 | 消息撤回提示 |
| 错误 | #FF4D4F | #FFF1F0 | 发送失败、未读红点 |
| 信息 | #1890FF | #E6F7FF | 系统提示 |
| 在线状态 | #52C41A | - | 用户在线 |
| 离线状态 | #999999 | - | 用户离线 |
| 忙碌状态 | #FAAD14 | - | 用户忙碌 |

#### 5.2.4 消息气泡颜色

| 气泡类型 | 背景色 | 文字色 | 边框 |
|----------|--------|--------|------|
| 发送方（我） | #1890FF | #FFFFFF | - |
| 接收方 | #FFFFFF | #333333 | #E8E8E8 |
| 系统消息 | #F5F7FA | #999999 | - |
| 引用消息 | #F0F2F5 | #666666 | - |

### 5.3 字体规范

#### 5.3.1 字体家族

```css
font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
             "Helvetica Neue", Arial, "Noto Sans", sans-serif,
             "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol",
             "Noto Color Emoji", "钉钉进步体", "微软雅黑", "PingFang SC";
```

#### 5.3.2 字号字重规范

| 级别 | 字号 | 字重 | 行高 | 应用场景 |
|------|------|------|------|----------|
| 特大标题 | 24px | 500 | 32px | 页面主标题 |
| 大标题 | 20px | 500 | 28px | 模块标题 |
| 中标题 | 18px | 500 | 26px | 群组名称、卡片标题 |
| 小标题 | 16px | 500 | 24px | 次级标题 |
| 正文 | 14px | 400 | 22px | 消息内容、表单标签 |
| 辅助文字 | 12px | 400 | 20px | 时间戳、提示信息 |
| 极小文字 | 11px | 400 | 18px | 版权信息、脚注 |

#### 5.3.3 字重定义

| 字重名称 | 数值 | 应用场景 |
|----------|------|----------|
| Regular | 400 | 正文内容 |
| Medium | 500 | 标题、强调文字 |
| Semibold | 600 | 重要强调 |
| Bold | 700 | 特殊强调 |

### 5.4 间距规范

遵循**"4的倍数"原则**，基础间距单位为4px：

| 间距级别 | 变量名 | 数值 | 应用场景 |
|----------|--------|------|----------|
| 极小间距 | --spacing-xs | 4px | 紧密排列的图标 |
| 小间距 | --spacing-sm | 8px | 图标与文字 |
| 基础间距 | --spacing-md | 12px | 列表项内边距（上下） |
| 中间距 | --spacing-lg | 16px | 卡片内边距、元素间距 |
| 大间距 | --spacing-xl | 24px | 区块间距 |
| 超大间距 | --spacing-xxl | 32px | 模块间距 |
| 巨大间距 | --spacing-xxxl | 48px | 页面级间距 |

### 5.5 组件样式规范

#### 5.5.1 按钮组件

**尺寸规范：**

| 按钮尺寸 | 高度 | 水平内边距 | 字号 | 图标间距 |
|----------|------|-----------|------|----------|
| 大按钮 | 40px | 24px | 16px | 8px |
| 默认按钮 | 32px | 16px | 14px | 6px |
| 小按钮 | 24px | 12px | 12px | 4px |

**类型样式：**

| 按钮类型 | 背景色 | 文字色 | 边框 | 圆角 | 阴影 |
|----------|--------|--------|------|------|------|
| 主按钮 | #1890FF | #FFFFFF | - | 4px | - |
| 次要按钮 | #FFFFFF | #1890FF | #1890FF | 4px | - |
| 虚线按钮 | #FFFFFF | #666666 | #D9D9D9(dashed) | 4px | - |
| 文本按钮 | transparent | #1890FF | - | 2px | - |
| 危险按钮 | #FF4D4F | #FFFFFF | - | 4px | - |

**交互状态：**

| 状态 | 背景色变化 | 其他效果 |
|------|-----------|----------|
| hover | 色值加深10% | 鼠标指针变为 pointer |
| active | 色值加深20% | 轻微缩放(0.98) |
| disabled | #F5F5F5背景 | #CCCCCC文字，鼠标not-allowed |
| loading | 主色背景 | 旋转图标 |

#### 5.5.2 头像组件

| 头像类型 | 尺寸 | 形状 | 边框 | 应用场景 |
|----------|------|------|------|----------|
| 超大头像 | 80×80px | 圆形 | 3px solid #FFF | 个人资料页 |
| 大头像 | 64×64px | 圆形 | 2px solid #FFF | 聊天窗口对方信息 |
| 默认头像 | 40×40px | 圆形 | 2px solid #FFF | 会话列表、消息气泡旁 |
| 小头像 | 32×32px | 圆形 | 1px solid #E8E8E8 | 群组成员列表 |
| 迷你头像 | 24×24px | 圆形 | - | @成员提及、消息引用 |

**头像状态标识：**

| 状态 | 样式 | 尺寸 |
|------|------|------|
| 在线 | 右下角绿点 | 10×10px |
| 离线 | 右下角灰点 | 10×10px |
| 忙碌 | 右下角橙点 | 10×10px |

#### 5.5.3 消息气泡组件

**发送方（我）气泡：**

| 属性 | 数值 |
|------|------|
| 背景色 | #1890FF |
| 文字色 | #FFFFFF |
| 圆角 | 右下角2px，其他8px |
| 最大宽度 | 60% |
| 内边距 | 10px 14px |
| 阴影 | 无 |

**接收方气泡：**

| 属性 | 数值 |
|------|------|
| 背景色 | #FFFFFF |
| 文字色 | #333333 |
| 圆角 | 左下角2px，其他8px |
| 边框 | 1px solid #E8E8E8 |
| 最大宽度 | 60% |
| 内边距 | 10px 14px |
| 阴影 | 0 1px 2px rgba(0,0,0,0.03) |

**消息元信息：**

| 属性 | 数值 |
|------|------|
| 发送状态图标 | 16×16px |
| 时间戳字号 | 12px |
| 时间戳颜色 | #999999 |

#### 5.5.4 列表组件（会话列表）

| 属性 | 数值 |
|------|------|
| 列表项高度 | 64px |
| 内边距 | 12px 16px |
| 头像尺寸 | 40×40px |
| 头像与内容间距 | 12px |
| 悬停背景 | #F5F7FA |
| 选中背景 | #E6F7FF |
| 分隔线 | 1px solid #F0F0F0 |
| 未读红点 | 直径8px，背景#FF4D4F |

**列表项信息层级：**

| 信息类型 | 字号 | 颜色 | 最大宽度 |
|----------|------|------|----------|
| 会话名称 | 14px | #333333 | 180px |
| 最新消息 | 13px | #999999 | 180px(单行截断) |
| 时间戳 | 12px | #CCCCCC | - |
| 未读数 | 12px | #FFFFFF | 背景#FF4D4F |

#### 5.5.5 输入框组件

| 属性 | 数值 |
|------|------|
| 最小高度 | 36px |
| 最大高度 | 150px |
| 内边距 | 8px 12px |
| 边框 | 1px solid #E8E8E8 |
| 边框-radius | 4px |
| 聚焦边框 | 1px solid #1890FF |
| 聚焦阴影 | 0 0 0 2px rgba(24,144,255,0.1) |
| 占位文字颜色 | #999999 |
| 字号 | 14px |

#### 5.5.6 卡片组件

| 属性 | 数值 |
|------|------|
| 背景色 | #FFFFFF |
| 边框 | 1px solid #E8E8E8 |
| 圆角 | 8px |
| 内边距 | 16px 20px |
| 阴影-rest | 0 1px 2px rgba(0,0,0,0.03) |
| 阴影-hover | 0 4px 12px rgba(0,0,0,0.08) |
| 阴影-click | 0 2px 6px rgba(0,0,0,0.06) |

### 5.6 导航栏规范

#### 5.6.1 左侧导航栏

| 属性 | 数值 |
|------|------|
| 导航栏宽度 | 68px |
| 导航项尺寸 | 48×48px |
| 图标尺寸 | 24×24px |
| 图标与文字间距 | 4px |
| 默认图标颜色 | #666666 |
| 选中图标颜色 | #1890FF |
| 选中背景色 | #E6F7FF |
| 选中指示器 | 左侧3px宽 #1890FF线条 |
| 提示工具提示 | 12px字号，圆角4px |

#### 5.6.2 顶部导航栏

| 属性 | 数值 |
|------|------|
| 导航栏高度 | 48px |
| 内边距 | 0 24px |
| 背景色 | #FFFFFF |
| 边框底 | 1px solid #E8E8E8 |
| 搜索框宽度 | 280px |
| 搜索框高度 | 32px |

### 5.7 动画与过渡规范

#### 5.7.1 缓动函数

| 缓动类型 | CSS值 | 应用场景 |
|----------|-------|----------|
| 线性 | linear | 进度条、加载动画 |
| 标准缓动 | ease | 一般过渡 |
| 入场缓动 | cubic-bezier(0, 0, 0.2, 1) | 元素进入 |
| 出场缓动 | cubic-bezier(0.4, 0, 1, 1) | 元素离开 |
| 弹性缓动 | cubic-bezier(0.34, 1.56, 0.64, 1) | 弹性效果 |

#### 5.7.2 动画时长

| 时长级别 | 时间 | 应用场景 |
|----------|------|----------|
| 极快 | 100ms | 颜色变化、阴影变化 |
| 快速 | 200ms | 一般状态切换 |
| 标准 | 300ms | 展开收起、页面切换 |
| 较慢 | 500ms | 复杂动画 |

#### 5.7.3 常用动画

| 动画类型 | 时长 | 缓动函数 |
|----------|------|----------|
| 淡入淡出 | 200ms | ease-in-out |
| 滑入滑出 | 300ms | cubic-bezier(0, 0, 0.2, 1) |
| 展开/收起 | 300ms | cubic-bezier(0, 0, 0.2, 1) |
| 消息发送 | 200ms | cubic-bezier(0.34, 1.56, 0.64, 1) |
| 按钮点击 | 100ms | ease-out |

### 5.8 图标规范

#### 5.8.1 图标尺寸

| 尺寸类型 | 数值 | 应用场景 |
|----------|------|----------|
| 极小图标 | 12×12px | 状态标识 |
| 小图标 | 16×16px | 列表操作、消息状态 |
| 默认图标 | 20×20px | 按钮图标、输入框图标 |
| 中图标 | 24×24px | 导航图标、功能入口 |
| 大图标 | 32×32px | 页面功能图标 |
| 超大图标 | 48×48px | 空状态插图 |

#### 5.8.2 图标颜色

| 场景 | 颜色值 |
|------|--------|
| 默认状态 | #666666 |
| 悬停状态 | #333333 |
| 激活状态 | #1890FF |
| 禁用状态 | #CCCCCC |
| 功能色图标 | 使用对应功能色 |

#### 5.8.3 图标库

推荐使用以下图标库：
- **Ant Design Icons** - 钉钉PC端使用的主要图标库
- **自定义图标** - 钉钉特有功能需自定义绘制

### 5.9 响应式设计

#### 5.9.1 断点定义

| 断点名称 | 分辨率 | 布局调整 |
|----------|--------|----------|
| 小屏幕 | < 1366px | 中间会话区收窄至280px |
| 标准屏幕 | 1366px - 1920px | 标准四栏布局 |
| 大屏幕 | > 1920px | 保持比例，内容区最大1800px居中 |

#### 5.9.2 适配策略

| 屏幕类型 | 会话区宽度 | 内容区处理 |
|----------|-----------|-----------|
| 小屏幕 | 280px | 正常显示 |
| 标准屏幕 | 320px | 正常显示 |
| 大屏幕 | 340px | 内容最大1800px居中 |

### 5.10 可访问性规范

#### 5.10.1 键盘导航

| 操作 | 快捷键 |
|------|--------|
| 发送消息 | Enter / Ctrl+Enter（可配置） |
| 换行 | Shift+Enter |
| 搜索会话 | Ctrl+F |
| 新建会话 | Ctrl+N |
| 关闭会话 | Ctrl+W |
| 切换会话 | Ctrl+Tab / Ctrl+Shift+Tab |

#### 5.10.2 焦点管理

| 场景 | 要求 |
|------|------|
| 焦点可见 | 焦点元素显示2px #1890FF轮廓 |
| 焦点顺序 | 符合视觉流，从左到右、从上到下 |
| 模态框焦点 | 打开时焦点移入，关闭时返回触发元素 |
| 焦点陷阱 | 模态框打开时焦点限制在模态框内 |

#### 5.10.3 ARIA标签

| 组件 | ARIA要求 |
|------|----------|
| 按钮 | aria-label 或 button内文字 |
| 输入框 | aria-label 描述用途 |
| 下拉菜单 | role="menu", aria-expanded |
| 对话框 | role="dialog", aria-modal="true" |
| 加载状态 | aria-busy="true" |
| 消息列表 | aria-live="polite" |

### 5.11 暗色模式规范（可选）

#### 5.11.1 暗色系颜色

| 颜色类型 | 暗色值 | 应用场景 |
|----------|--------|----------|
| 背景色-base | #141414 | 页面整体背景 |
| 背景色-elevated | #1F1F1F | 卡片、面板背景 |
| 背景色-component | #2A2A2A | 组件背景 |
| 文字色-primary | #E8E8E8 | 主要文字 |
| 文字色-secondary | #A6A6A6 | 次要文字 |
| 边框色 | #3A3A3A | 分割线、边框 |

---

## 六、数据安全要求

### 6.1 数据存储安全

| 安全项 | 要求 |
|--------|------|
| 数据加密 | 敏感字段（密码、密钥）使用AES-256加密存储 |
| 数据脱敏 | 手机号、邮箱等个人信息按需脱敏展示 |
| 数据备份 | 支持定时备份，备份数据加密存储 |
| 数据保留 | 聊天记录保留期限可配置，到期自动清理 |

### 6.2 访问控制

| 控制项 | 要求 |
|--------|------|
| 身份认证 | 支持用户名/密码登录，集成Spring Security + JWT权限体系 |
| 权限分级 | 支持管理员、普通用户等角色，功能可见性差异化 |
| 操作审计 | 敏感操作记录操作日志（操作人、时间、IP、内容） |
| 反馈管理 | 用户反馈收集、处理、回复机制 |
| 会话管理 | 会话超时自动退出，支持强制下线 |

### 6.3 传输安全

| 安全项 | 要求 |
|--------|------|
| 传输加密 | 生产环境强制HTTPS |
| 接口签名 | 敏感接口增加签名校验 |
| 防重放 | 关键操作接口增加时间戳校验 |

---

## 七、非功能性需求

### 7.1 性能指标

| 指标 | 要求 |
|------|------|
| 响应时间 | 页面首屏加载 < 2s |
| 并发支持 | 支持1000+用户同时在线 |
| 消息延迟 | 消息发送延迟 < 500ms |
| 数据库查询 | 列表查询 < 1s |

### 7.2 兼容性要求

| 类型 | 要求 |
|------|------|
| 浏览器 | Chrome 90+、Edge 90+、Firefox 88+ |
| 分辨率 | 最低支持1366×768 |
| 数据库 | MySQL 5.7+、8.0+ |

### 7.3 可维护性要求

| 要求 | 说明 |
|------|------|
| 代码规范 | 遵循《阿里巴巴Java开发手册》《阿里巴巴前端开发手册》 |
| 接口文档 | 使用Swagger生成接口文档 |
| 日志规范 | 日志级别正确，关键操作记录日志 |

---

## 八、项目交付要求

### 8.1 交付清单

| 类别 | 内容 |
|------|------|
| 源代码 | 完整的前后端源代码，包含注释 |
| 数据库脚本 | 建表SQL、初始化数据SQL |
| 部署文档 | 部署步骤说明、配置说明 |
| 接口文档 | Swagger接口文档 |
| 用户手册 | 操作使用说明 |

### 8.2 验收标准

| 模块 | 验收标准 |
|------|----------|
| IM聊天 | 单聊、群聊消息收发正常，文件传输正常 |
| 工作台 | 应用卡片可正常跳转，待办事项正常显示 |
| 审批中心 | 审批流程可正常流转 |
| 通讯录 | 组织架构正常展示，成员搜索正常 |
| 系统管理 | 复用若依功能正常，IM管理功能正常 |

---

## 九、附录

### 9.1 术语说明

| 术语 | 说明 |
|------|------|
| 若依 | 一个基于Spring Boot的权限管理系统快速开发平台 |
| Element Plus | 基于Vue 3的组件库 |
| Shiro | Apache开源安全框架 |
| 私有化部署 | 在企业自有服务器上部署，数据不经过第三方服务器 |

### 9.2 参考文档

- 若依官方文档：http://doc.ruoyi.vip/
- Element Plus文档：https://element-plus.org/
- Vue 3文档：https://cn.vuejs.org/

---

## 十、技术实现细节

### 10.1 WebSocket实时通信实现

#### 10.1.1 整体架构

```
┌─────────────────────────────────────────────────────────────────────┐
│                         WebSocket通信架构                            │
├─────────────────────────────────────────────────────────────────────┤
│  客户端层                                                            │
│  ┌───────────────┐  ┌───────────────┐  ┌───────────────┐           │
│  │ Vue 3 前端    │  │ 管理员前端    │  │ 移动端H5      │           │
│  │ (ruoyi-im-web)│  │ (ruoyi-im-admin)│  │ (可选)        │           │
│  └───────┬───────┘  └───────┬───────┘  └───────┬───────┘           │
│          │                  │                  │                     │
│          └──────────────────┼──────────────────┘                     │
│                             ▼                                        │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │               WebSocket连接层                               │   │
│  │  - 连接建立与认证（JWT Token校验）                          │   │
│  │  - 心跳保活（Heartbeat机制）                                │   │
│  │  - 断线重连（Reconnection机制）                             │   │
│  │  - 消息路由（Message Routing）                              │   │
│  └──────────────────────────┬──────────────────────────────────┘   │
│                             │                                        │
│  ┌──────────────────────────▼──────────────────────────────────┐   │
│  │               Netty Server（@ServerEndpoint）              │   │
│  │  - ImWebSocketEndpoint（WebSocket端点类）                   │   │
│  │  - Channel管理（用户Channel映射）                           │   │
│  │  - 消息广播（Broadcast）                                    │   │
│  │  - 单点推送（Push to User）                                 │   │
│  │  - 群组推送（Push to Group）                                │   │
│  └──────────────────────────┬──────────────────────────────────┘   │
│                             │                                        │
│  ┌──────────────────────────▼──────────────────────────────────┐   │
│  │               消息处理层                                    │   │
│  │  - 消息类型解析（MessageType解析）                          │   │
│  │  - 业务消息处理（ChatMessageHandler）                       │   │
│  │  - 系统消息处理（SystemMessageHandler）                     │   │
│  │  - 状态消息处理（StatusMessageHandler）                     │   │
│  └──────────────────────────┬──────────────────────────────────┘   │
│                             │                                        │
│  ┌──────────────────────────▼──────────────────────────────────┐   │
│  │               服务层调用                                    │   │
│  │  - MessageService（消息业务处理）                           │   │
│  │  - ContactService（联系人业务处理）                         │   │
│  │  - GroupService（群组业务处理）                             │   │
│  │  - UserService（用户状态处理）                              │   │
│  └─────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────┘
```

#### 10.1.2 消息类型定义

| 消息类型 | Type值 | 说明 | 优先级 |
|----------|--------|------|--------|
| CHAT | chat | 普通聊天消息 | 高 |
| SYSTEM | system | 系统通知消息 | 高 |
| PRESENCE | presence | 用户状态变更（上线/离线） | 中 |
| TYPING | typing | 对方正在输入 | 低 |
| READ_ACK | read | 消息已读回执 | 高 |
| HEARTBEAT | heartbeat | 心跳保活消息 | 最高 |
| ERROR | error | 错误消息 | 高 |

#### 10.1.3 心跳保活机制

| 参数 | 值 | 说明 |
|------|-----|------|
| 心跳间隔 | 30秒 | 客户端与服务器之间的心跳检测间隔 |
| 心跳超时 | 60秒 | 超过60秒未收到心跳视为连接断开 |
| 重连策略 | 指数退避 | 首次重连等待1秒，后续每次翻倍，最长30秒 |
| 最大重连次数 | 5次 | 超过5次重连失败则提示用户 |

#### 10.1.4 连接认证流程

```
用户登录
    │
    ▼
获取JWT Token（含userId）
    │
    ▼
建立WebSocket连接
    │
    ▼
发送认证消息（AuthMessage）
    │  {token: "xxx", userId: 123}
    │
    ▼
服务器验证Token
    │
    ├── 验证通过 ──→ 建立Channel与UserId映射 ──→ 加入用户Channel组
    │
    └── 验证失败 ──→ 关闭连接，返回错误码
```

#### 10.1.5 消息推送策略

| 场景 | 推送方式 | 实现说明 |
|------|----------|----------|
| 单聊消息 | 单点推送 | 根据receiverId查询Channel，直接推送 |
| 群聊消息 | 广播推送 | 根据groupId查询所有成员Channel，批量推送 |
| 系统通知 | 广播推送 | 推送给所有在线用户 |
| 用户上线 | 广播推送 | 通知好友/群组成员 |
| 用户离线 | 延迟推送 | 消息存入Redis，离线用户上线后拉取 |

### 10.2 消息存储策略

#### 10.2.1 存储架构

```
┌─────────────────────────────────────────────────────────────────┐
│                      消息存储架构                                │
├─────────────────────────────────────────────────────────────────┤
│  实时消息                                                        │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  MySQL持久化存储                                         │   │
│  │  - im_message（消息主表）                                │   │
│  │  - im_conversation（会话表）                             │   │
│  │  - im_group_member（群组成员表）                         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                              │                                   │
│              ┌───────────────┴───────────────┐                   │
│              ▼                               ▼                   │
│  ┌─────────────────────┐       ┌─────────────────────┐          │
│  │ Redis在线状态缓存   │       │ Redis离线消息缓存   │          │
│  │ - online_users      │       │ - offline:userId    │          │
│  │ - user_status       │       │ - 未读消息计数      │          │
│  │ - user_session      │       │ - 最后活跃时间      │          │
│  └─────────────────────┘       └─────────────────────┘          │
│                                                                  │
│  历史消息归档（可选）                                             │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  - 按月分表（im_message_202501, im_message_202502...）   │   │
│  │  - 冷热数据分离（热数据MySQL，冷数据归档到历史库）        │   │
│  │  - 消息清理策略（超过N天自动清理或归档）                  │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

#### 10.2.2 消息表结构

| 表名 | 说明 | 核心字段 |
|------|------|----------|
| im_message | 消息主表 | id, conversation_id, sender_id, receiver_id, type, content, is_revoked, create_time |
| im_conversation | 会话表 | id, type, last_message_id, last_message_time, unread_count |
| im_group | 群组表 | id, name, owner_id, member_count, create_time |
| im_group_member | 群组成员表 | id, group_id, user_id, role, join_time |
| im_friend | 好友关系表 | id, user_id, friend_id, remark, status |
| im_offline_message | 离线消息表 | id, user_id, message_id, receive_time |

#### 10.2.3 消息存储流程

```
发送消息
    │
    ▼
1. 消息预处理
   - 消息加密（AES加密）
   - 生成clientMsgId（客户端消息ID，用于幂等校验）
   - 验证发送权限
    │
    ▼
2. 消息持久化
   - 插入im_message表
   - 更新im_conversation表的last_message_id和last_message_time
   - 更新im_conversation表的unread_count（+1）
    │
    ├── 在线用户 ──→ 3a. WebSocket推送
    │
    └── 离线用户 ──→ 3b. 存入Redis离线消息队列
                       （zadd offline:userId message score）
    │
    ▼
4. 返回发送结果
   - 返回messageId给发送方
   - 标记消息为已发送状态
```

#### 10.2.4 离线消息处理

| 处理阶段 | 实现方式 | 说明 |
|----------|----------|------|
| 消息缓存 | Redis ZSET | 按时间戳排序，支持分页拉取 |
| 未读计数 | Redis INCR/DECR | 原子操作，保证计数准确 |
| 消息拉取 | 分页获取 | 上线时拉取最近N条离线消息 |
| 计数同步 | 实时更新 | 用户上线后同步未读计数到前端 |
| 消息清理 | 定时任务 | 超过7天未领取的离线消息自动清理 |

#### 10.2.5 消息分表策略

| 策略 | 说明 | 适用场景 |
|------|------|----------|
| 按会话ID取模 | conversation_id % 4，分4张表 | 数据分布均匀，查询需指定会话ID |
| 按时间月份 | im_message_202501, im_message_202502 | 历史数据归档方便，适合消息查询 |
| 按用户ID | sender_id % N 或 receiver_id % N | 用户维度查询高效，适合用户消息列表 |

### 10.3 性能优化策略

#### 10.3.1 前端优化

| 优化项 | 实现方式 | 预期效果 |
|--------|----------|----------|
| 路由懒加载 | Vue Router lazy loading | 首屏加载时间减少40% |
| 组件按需引入 | Element Plus按需引入 | 包体积减少30% |
| 图片懒加载 | vue-lazyload | 减少初始网络请求 |
| 消息虚拟列表 | vue-virtual-scroller | 1万条消息流畅滚动 |
| WebSocket连接复用 | 单例模式 | 避免重复建立连接 |
| 消息状态本地缓存 | LocalStorage | 减少网络请求次数 |
| 表情包CDN加速 | 静态资源CDN | 表情加载速度提升 |

#### 10.3.2 后端优化

| 优化项 | 实现方式 | 预期效果 |
|--------|----------|----------|
| 消息批量处理 | Batch Insert | 插入性能提升5-10倍 |
| 查询结果缓存 | Redis Cache | 列表查询响应<100ms |
| 数据库连接池 | Druid配置优化 | 连接获取时间<10ms |
| 索引优化 | 复合索引设计 | 查询性能提升10倍以上 |
| 异步处理 | 消息入库异步化 | 发送延迟<100ms |
| 连接池管理 | Netty连接池复用 | 内存占用减少50% |
| 消息压缩 | Gzip压缩 | 传输数据量减少70% |

#### 10.3.3 数据库优化

| 优化项 | 实现方式 | 说明 |
|--------|----------|------|
| 索引优化 | conversation_id + create_time | 消息列表查询优化 |
| 读写分离 | 主从复制 | 读请求分发到从库 |
| 分库分表 | 按用户ID/时间分片 | 单表数据量控制在100万以内 |
| 归档策略 | 历史数据迁移 | 热数据保持50万以内 |
| 查询优化 | 避免SELECT * | 只查询必要字段 |
| 分页优化 | 游标分页 | 大数据量分页不慢查询 |

#### 10.3.4 缓存策略

| 缓存类型 | 缓存内容 | 过期时间 | 更新策略 |
|----------|----------|----------|----------|
| 用户状态 | 在线/离线状态 | 30分钟 | 实时更新 |
| 会话列表 | 最后消息预览 | 5分钟 | 消息发送时更新 |
| 未读计数 | 各会话未读数 | 实时 | 消息到达时更新 |
| 群组成员 | 群成员列表 | 10分钟 | 群变更时更新 |
| 用户信息 | 用户基本信息 | 1小时 | 用户信息变更时更新 |
| 离线消息 | 待拉取消息 | 7天 | 用户上线拉取后清理 |

#### 10.3.5 性能指标

| 指标 | 要求 | 测试方法 |
|------|------|----------|
| 消息发送延迟 | P99 < 500ms | 压力测试，1000并发用户 |
| 消息推送延迟 | P99 < 200ms | 实时性测试 |
| 页面加载时间 | 首屏 < 2s | Lighthouse性能测试 |
| WebSocket连接数 | 单机支持10000+ | 连接数压力测试 |
| 消息吞吐量 | 单机 > 5000条/秒 | 吞吐量压力测试 |
| 内存占用 | 单用户 < 50KB | 内存分析 |

---

## 十一、安全增强设计

### 11.1 数据加密体系

#### 11.1.1 传输加密

| 层级 | 加密方式 | 实现说明 |
|------|----------|----------|
| 传输层 | TLS 1.2/1.3 | 生产环境强制HTTPS/WSS |
| 应用层 | AES-256-GCM | 消息内容端到端加密 |
| 密钥交换 | RSA-2048 | 传输对称密钥 |
| 签名机制 | HMAC-SHA256 | 消息完整性校验 |

#### 11.1.2 存储加密

| 数据类型 | 加密方式 | 说明 |
|----------|----------|------|
| 消息内容 | AES-256 | 密文存储，支持按需解密 |
| 用户密码 | BCrypt | 哈希加盐，不可逆 |
| Token密钥 | AES-256 | 密文存储 |
| 文件加密 | AES-256 | 大文件分块加密 |
| 敏感字段 | 字段级加密 | 手机号、身份证等 |

#### 11.1.3 端到端加密流程

```
发送方
    │
    ▼
1. 生成随机对称密钥（Session Key）
    │
    ▼
2. 用Session Key加密消息内容（AES）
    │
    ▼
3. 用接收方公钥加密Session Key（RSA）
    │
    ▼
4. 发送加密数据 + 加密的Session Key
    │
    ────────────────────────────→ 网络传输
    │
接收方
    │
    ▼
1. 用私钥解密Session Key（RSA）
    │
    ▼
2. 用Session Key解密消息内容（AES）
```

### 11.2 访问控制增强

#### 11.2.1 身份认证

| 认证方式 | 说明 | 适用场景 |
|----------|------|----------|
| 用户名密码 | 基础认证方式 | 默认登录方式 |
| 短信验证码 | 二次验证 | 敏感操作验证 |
| JWT Token | 无状态认证 | API调用认证 |
| 设备绑定 | 设备指纹识别 | 异常登录检测 |
| SSO单点登录 | 企业统一认证 | 企业级集成 |

#### 11.2.2 权限控制

| 控制粒度 | 实现方式 | 说明 |
|----------|----------|------|
| 功能权限 | Spring Security注解 | @PreAuthorize/@Secured |
| 数据权限 | 数据范围过滤 | 部门/角色数据隔离 |
| 接口权限 | JWT Token解析 | 用户信息绑定请求 |
| 消息权限 | 发送方验证 | 只能发送给有权限的用户 |
| 文件权限 | 访问URL签名 | 私有文件无法直接访问 |

#### 11.2.3 敏感操作审计

| 操作类型 | 审计内容 | 记录方式 |
|----------|----------|----------|
| 登录登出 | 时间、IP、设备信息 | 日志 + 数据库 |
| 消息发送 | 发送方、接收方、消息ID | 数据库 |
| 文件上传 | 文件名、大小、上传者 | 日志 |
| 权限变更 | 变更人、变更内容、变更时间 | 数据库 |
| 数据导出 | 导出内容、导出人、时间 | 日志 |
| 敏感查询 | 查询条件、查询人、时间 | 日志 |

### 11.3 防攻击机制

#### 11.3.1 接口防刷策略

| 防护类型 | 阈值设置 | 响应措施 |
|----------|----------|----------|
| 登录接口 | 5次/分钟/IP | 临时锁定15分钟 |
| 消息发送 | 60条/分钟/用户 | 限流提示 |
| 文件上传 | 10次/分钟/用户 | 返回繁忙状态 |
| 搜索接口 | 30次/分钟/用户 | 限流返回空结果 |
| WebSocket | 100条/分钟/连接 | 断开连接 |
| 通用API | 200次/分钟/IP | 返回429状态码 |

#### 11.3.2 限流实现

```
┌─────────────────────────────────────────────────────────────────┐
│                      限流架构                                   │
├─────────────────────────────────────────────────────────────────┤
│  限流维度                                                         │
│  - 用户维度（userId）                                            │
│  - IP维度（clientIP）                                            │
│  - 接口维度（API Path）                                          │
│  - 全局限流（Global）                                            │
│                                                                  │
│  限流算法                                                         │
│  - 滑动窗口（Sliding Window）                                    │
│  - 令牌桶（Token Bucket）                                        │
│  - 漏桶（Leaky Bucket）                                          │
│                                                                  │
│  存储方式                                                         │
│  - 单机：Guava RateLimiter                                       │
│  - 分布式：Redis INCR + EXPIRE                                   │
└─────────────────────────────────────────────────────────────────┘
```

#### 11.3.3 防XSS/CSRF攻击

| 攻击类型 | 防护措施 |
|----------|----------|
| XSS攻击 | 输入过滤、输出编码、Content Security Policy |
| CSRF攻击 | CSRF Token、Referer检查、SameSite Cookie |
| SQL注入 | 参数化查询、ORM框架防护、输入校验 |
| DDos攻击 | Nginx限流、IP黑名单、CDN防护 |
| 恶意文件上传 | 文件类型白名单、文件内容检测、文件重命名 |
| 暴力破解 | 登录失败次数限制、验证码机制、登录行为分析 |

#### 11.3.4 安全监控

| 监控项 | 告警阈值 | 通知方式 |
|--------|----------|----------|
| 登录失败次数 | 10次/分钟/IP | 实时告警 |
| 异常IP访问 | 新IP首次登录 | 记录通知 |
| 消息发送异常 | 发送量突增50% | 告警通知 |
| 文件上传异常 | 大量小文件上传 | 告警通知 |
| API错误率 | 错误率 > 5% | 告警通知 |
| WebSocket异常 | 连接断开率 > 10% | 告警通知 |

### 11.4 安全部署要求

| 要求项 | 说明 |
|--------|------|
| 生产环境HTTPS | 强制使用TLS证书 |
| 敏感配置加密 | 数据库密码、API密钥等加密存储 |
| 日志脱敏 | 日志中敏感信息自动脱敏 |
| 安全更新 | 定期更新依赖版本，修复安全漏洞 |
| 渗透测试 | 上线前进行安全渗透测试 |
| 备份安全 | 数据库备份加密存储 |

---

## 变更记录

| 版本 | 日期 | 变更人 | 变更内容 |
|------|------|--------|----------|
| v1.0 | 2025-01-08 | - | 初始版本 |
| v1.1 | 2025-01-13 | - | 补充技术实现细节（WebSocket、消息存储、性能优化）、安全增强设计、功能优先级详细划分 |
| v2.0 | 2026-01-14 | - | 更新技术栈（Spring Security替代Shiro）、新增语音通话功能、新增用户反馈模块、更新消息状态追踪功能 |
| v3.0 | 2026-01-14 | - | **重大更新：100%复刻钉钉PC 5.6版本**<br>1. 明确项目定位：Web版钉钉5.6完整复刻<br>2. 更新所有功能模块对标钉钉5.6<br>3. 明确复刻范围：消息、DING、工作台、通讯录、文档、邮箱、应用中心<br>4. 更新UI设计规范为钉钉5.6规范<br>5. 明确基于若依框架的技术架构 |
