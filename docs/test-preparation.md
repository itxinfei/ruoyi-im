# 测试准备指南 - IM 聊天功能 Phase 1 & Phase 2

**准备时间**: 测试前1天
**准备人员**: 测试负责人 + 开发人员
**创建时间**: 2026-01-30

---

## 🎯 测试目标

验证以下功能：
1. **Phase 1**: 消息发送状态（发送中、成功、失败、重试）
2. **Phase 2**: 文件上传优化（拖拽、粘贴、进度显示）

---

## 📋 准备清单

### 1. 测试环境准备

#### 1.1 开发环境
- [ ] **后端服务启动**
  ```bash
  cd ruoyi-im-api
  # 确保 MySQL 可连接: 172.168.20.222:3306/im
  # 确保 Redis 可连接: 172.168.20.222:6379
  # 运行 ImApplication.java (端口 8080)
  ```

- [ ] **前端服务启动**
  ```bash
  cd ruoyi-im-web
  npm install  # 首次运行
  npm run dev  # 启动开发服务器 (端口 5173)
  ```

- [ ] **数据库检查**
  ```sql
  -- 检查关键表是否存在
  SHOW TABLES LIKE 'im_message%';
  SHOW TABLES LIKE 'im_conversation%';
  SHOW TABLES LIKE 'im_user%';

  -- 检查测试数据
  SELECT COUNT(*) FROM im_user;
  SELECT COUNT(*) FROM im_conversation;
  ```

#### 1.2 测试浏览器准备
- [ ] Chrome 120+ (主测)
- [ ] Edge 120+ (兼容性测试)
- [ ] Firefox 120+ (兼容性测试)
- [ ] 开发者工具准备（Network、Console）

#### 1.3 测试工具准备
- [ ] **开发者工具**
  - Network 标签页（监控网络请求）
  - Console 标签页（查看错误日志）
  - Application 标签页（检查 LocalStorage）

- [ ] **网络模拟工具**
  - Chrome DevTools → Network → Network throttling
  - 选择 "Offline" 模拟网络断开
  - 选择 "Slow 3G" 模拟弱网环境

- [ ] **截图工具**
  - Windows: Win+Shift+S
  - Mac: Cmd+Shift+4
  - 用于记录问题截图

---

### 2. 测试数据准备

#### 2.1 测试账号
| 用户名 | 密码 | 角色 | 用途 |
|--------|------|------|------|
| test1 | 123456 | 普通用户 | 测试用户1 |
| test2 | 123456 | 普通用户 | 测试用户2 |
| admin | admin123 | 管理员 | 管理功能测试 |

**创建测试账号 SQL**:
```sql
-- 如果测试账号不存在，创建它们
INSERT INTO im_user (user_id, user_name, nick_name, password, user_type, status, create_time)
VALUES
(1001, 'test1', '测试用户1', '$2a$10$...', '0', '0', NOW()),
(1002, 'test2', '测试用户2', '$2a$10$...', '0', '0', NOW())
ON DUPLICATE KEY UPDATE nick_name = VALUES(nick_name);
```

#### 2.2 测试会话数据
```sql
-- 为测试用户创建私聊会话
INSERT INTO im_conversation (id, type, target_id, create_time)
VALUES
(1, 'PRIVATE', '1001', NOW()),
(2, 'PRIVATE', '1002', NOW())
ON DUPLICATE KEY UPDATE update_time = NOW();

-- 添加会话成员
INSERT INTO im_conversation_member (conversation_id, user_id, role, join_time)
VALUES
(1, 1001, 'MEMBER', NOW()),
(1, 1002, 'MEMBER', NOW()),
(2, 1001, 'MEMBER', NOW()),
(2, 1002, 'MEMBER', NOW())
ON DUPLICATE KEY UPDATE update_time = NOW();
```

#### 2.3 测试文件准备

在 `test-files/` 目录下准备以下文件：

| 文件名 | 类型 | 大小 | 用途 |
|--------|------|------|------|
| image-1kb.jpg | 图片 | 1 KB | 小图片测试 |
| image-100kb.jpg | 图片 | 100 KB | 正常图片测试 |
| image-5mb.jpg | 图片 | 5 MB | 大图片测试 |
| document.pdf | PDF | 500 KB | PDF 文件测试 |
| report.docx | Word | 200 KB | Word 文件测试 |
| spreadsheet.xlsx | Excel | 150 KB | Excel 文件测试 |
| large-file.zip | 压缩包 | 50 MB | 大文件上传测试 |
| 特殊文件名(1).pdf | PDF | 100 KB | 特殊字符测试 |

**下载测试文件**:
```bash
# 创建测试文件目录
mkdir -p test-files

# 生成测试图片（使用示例图片）
# 或从网上下载不同大小的测试文件
```

---

### 3. 测试场景准备

#### 3.1 场景1: 正常发送消息
- **目的**: 验证消息正常发送流程
- **步骤**:
  1. 用户1登录
  2. 选择与用户2的会话
  3. 发送"测试消息1"
  4. 观察状态变化
- **预期**: 发送中 → 成功

#### 3.2 场景2: 网络断开发送
- **目的**: 验证失败重试机制
- **步骤**:
  1. 断开网络（DevTools → Offline）
  2. 发送消息
  3. 观察失败状态
  4. 恢复网络
  5. 点击重试
- **预期**: 失败 → 重试成功

#### 3.3 场景3: 拖拽上传图片
- **目的**: 验证拖拽上传功能
- **步骤**:
  1. 从文件管理器拖拽图片到输入框
  2. 观察预览对话框
  3. 添加描述
  4. 点击发送
- **预期**: 预览正确 → 上传成功

#### 3.4 场景4: 粘贴上传截图
- **目的**: 验证粘贴上传功能
- **步骤**:
  1. 截图（Win+Shift+S）
  2. 在输入框粘贴（Ctrl+V）
  3. 观察预览
  4. 点击发送
- **预期**: 自动识别 → 上传成功

---

### 4. 测试用户招募

#### 4.1 招募要求
- **人数**: 2-3名
- **条件**:
  - 熟悉基本的聊天软件使用（微信、钉钉等）
  - 有时间参与测试（约2小时）
  - 能提供详细反馈

#### 4.2 用户类型
| 类型 | 人数 | 特点 | 重点关注 |
|------|------|------|----------|
| 技术用户 | 1名 | 熟悉电脑操作，能发现问题 | 技术细节、边界条件 |
| 普通用户 | 1-2名 | 代表最终用户 | 易用性、体验 |

#### 4.3 用户邀请话术模板

**邮件/消息模板**:
```
主题: 邀请参与 IM 系统聊天功能测试

您好！

我们正在测试 IM 系统的聊天功能，想邀请您参与测试。

【测试时间】约 2 小时
【测试地点】[线上/线下]
【测试内容】
- 发送消息（文字、图片、文件）
- 拖拽和粘贴上传文件
- 网络异常情况测试

【福利】
- 测试补贴：XXX 元
- 提供茶点和零食
- 您的反馈将帮助改进产品

【报名方式】回复本邮件确认参与时间

感谢您的支持！
```

---

### 5. 测试流程说明

#### 5.1 测试前会议（15分钟）
**目的**: 让测试用户了解测试内容和流程

**议程**:
1. 项目背景介绍（3分钟）
   - 我们在做什么
   - 为什么需要测试

2. 功能演示（5分钟）
   - 演示基本的发送消息功能
   - 演示文件上传功能

3. 测试任务说明（5分钟）
   - 测试用例介绍
   - 如何记录问题

4. 答疑（2分钟）
   - 回答用户疑问

#### 5.2 测试执行（90分钟）

**时间分配**:
- Phase 1 测试（40分钟）
  - 消息发送测试（15分钟）
  - 失败重试测试（15分钟）
  - 刷新页面测试（10分钟）

- Phase 2 测试（40分钟）
  - 拖拽上传测试（15分钟）
  - 粘贴上传测试（15分钟）
  - 进度显示测试（10分钟）

- 自由探索（10分钟）
  - 用户自由测试
  - 尝试发现新问题

#### 5.3 测试后访谈（15分钟）

**访谈问题**:
1. 整体感觉如何？（1-5分）
2. 最喜欢的功能是什么？
3. 最不喜欢的功能是什么？
4. 遇到了哪些困惑？
5. 有什么改进建议？

#### 5.4 问题汇总（30分钟）
- 整理测试结果
- 统计通过率
- 记录问题清单
- 优先级排序

---

## 🛠️ 环境配置检查

### 数据库连接检查
```bash
# 测试 MySQL 连接
mysql -h 172.168.20.222 -P 3306 -u im -p123456 im -e "SELECT 1"

# 预期输出: 1
```

### Redis 连接检查
```bash
# 测试 Redis 连接
redis-cli -h 172.168.20.222 -p 6379 -a 123456 PING

# 预期输出: PONG
```

### 服务状态检查
```bash
# 检查后端服务
curl http://localhost:8080/api/im/user/current

# 预期输出: 用户信息 JSON

# 检查前端服务
curl http://localhost:5173

# 预期输出: HTML 页面
```

---

## 📊 测试数据收集

### 收集工具
1. **截图工具**: Snipping Tool, ShareX
2. **录屏工具**: OBS Studio, Loom
3. **笔记工具**: 测试用例文档、Excel

### 收集内容
- [ ] 问题截图
- [ ] 问题录屏（可选）
- [ ] 浏览器控制台日志
- [ ] 网络请求记录
- [ ] 用户反馈录音（可选）

---

## ⚠️ 常见问题处理

### 问题1: 后端启动失败
**症状**: 后端服务无法启动或报错

**解决方案**:
1. 检查 MySQL 连接配置
2. 检查 Redis 连接配置
3. 检查端口 8080 是否被占用
4. 查看错误日志

### 问题2: 前端连接不上后端
**症状**: 前端报错 "Network Error"

**解决方案**:
1. 确认后端服务已启动
2. 检查 Vite 代理配置
3. 检查 CORS 配置
4. 查看浏览器 Network 面板

### 问题3: 测试账号无法登录
**症状**: 登录失败或密码错误

**解决方案**:
1. 重置测试账号密码
2. 检查账号状态是否正常
3. 创建新的测试账号

---

## ✅ 准备完成检查

### 开发人员检查清单
- [ ] 后端服务正常启动
- [ ] 前端服务正常启动
- [ ] 数据库连接正常
- [ ] Redis 连接正常
- [ ] 测试账号已创建
- [ ] 测试会话数据已准备
- [ ] 测试文件已准备

### 测试负责人检查清单
- [ ] 测试用例文档已准备
- [ ] 测试用户已招募
- [ ] 测试环境已确认
- [ ] 测试工具已安装
- [ ] 反馈收集模板已准备
- [ ] 测试时间已安排

---

## 📞 联系方式

**测试负责人**: _________________
**开发负责人**: _________________
**紧急联系**: _________________

---

**准备完成日期**: _________________
**准备确认签字**: _________________
