# 若依 IM (ruoyi-im-web) 前端技术实现方案建议书

## 1. 核心技术栈选型建议

针对 `stitch_im` 设计稿展现的高交互、多场景、仿钉钉视觉风格，建议采用以下技术栈组合：

| 维度 | 推荐选型 | 理由 |
| :--- | :--- | :--- |
| **基础框架** | **Vue 3 (Composition API)** | 项目现有选型，具备极高的灵活性、轻量级且生态成熟。 |
| **构建工具** | **Vite 5.x** | 提供极致的热更新速度，支持 HMR，极大提升大规模组件开发效率。 |
| **样式方案** | **Tailwind CSS + SCSS** | `code.html` 样例已证明 Tailwind 在快速还原设计稿布局（边距、圆角、阴影）方面的效率。SCSS 用于封装复杂业务组件样式。 |
| **状态管理** | **Pinia** | 解决 IM 系统中会话状态、用户信息、未读数等跨组件共享的复杂逻辑，语法简洁。 |
| **通信协议** | **Websocket (Socket.io) + Axios** | 实现消息实时推送。建议封装统一的 `Request` 与 `Socket` 处理中心。 |

---

## 2. 响应式与布局方案

### 2.1 "三栏式" 仿钉钉结构
- **实现方案**：推荐使用 **CSS Grid** 定义顶层结构。
  - 第一栏（20px-60px）：侧边固定导航。
  - 第二栏（250px-300px）：任务/会话列表，建议可手动拖拽调整宽度。
  - 第三栏（Flex-1）：主内容区。
  - 第四栏（可选）：右侧详情侧边栏（如日历详情 `v1_1`），采用 `Absolute` 或 `Fixed` 覆盖/挤压模式。

### 2.2 暗黑模式 (Dark Mode)
- **实现建议**：基于 Tailwind CSS 的 `class` 模式。
- **实施**：在 `html` 标签上切换 `.dark` 类，通过 CSS 变量 (`--bg-primary`, `--text-main`) 统一管理色值，确保 `v1_28` 所示的深色体验无缝切换。

---

## 3. UI 组件库与视觉还原

### 3.1 组件库推荐
- **主库**：**Element Plus**。作为若依生态的标配，适合处理表单、对话框、日期选择等标准交互。
- **增强库**：
  - **VueUse**：提供丰富的 Composition API，处理 `onClickOutside` (右键菜单关闭)、`useWindowSize` (布局适配) 等。
  - **Headless UI / Shadcn Vue**：用于高度定制化的复杂组件（如 `v1_7` 的快捷菜单、`v1_11` 的云文档菜单），不带预设模式，方便 100% 还原设计。

### 3.2 图标系统
- **推荐**：**Material Icons Outlined** (设计稿引用) + **Iconify**。
- **理由**：Iconify 可以按需加载几乎所有主流图标库，兼具维护性。

---

## 4. 动画与交互体验

### 4.1 核心动画建议
- **布局切换**：使用 Vue 的 `<Transition>` 和 `<TransitionGroup>` 处理面板滑入滑出。
- **微交互**：
  - 加载状态：使用精美的 Skeleton 骨架屏（对标 `v1_14` 加载期）。
  - 消息气泡：引入轻微的位移和淡入动画，提升沟通的平滑感。
- **高级动效库**：**Motion One (Vue)**。它是基于 Web Animations API 的现代库，性能极佳，适合处理复杂的工作台九宫格排序或卡片缩放。

---

## 5. 性能优化策略 (针对 IM 特性)

1.  **消息列表长列表优化**：务必使用 **虚拟列表 (Virtual Scroller)**。当会话消息过万时，仅渲染可视区域，避免 DOM 节点过多导致的卡顿。
2.  **图片/附件延迟加载**：聊天中的图片使用懒加载，且在上传时进行前端预压缩。
3.  **离线存储与持久化**：使用 **IndexDB (Pinia Plugin Persist)** 存储历史消息草稿或联系人索引，减少首屏对 API 的依赖。
4.  **资源按需加载**：利用 Vite 的代码分割，将“日历”、“云文档”、“审批”等独立大板块做异步组件加载。

---

## 6. 开发流程与规范建议

1.  **设计稿 Token 化**：在开发前，将 `stitch_im` 中的常用色值、间距、字号定义为 Tailwind 的 `extend` 配置。
2.  **组件驱动开发 (CDD)**：优先实现独立的小型 UI 组件（如：Avatar、StatusBadge、SessionItem），再组装成大页面。
3.  **右键菜单抽象**：设计稿中大量出现右键菜单。建议开发一个全局指令或 Hook 驱动的通用右键菜单管理系统。
4.  **Mock 数据先行**：前端可基于设计稿的数据量级先进行 Mock 开发，确保在后端接口联调前完成 UI 逻辑的 90%。

---
*拟稿人：Antigravity*
*日期：2026-01-23*
