/**
 * 消息气泡对齐修复 - 对齐钉钉/野火IM标准
 * 
 * 问题诊断：
 * - 当前使用 `align-items: flex-start` 导致头像和气泡不在一条直线上
 * - 钉钉/野火IM 要求：头像和气泡必须在一条直线上（垂直居中对齐）
 * 
 * 修复方案：
 * - 将所有对齐改为 `center` 或 `baseline`
 * - 确保头像和气泡的垂直中轴线对齐
 */

// ============================================================================
// 问题：当前消息气泡布局
// ============================================================================
/*
当前结构（MessageItemRefactored.vue）：

.message-item {
  display: flex;
  align-items: flex-start;  // ❌ 问题所在！
}

.message-avatar {
  // 头像
}

.content-wrapper {
  // 气泡区域
}

当前对齐：
头像底部 ───────────┬────── 气泡顶部 (flex-start)

钉钉/野火IM要求：
头像中部 ═══════════════════════════════════
气泡中部 ═════════════════════════════════ (垂直居中对齐)
头像底部 ═════════════════════════════════
气泡底部
*/

// ============================================================================
// 修复方案 1：垂直居中对齐（推荐）
// ============================================================================

.message-item {
  display: flex;
  align-items: center; // ✅ 修复：垂直居中对齐
  min-height: var(--dt-avatar-size-md) + 8px; // 头像高度 + 上下间距
  
  // 头像容器
  .avatar-wrapper {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  // 内容区域（包括气泡）
  .content-wrapper {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  
  // 气泡行
  .bubble-row {
    display: flex;
    flex: 1;
    min-width: 0;
    flex-shrink: 0;
    flex-wrap: wrap;
    align-items: center; // ✅ 修复：气泡内部也居中对齐
  }
  
  // 消息气泡
  .message-bubble {
    margin-bottom: 8px;
    
    &.is-left {
      align-self: flex-start; // 左侧气泡顶部对齐
    }
    
    &.is-right {
      align-self: flex-end; // 右侧气泡顶部对齐
    }
  }
}

// ============================================================================
// 修复方案 2：基线对齐（钉钉桌面端风格）
// ============================================================================

.message-item {
  display: flex;
  align-items: baseline; // ✅ 基线对齐：头像和气泡文字基线对齐
  
  // 头像
  .avatar-wrapper {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  // 气泡区域
  .content-wrapper {
    flex: 1;
    min-width: 0;
  display: flex;
    align-items: center;
  }
  
  // 气泡
  .message-bubble {
    &.is-left {
      margin-top: 8px; // 谔泡顶部间距
      margin-bottom: 12px;
    }
    
    &.is-right {
      margin-top: 8px; // 气泡顶部间距
      margin-bottom: 12px;
    }
  }
}

// ============================================================================
// 消息气泡优化（对齐钉钉/野火IM标准）
// ============================================================================

.message-bubble {
  padding: var(--dt-space-md) var(--dt-space-lg);
  border-radius: var(--dt-radius-lg);
  max-width: 70%;
  transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  
  // 接收方气泡 - 纯白 + 微妙阴影
  &.is-left {
    background: var(--dt-bubble-left-bg);
    border: 1px solid var(--dt-bubble-left-border);
    border-radius: var(--dt-radius-lg) var(--dt-radius-lg) 4px; // 左侧锐角
    box-shadow: var(--dt-bubble-left-shadow);
    color: var(--dt-text-primary);
    
    &:hover {
      box-shadow: var(--dt-bubble-left-shadow-hover);
      transform: translateY(-1px);
    }
  }
  
  // 发送方气泡 - 钉钉蓝渐变 + 立体阴影
  &.is-right {
    background: linear-gradient(135deg,
                  var(--dt-bubble-right-bg-start) 0%,
                  var(--dt-bubble-right-bg-end) 100%
    );
    border-radius: 4px var(--dt-radius-lg) var(--dt-radius-lg); // 右侧锐角
    box-shadow: var(--dt-bubble-right-shadow);
    color: var(--dt-bubble-right-text);
    
    &:hover {
      background: linear-gradient(135deg,
                    var(--dt-brand-hover) 0%,
                    var(--dt-bubble-right-bg-end) 100%
                  );
      box-shadow: var(--dt-bubble-right-shadow-hover);
      transform: translateY(-1px);
    }
  }
  
  // 气泡进入动画
  &.is-right {
    animation: bubbleInRight 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  
  &.is-left {
    animation: bubbleInLeft 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
}

// 动画关键帧
@keyframes bubbleInRight {
  0% {
    opacity: 0;
    transform: translateX(20px) scale(0.95);
  }
  100% {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
}

@keyframes bubbleInLeft {
  0% {
    opacity: 0;
    transform: translateX(-20px) scale(0.95);
  }
  100% {
    opacity: 1;
    transform: translateX(0) scale(1);
  }
}

// ============================================================================
// 钉钉风格消息气泡设计参考
// ============================================================================

/* 钉钉消息气泡特点：
 * 1. 接收方：纯白背景 + 微妙阴影
 * 2. 发送方：蓝色渐变 + 立体阴影
 * 3. 对齐：头像和气泡必须在一条直线上
 * 4. 圆角：发送方右侧圆角锐角，接收方左侧圆角锐角
 * 5. 间距：气泡间 12px，与头像对齐
 */

// ============================================================================
// 具体实现参考：野火IM
// ============================================================================
/*
野火IM 消息气泡特点：
 * 1. 与钉钉类似的设计系统
 * 2. 微妙的阴影层次
 * 3. 专业的圆角处理
 * 4. 顶部对齐，头像在一条直线上
 * 5. 发送方带渐变效果
 */

// ============================================================================
// 使用说明
// ============================================================================

/*
在 MessageItemRefactored.vue 中应用修复：

<style lang="scss" scoped>
@use '@/styles/im-design-system.scss' as *;

.message-item {
  display: flex;
  align-items: center; // ✅ 关键修复：改为 center
  min-height: 40px + 8px;
  
  .avatar-wrapper {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .content-wrapper {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  
  .bubble-row {
    display: flex;
    flex: 1;
    min-width: 0;
    flex-shrink: 0;
    flex-wrap: wrap;
    align-items: center;
    
    .message-bubble {
      margin: 0;
      max-width: 70%;
      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      
      &.is-left {
        background: var(--dt-bubble-left-bg);
        border: 1px solid var(--dt-bubble-left-border);
        border-radius: 8px 8px 8px 4px;
        box-shadow: var(--dt-bubble-left-shadow);
        color: var(--dt-text-primary);
        
        &:hover {
          box-shadow: var(--dt-bubble-left-shadow-hover);
          transform: translateY(-1px);
        }
      }
      
      &.is-right {
        background: linear-gradient(135deg,
                      var(--dt-bubble-right-bg-start) 0%,
                      var(--dt-bubble-right-bg-end) 100%
        );
        border-radius: 4px 8px 8px 8px;
        box-shadow: var(--dt-bubble-right-shadow);
        color: var(--dt-bubble-right-text);
        
        &:hover {
          background: linear-gradient(135deg,
                        var(--dt-brand-hover) 0%,
                        var(--dt-bubble-right-bg-end) 100%
                      );
          box-shadow: var(--dt-bubble-right-shadow-hover);
          transform: translateY(-1px);
        }
      }
    }
  }
}
</style>
*/
