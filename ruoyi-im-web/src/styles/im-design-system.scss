// ============================================================================
// IM 设计系统 - 对齐钉钉/野火IM
// ============================================================================
//
// 设计参考：
// 1. 钉钉：https://ding.design/ - 企业级设计系统
// 2. 野火IM：https://docs.wildfirechat.cn/ - 专业IM解决方案
//
// 设计原则：
// - 清晰的信息层次
// - 统一的视觉语言
// - 流畅的交互反馈
// - 专业的企业风格
// ============================================================================

// 引入 design-tokens 以获取 mixins（text-ellipsis 等）
@use './design-tokens.scss' as *;

// ============================================================================
// 一、颜色系统 - 使用 design-tokens.scss 中的变量，不再重复定义
// ============================================================================

// ============================================================================
// 三、消息气泡组件样式（对标钉钉/野火IM）
// ============================================================================

// 注意：颜色值使用design-tokens.scss中的CSS变量
.message-bubble-wrapper {
  display: inline-block;
  max-width: 70%;
  margin-bottom: var(--dt-space-md);
  
  .message-bubble {
    position: relative;
    display: inline-block;
    padding: var(--dt-space-md) var(--dt-space-lg);
    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;

    // 接收方气泡
    &.is-left {
      background: var(--dt-bubble-left-bg);
      border: 1px solid var(--dt-bubble-left-border);
      border-radius: 6px;
      box-shadow: var(--dt-shadow-1);
      color: var(--dt-text-primary);

      &:hover {
        box-shadow: var(--dt-shadow-2);
      }
    }

    // 发送方气泡
    &.is-right {
      background: var(--dt-bubble-right-bg);
      border-radius: 6px;
      box-shadow: var(--dt-shadow-1);
      color: var(--dt-bubble-right-text);

      &:hover {
        background: var(--dt-bubble-right-bg-hover);
        box-shadow: var(--dt-shadow-2);
      }
    }
  }

  // 气泡内容区域
  .bubble-content {
    line-height: var(--dt-line-height-base);
    
    .text-content {
      word-wrap: break-word;
      white-space: pre-wrap;
    }
  }

  // 消息时间
  .message-time {
    font-size: var(--dt-font-size-xs);
    color: var(--dt-text-quaternary);
    margin-top: var(--dt-space-xs);
    text-align: right;
  }

  // 已读状态
  .read-status {
    display: flex;
    align-items: center;
    gap: var(--dt-space-xs);
    margin-top: var(--dt-space-xs);
    font-size: var(--dt-font-size-xs);
    color: var(--dt-read-color);

    .read-icon {
      font-size: 14px;
      opacity: 0.8;
    }
  }
}

// ============================================================================
// 五、会话列表样式（对标钉钉/野火IM）
// ============================================================================

.session-list {
  .session-item {
    display: flex;
    align-items: center;
    padding: var(--dt-space-md) var(--dt-space-lg);
    height: var(--dt-session-item-height);
    border-radius: var(--dt-radius-lg);
    transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
    position: relative;

    // 悬停效果
    &:hover {
      background: var(--dt-bg-card-hover);
    }

    // 激活状态
    &.active {
      background: var(--dt-bg-session-active);
    }

    // 头像
    .session-avatar {
      flex-shrink: 0;
      width: var(--dt-avatar-size-md);
      height: var(--dt-avatar-size-md);
      border-radius: var(--dt-radius-md);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      position: relative;

      // 在线状态点
      .status-dot {
        position: absolute;
        bottom: 2px;
        right: 2px;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        border: 2px solid var(--dt-bg-card);

        &.online {
          background: var(--dt-success-color);
        }

        &.offline {
          background: var(--dt-text-quaternary);
        }
      }
    }

    // 会话信息
    .session-info {
      flex: 1;
      min-width: 0;
      margin-left: var(--dt-space-md);
      overflow: hidden;

      .session-name {
        font-size: var(--dt-font-size-md);
        font-weight: var(--dt-font-weight-medium);
        color: var(--dt-text-primary);
        margin-bottom: 2px;
        @include text-ellipsis;
      }

      .session-preview {
        font-size: var(--dt-font-size-sm);
        color: var(--dt-text-tertiary);
        @include text-ellipsis;
      }

      .session-time {
        font-size: var(--dt-font-size-xs);
        color: var(--dt-text-quaternary);
        flex-shrink: 0;
        margin-left: var(--dt-space-sm);
      }
    }

    // 未读消息标记
    .unread-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 20px;
      height: 20px;
      padding: 0 6px;
      font-size: var(--dt-font-size-xs);
      font-weight: var(--dt-font-weight-bold);
      color: #FFFFFF;
      background: var(--dt-unread-color);
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(255, 77, 79, 0.3);
      flex-shrink: 0;
    }
  }
}

// ============================================================================
// 六、侧边栏导航（对标钉钉设计）
// ============================================================================

.dingtalk-nav {
  width: var(--dt-nav-sidebar-width);
  height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: var(--dt-space-md) 0 var(--dt-space-lg);
  background: var(--dt-brand-color);
  color: white;
  z-index: 100;

  // Logo
  .nav-logo-wrapper {
    margin-bottom: var(--dt-space-xl);

    .nav-logo {
      width: var(--dt-nav-logo-size);
      height: var(--dt-nav-logo-size);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--dt-radius-md);
      background: rgba(255, 255, 255, 0.1);
      transition: background 0.2s var(--dt-ease-in-out);

      &:hover {
        background: rgba(255, 255, 255, 0.15);
      }

      .nav-logo-text {
        font-size: 18px;
        font-weight: 700;
        letter-spacing: -0.5px;
      }
    }
  }

  // 导航项
  .nav-items {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: var(--dt-space-xs);
    width: 100%;
    overflow-y: auto;
    overflow-x: hidden;

    .nav-item {
      width: var(--dt-nav-item-size);
      height: var(--dt-nav-item-size);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--dt-radius-md);
      color: rgba(255, 255, 255, 0.7);
      transition: all 0.2s var(--dt-ease-in-out);
      position: relative;
      cursor: pointer;

      &:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
      }

      &.nav-item-active {
        background: rgba(255, 255, 255, 0.15);
        color: white;

        &::before {
          content: '';
          position: absolute;
          left: -12px;
          width: 3px;
          height: 20px;
          background: white;
          border-radius: 0 2px 2px 0;
        }
      }

      .nav-item-icon {
        font-size: 22px;
      }
    }
  }

  // 底部操作区
  .nav-footer {
    display: flex;
    flex-direction: column;
    gap: var(--dt-space-xs);
    width: 100%;

    .nav-item-action {
      width: var(--dt-nav-item-size);
      height: var(--dt-nav-item-size);
    }
  }
}

// ============================================================================
// 七、输入区域（对标钉钉/野火IM）
// ============================================================================

.chat-input-container {
  background: var(--dt-bg-card);
  border-top: 1px solid var(--dt-border-light);
  display: flex;
  flex-direction: column;

  // 调整高度手柄
  .resize-handle {
    height: 4px;
    background: var(--dt-bg-card);
    border-top: 1px solid var(--dt-border-light);
    cursor: ns-resize;
    transition: background 0.2s var(--dt-ease-in-out);

    &:hover {
      background: var(--dt-bg-card-hover);
    }
  }

  // 工具栏
  .input-toolbar {
    display: flex;
    align-items: center;
    padding: var(--dt-space-sm) var(--dt-space-md);
    gap: var(--dt-space-sm);
    border-bottom: 1px solid transparent;
    transition: border-color 0.15s ease;

    &.is-focused {
      border-color: var(--dt-border-light);
    }

    .tool-btn {
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--dt-radius-sm);
      color: var(--dt-text-tertiary);
      transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      cursor: pointer;

      &:hover {
        background: var(--dt-bg-card-hover);
        color: var(--dt-brand-color);
      }

      &:active {
        background: var(--dt-brand-bg);
      }

      &.is-active {
        background: var(--dt-brand-bg);
        color: var(--dt-brand-color);
      }
    }
  }

  // 输入区域
  .input-area {
    padding: var(--dt-space-md) var(--dt-space-lg);

    .message-input {
      width: 100%;
      min-height: var(--dt-chat-input-min-height);
      max-height: 300px;
      padding: var(--dt-space-md) var(--dt-space-lg);
      border: 1px solid var(--dt-border-input);
      border-radius: var(--dt-radius-md);
      font-family: var(--dt-font-family);
      font-size: var(--dt-font-size-base);
      line-height: 1.6;
      color: var(--dt-text-primary);
      background: var(--dt-bg-input);
      resize: none;
      outline: none;
      transition: all 0.2s var(--dt-ease-in-out);

      &:focus {
        border-color: var(--dt-border-input-focus);
        background: var(--dt-bg-card);
        box-shadow: 0 0 0 3px var(--dt-brand-light);
      }

      &::placeholder {
        color: var(--dt-text-quaternary);
      }
    }
  }
}

// ============================================================================
// 八、动画系统（保留功能性动画）
// ============================================================================

// 输入指示器动画（功能性，保留）
@keyframes typingDot {
  0%, 80%, 100% {
    opacity: 0.3;
    transform: scale(0.8);
  }
  40% {
    opacity: 1;
    transform: scale(1);
  }
}

.typing-indicator {
  display: flex;
  gap: 4px;

  .dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--dt-text-tertiary);
    animation: typingDot 1.4s infinite;

    &:nth-child(2) {
      animation-delay: 0.2s;
    }

    &:nth-child(3) {
      animation-delay: 0.4s;
    }
  }
}

// ============================================================================
// 十、工具类 Mixins - 使用 design-tokens.scss 中的定义，不再重复
// ============================================================================

// ============================================================================
// 十一、暗色模式（IM专用调整）
// ============================================================================

// 注意：基础暗色变量已在design-tokens.scss中定义
// 这里只定义IM组件的暗色模式调整

.dark {
  background: var(--dt-bg-body-dark);
  color: var(--dt-text-primary-dark);

  .message-bubble {
    &.is-left {
      background: var(--dt-bubble-left-bg-dark);
      border-color: var(--dt-bubble-left-border-dark);
      color: var(--dt-text-primary-dark);
    }

    &.is-right {
      background: var(--dt-brand-color);
      color: var(--dt-bubble-right-text);
    }
  }

  .dingtalk-nav {
    background: #1E3A8A;
  }
}

// ============================================================================
// 十二、响应式断点（桌面端优化）
// ============================================================================

:root {
  --dt-breakpoint-xs: 1280px;
  --dt-breakpoint-sm: 1440px;
  --dt-breakpoint-md: 1600px;
  --dt-breakpoint-lg: 1920px;
}

@media (max-width: var(--dt-breakpoint-xs)) {
  :root {
    --dt-session-panel-width: 240px;
    --dt-session-item-height: 60px;
  }
}

@media (min-width: var(--dt-breakpoint-sm)) 
      and (max-width: var(--dt-breakpoint-md)) {
  :root {
    --dt-session-panel-width: 260px;
  }
}

@media (min-width: var(--dt-breakpoint-lg)) {
  :root {
    --dt-session-panel-width: 280px;
    --dt-session-item-height: 68px;
  }
}

@media (min-width: var(--dt-breakpoint-xl)) {
  :root {
    --dt-session-panel-width: 320px;
  }
}
