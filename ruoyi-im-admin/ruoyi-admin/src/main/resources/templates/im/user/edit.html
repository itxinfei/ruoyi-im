<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:include="include :: header('修改IM用户')" />
    <th:block th:include="include :: bootstrap-fileinput-css"/>
    <style>
        /* ============================================
           编辑用户页面 - 现代化精美样式
           主色: #1ab394 (若依青绿)
           ============================================ */
        :root {
            --primary-color: #1ab394;
            --primary-hover: #18a689;
            --primary-light: rgba(26,179,148,0.1);
            --success-color: #52c41a;
            --warning-color: #f8ac59;
            --danger-color: #ed5565;
            --text-primary: #262626;
            --text-secondary: #595959;
            --text-tertiary: #8c8c8c;
            --border-color: #e0e0e0;
            --border-light: #e8e8e8;
            --bg-light: #fafafa;
            --bg-card: #ffffff;
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
        }

        body { background: #f0f2f8 !important; }
        .ibox-content {
            background: linear-gradient(135deg, #fff 0%, #fafbfc 100%);
            border-radius: var(--radius-lg);
            box-shadow: 0 4px 20px rgba(0,0,0,0.06), 0 0 1px rgba(0,0,0,0.04);
            padding: 32px !important;
            max-width: 100%;
            margin: 0;
            border: 1px solid #e8e8e8;
        }

        /* 表单标题 */
        .form-header {
            margin-bottom: 28px;
            text-align: center;
            padding-bottom: 20px;
            border-bottom: 1px solid #f0f0f0;
        }
        .form-title {
            font-size: 22px;
            font-weight: 600;
            color: var(--text-primary);
            letter-spacing: 0.3px;
        }
        .form-desc {
            font-size: 13px;
            color: var(--text-tertiary);
            margin-top: 6px;
        }

        /* 表单分组 */
        .form-section { margin-bottom: 28px; }
        .form-section-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-primary);
            padding-bottom: 10px;
            margin-bottom: 18px;
            border-bottom: 2px solid var(--primary-light);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .form-section-title i {
            color: var(--primary-color);
            font-size: 16px;
        }

        .form-group { margin-bottom: 18px; }
        .form-group:last-child { margin-bottom: 0; }

        .control-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            padding-top: 6px;
            margin-bottom: 6px;
            letter-spacing: 0.3px;
        }
        .control-label.required::before { content: '*'; color: var(--danger-color); margin-right: 4px; }

        .form-control {
            height: 40px;
            padding: 8px 14px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 14px;
            transition: all 0.25s ease;
            background: #fff;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26,179,148,0.1);
            outline: none;
            background: #fff;
        }

        .form-control:hover {
            border-color: #d0d0d0;
        }

        .form-control::placeholder { color: #bfbfbf; }
        .form-control[readonly] {
            background: linear-gradient(135deg, var(--bg-light) 0%, #f0f0f0 100%);
            cursor: not-allowed;
            color: var(--text-tertiary);
            border-color: var(--border-light);
        }

        /* 帮助文本 */
        .help-text {
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 5px;
        }

        /* 单选框 */
        .radio-group { display: flex; gap: 24px; }
        .radio-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            transition: all 0.2s;
        }
        .radio-label:hover { background: var(--bg-light); }
        .radio-label input { margin: 0; }

        /* 头像选择区 */
        .avatar-section {
            display: flex;
            gap: 20px;
            margin-bottom: 28px;
            align-items: flex-start;
        }
        .avatar-form { flex: 1; }

        .avatar-preview-box {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: 2px dashed var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--bg-light) 0%, #f0f0f0 100%);
            overflow: hidden;
            flex-shrink: 0;
            transition: all 0.2s;
        }
        .avatar-preview-box:hover {
            border-color: var(--primary-color);
        }
        .avatar-preview-box img { width: 100%; height: 100%; object-fit: cover; }
        .avatar-preview-box i { font-size: 30px; color: var(--text-tertiary); }

        .avatar-label {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }
        .avatar-upload {
            font-size: 13px;
            color: var(--primary-color);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: var(--radius-sm);
            transition: all 0.2s;
        }
        .avatar-upload:hover {
            background: var(--primary-light);
        }

        /* 按钮区 */
        .form-actions {
            margin-top: 36px;
            padding-top: 24px;
            border-top: 1px solid var(--border-light);
            display: flex;
            justify-content: flex-end;
            gap: 14px;
        }
        .btn {
            height: 40px;
            padding: 0 28px;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
            transition: all 0.25s ease;
            letter-spacing: 0.3px;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover) 100%);
            border-color: var(--primary-color);
            color: #fff;
            box-shadow: 0 2px 8px rgba(26,179,148,0.25);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(26,179,148,0.35);
        }
        .btn-default {
            background: #fff;
            border-color: var(--border-color);
            color: var(--text-primary);
        }
        .btn-default:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        @media (max-width: 600px) {
            .avatar-section { flex-direction: column; }
            .avatar-preview-box { margin: 0 auto; }
            .form-actions { flex-direction: column-reverse; }
            .btn { width: 100%; }
        }
    </style>
</head>
<body class="white-bg">
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="ibox-content">
            <div class="form-header">
                <div class="form-title">编辑用户</div>
                <div class="form-desc">修改用户基本信息</div>
            </div>

            <form class="form-horizontal m" id="form-user-edit" th:object="${user}">
                <input name="id" th:field="*{id}" type="hidden">
                <input type="hidden" name="avatar" th:field="*{avatar}" id="avatarInput">

                <!-- 头像 -->
                <div class="form-section">
                    <div class="avatar-section">
                        <div class="avatar-preview-box" id="avatarPreview">
                            <i class="fa fa-user"></i>
                        </div>
                        <div class="avatar-form">
                            <div class="avatar-label">用户头像</div>
                            <label class="avatar-upload" onclick="$('#avatarFile').click()">
                                <i class="fa fa-upload"></i> 更换头像
                            </label>
                            <input type="file" id="avatarFile" class="file" style="display: none;" accept="image/png,image/jpeg,image/gif">
                        </div>
                    </div>
                </div>

                <!-- 基本信息 -->
                <div class="form-section">
                    <div class="form-section-title">
                        <i class="fa fa-user-circle"></i>基本信息
                    </div>

                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label">用户名</label>
                                <input name="username" th:field="*{username}" class="form-control" readonly>
                                <div class="help-text">用户名不可修改</div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label required">昵称</label>
                                <input name="nickname" th:field="*{nickname}" class="form-control" required>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label">手机号</label>
                                <input name="mobile" th:field="*{mobile}" class="form-control">
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label">邮箱</label>
                                <input name="email" th:field="*{email}" class="form-control" type="email">
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label">性别</label>
                                <select name="gender" class="form-control" th:with="type=${@dict.getType('sys_user_sex')}">
                                    <option value="">请选择性别</option>
                                    <option th:each="dict : ${type}" th:text="${dict.dictLabel}" th:value="${dict.dictValue}" th:field="*{gender}"></option>
                                </select>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group">
                                <label class="control-label">账号状态</label>
                                <div class="radio-group">
                                    <label class="radio-label">
                                        <input type="radio" name="status" value="1" th:field="*{status}"> 正常
                                    </label>
                                    <label class="radio-label">
                                        <input type="radio" name="status" value="0" th:field="*{status}"> 停用
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 按钮区 -->
                <div class="form-actions">
                    <button type="button" class="btn btn-default" onclick="$.modal.close()">取消</button>
                    <button type="submit" class="btn btn-primary">确定保存</button>
                </div>
            </form>
        </div>
    </div>

    <th:block th:include="include :: footer" />
    <th:block th:include="include :: bootstrap-fileinput-js"/>
    <script th:inline="javascript">
        var prefix = ctx + "im/user";
        var avatarUrl = [[${user.avatar}]];

        $("#form-user-edit").validate({
            focusCleanup: true,
            rules: { nickname: { required: true, minlength: 2, maxlength: 30 }, email: { email: true }, mobile: { isPhone: true } }
        });

        if (avatarUrl) {
            var displayUrl = avatarUrl.startsWith('/') ? avatarUrl : '/' + avatarUrl;
            $('#avatarPreview').html('<img src="' + displayUrl + '">');
        }

        $("#avatarFile").fileinput({
            uploadUrl: ctx + 'common/upload', maxFileCount: 1, autoReplace: true,
            showUpload: false, showCaption: false, dropZoneEnabled: false,
            allowedFileExtensions: ["jpg", "png", "gif", "jpeg"], maxFileSize: 2048,
            showRemove: true
        }).on('fileuploaded', function(e, data) {
            if (data.response && data.response.url) {
                $("input[name='avatar']").val(data.response.url);
                $('#avatarPreview').html('<img src="' + data.response.url + '">');
            }
        });

        function submitHandler() {
            if ($.validate.form()) { $.operate.save(prefix + "/edit", $('#form-user-edit').serialize()); }
        }
    </script>
</body>
</html>
