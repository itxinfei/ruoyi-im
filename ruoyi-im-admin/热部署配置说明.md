# ruoyi-im-admin 热部署配置说明

## 热部署功能已启用

本项目已配置 Spring Boot DevTools 热部署功能，支持代码修改后自动重启应用。

## 配置说明

### 1. Maven 依赖配置

已在 `ruoyi-admin/pom.xml` 中添加 Spring Boot DevTools 依赖：

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
    <optional>true</optional>
</dependency>
```

### 2. 应用配置

已在 `application.yml` 中配置热部署相关设置：

```yaml
spring:
  devtools:
    restart:
      enabled: true
    exclude: static/**,public/**
    livereload:
      enabled: true
      port: 35729
```

## 使用方法

### 方式一：IDEA 自动编译（推荐）

1. 在 IDEA 中打开项目
2. 确保 Build > Build project automatically 选项已勾选
3. 启动应用
4. 修改 Java 代码后，IDEA 会自动编译，应用会自动重启
5. 修改静态资源（HTML、CSS、JS）后，浏览器会自动刷新

### 方式二：Maven 命令编译

1. 启动应用
2. 修改代码后，执行以下命令编译：
   ```bash
   mvn compile
   ```
3. 应用会检测到 class 文件变化并自动重启

### 方式三：IDEA 手动编译

1. 启动应用
2. 修改代码后，按 `Ctrl + F9` 或点击 Build > Rebuild Project
3. 应用会自动重启

## 注意事项

### 1. 热部署范围

- ✅ 支持：Java 类文件修改
- ✅ 支持：配置文件修改
- ✅ 支持：静态资源修改（HTML、CSS、JS）
- ❌ 不支持：新增/删除 Java 类文件（需要重启）
- ❌ 不支持：修改 pom.xml 依赖（需要重启）

### 2. 排除资源

以下资源目录已排除在热部署之外，修改后不会触发重启：
- `static/**` - 静态资源
- `public/**` - 公共资源

静态资源修改会通过 LiveReload 自动刷新浏览器。

### 3. 性能影响

- 首次启动时间：正常
- 重启时间：约 3-5 秒
- 内存占用：略微增加（约 50-100MB）

### 4. 生产环境

生产环境建议禁用热部署：

```yaml
spring:
  devtools:
    restart:
      enabled: false
```

或在启动时使用生产环境配置：
```bash
java -jar ruoyi-admin.jar --spring.profiles.active=prod
```

## 常见问题

### Q1: 修改代码后没有自动重启？

**解决方案**：
1. 检查 IDEA 的 Build > Build project automatically 是否勾选
2. 检查 application.yml 中 `spring.devtools.restart.enabled` 是否为 `true`
3. 尝试手动执行 `mvn compile` 命令

### Q2: 重启后页面没有刷新？

**解决方案**：
1. 检查浏览器是否安装了 LiveReload 插件
2. 检查防火墙是否阻止了 35729 端口
3. 手动刷新浏览器页面（F5）

### Q3: 热部署导致应用启动失败？

**解决方案**：
1. 暂时禁用热部署排查问题
2. 检查是否有编译错误
3. 清理 Maven 缓存：`mvn clean`

### Q4: 如何完全禁用热部署？

**解决方案**：
在 `application.yml` 中设置：
```yaml
spring:
  devtools:
    restart:
      enabled: false
```

或在 `pom.xml` 中注释掉 DevTools 依赖。

## 技术原理

Spring Boot DevTools 使用两个 ClassLoader：
- **restart ClassLoader**：加载应用类，支持热重载
- **base ClassLoader**：加载第三方库，不参与热重载

当检测到 class 文件变化时：
1. 停止应用
2. 重新加载修改的类
3. 重启应用

## 相关链接

- [Spring Boot DevTools 官方文档](https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.devtools)
- [IDEA 热部署配置](https://www.jetbrains.com/help/idea/compiler.html)
