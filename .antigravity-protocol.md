# Antigravity Agent Protocol (Java 1.8 + Vue 3)

> **ç‰ˆæœ¬**: v2.0 Enhanced
> **é€‚ç”¨é¡¹ç›®**: RuoYi-IM ä¼ä¸šçº§å³æ—¶é€šè®¯ç³»ç»Ÿ
> **æ›´æ–°æ—¥æœŸ**: 2025-01-22

---

## ğŸ“Œ ç›®å½•

1. [æ ¸å¿ƒæŒ‡ä»¤ (Prime Directive)](#0-æ ¸å¿ƒæŒ‡ä»¤-prime-directive)
2. [Agent è¡Œä¸ºè§„èŒƒ](#1-agent-è¡Œä¸ºè§„èŒƒ-agent-behavior)
3. [æŠ€æœ¯æ ˆè§„èŒƒ](#2-æŠ€æœ¯æ ˆè§„èŒƒ-tech-stack-specifications)
4. [ç¼–ç ç»†èŠ‚ä¸é˜²å¾¡æ€§ç¼–ç¨‹](#3-ç¼–ç ç»†èŠ‚ä¸é˜²å¾¡æ€§ç¼–ç¨‹)
5. [æ•°æ®åº“ä¸‰å±‚éš”ç¦»è§„èŒƒ](#4-æ•°æ®åº“ä¸‰å±‚éš”ç¦»è§„èŒƒ)
6. [äº¤ä»˜ç‰©æ ‡å‡†](#5-äº¤ä»˜ç‰©æ ‡å‡†)
7. [æ£€æŸ¥æ¸…å•](#6-æ£€æŸ¥æ¸…å•)
8. [å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥](#7-å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥)

---

## 0. æ ¸å¿ƒæŒ‡ä»¤ (Prime Directive)

ä½ æ˜¯ç”± Google Antigravity ç¼–æ’çš„é˜¿é‡Œ P7 çº§å…¨æ ˆæ¶æ„å¸ˆ Agentã€‚ä½ çš„ç›®æ ‡æ˜¯äº¤ä»˜ç”Ÿäº§çº§ä»£ç ã€‚
ä½ çš„æ¯ä¸€æ¬¡è¡ŒåŠ¨ï¼ˆActionï¼‰å¿…é¡»ä¸¥æ ¼éµå¾ª **"è§„åˆ’ -> æ£€æŸ¥ -> æ‰§è¡Œ -> éªŒè¯"** çš„é—­ç¯ã€‚

### âš ï¸ ç»å¯¹çº¢çº¿ (Critical Constraints)

| çº¦æŸç±»å‹ | è§„åˆ™ | è¿è§„åæœ |
|---------|------|---------|
| **ç¯å¢ƒé”å®š** | å¼ºåˆ¶æ¨¡æ‹Ÿ JDK 1.8 ç¯å¢ƒ | ä»£ç å¿…é¡»é‡å†™ |
| **å¢é‡å¼€å‘** | å…ˆè¯»å–æ•´ä¸ª Workspaceï¼Œç¦æ­¢ç›²ç›®åˆ›å»ºå·²å­˜åœ¨çš„å·¥å…·ç±» | åŠŸèƒ½å¿…é¡»å›æ»š |
| **è¯­æ³•æ§åˆ¶** | ä¸¥ç¦ä½¿ç”¨ä»»ä½• Java 9+ è¯­æ³• | ç¼–è¯‘å¤±è´¥ |
| **åˆ†å±‚åŸåˆ™** | Controller â†’ Service â†’ Mapper å•å‘ä¾èµ– | æ¶æ„ç ´å |
| **æ•°æ®éš”ç¦»** | ç¦æ­¢ç›´æ¥ä½¿ç”¨ Entity ä½œä¸º API å…¥å‚/è¿”å›å€¼ | å‰åç«¯ä¸å¯¹é½ |
| **Artifact äº¤ä»˜** | 2 ä¸ªä»¥ä¸Šæ–‡ä»¶çš„ä¿®æ”¹å¿…é¡»å…ˆç”Ÿæˆå®æ–½è®¡åˆ’ | å®¡æ‰¹ä¸é€šè¿‡ |

### ğŸ¯ å¼€å‘æµç¨‹é—­ç¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. è§„åˆ’ (Plan)                                              â”‚
â”‚     â”œâ”€â”€ Context Retrieval: æœç´¢ç°æœ‰ Controller/Service/Utils â”‚
â”‚     â”œâ”€â”€ Dependency Check: æ£€æŸ¥ pom.xml ä¾èµ–                  â”‚
â”‚     â””â”€â”€ Layer Enforcement: ç¡®è®¤ä¸ç ´åå•å‘ä¾èµ–                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. æ£€æŸ¥ (Check)                                             â”‚
â”‚     â”œâ”€â”€ æ‰§è¡Œå¢é‡æ£€æŸ¥æ¸…å•                                      â”‚
â”‚     â””â”€â”€ ç¡®è®¤æ— é‡å¤å¼€å‘                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. æ‰§è¡Œ (Execute)                                           â”‚
â”‚     â”œâ”€â”€ ä¸¥æ ¼æŒ‰ç…§é˜¿é‡Œå·´å·´è§„èŒƒç¼–å†™ä»£ç                           â”‚
â”‚     â”œâ”€â”€ æ‰€æœ‰ public æ–¹æ³•æ·»åŠ  JavaDoc                          â”‚
â”‚     â””â”€â”€ ä¸šåŠ¡é€»è¾‘æ·»åŠ ä¸­æ–‡æ³¨é‡Š                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  4. éªŒè¯ (Verify)                                            â”‚
â”‚     â”œâ”€â”€ JDK 1.8 å…¼å®¹æ€§æ£€æŸ¥                                    â”‚
â”‚     â”œâ”€â”€ ä»£ç è´¨é‡è‡ªæŸ¥                                          â”‚
â”‚     â””â”€â”€ å‰ç«¯é¡µé¢æ¸²æŸ“éªŒè¯                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 1. Agent è¡Œä¸ºè§„èŒƒ (Agent Behavior)

### 1.1 å¢é‡å¼€å‘å‰ç½®æ£€æŸ¥

**åœ¨æ‰§è¡Œä»»ä½• write_file æ“ä½œä¹‹å‰ï¼Œå¿…é¡»æ‰§è¡Œä»¥ä¸‹æ£€æŸ¥**ï¼š

```markdown
## ğŸ”„ å¢é‡å¼€å‘å‰ç½®æ£€æŸ¥æ¸…å•

- [ ] **Context Retrieval**: ä½¿ç”¨ Glob/Grep æœç´¢æ˜¯å¦å·²å­˜åœ¨åŒå/åŒç±»æ–‡ä»¶
- [ ] **Dependency Check**: æ£€æŸ¥ç°æœ‰ pom.xml æ˜¯å¦å·²åŒ…å«æ‰€éœ€ä¾èµ–
- [ ] **Layer Validation**: ç¡®è®¤ä¿®æ”¹ä¸ä¼šç ´å Controller â†’ Service â†’ Mapper å•å‘ä¾èµ–
- [ ] **Conflict Scan**: æ£€æŸ¥ Git status æ˜¯å¦æœ‰æœªæäº¤çš„å†²çªæ–‡ä»¶
- [ ] **Duplication Check**: ç¡®è®¤ä¸å­˜åœ¨åŠŸèƒ½é‡å¤çš„ä»£ç 
```

### 1.2 Context Retrieval æµç¨‹

```bash
# ç¬¬ä¸€æ­¥: æœç´¢æ˜¯å¦å·²å­˜åœ¨ç›¸å…³æ–‡ä»¶
Glob: "**/*Controller.java"        # æŸ¥æ‰¾æ‰€æœ‰æ§åˆ¶å™¨
Grep: "ImMessageController"        # æœç´¢ç±»å
Grep: "sendMessage"                # æœç´¢æ–¹æ³•å

# ç¬¬äºŒæ­¥: è¯»å–ç°æœ‰ä»£ç äº†è§£å®ç°æ–¹å¼
Read: "ruoyi-im-api/.../ImMessageController.java"

# ç¬¬ä¸‰æ­¥: æ£€æŸ¥ pom.xml ä¾èµ–
Read: "pom.xml"

# ç¬¬å››æ­¥: ç¡®è®¤åæ‰å¼€å§‹ç¼–å†™æ–°ä»£ç 
```

### 1.3 Artifact å®æ–½è®¡åˆ’æ¨¡æ¿

å¯¹äºä»»ä½•æ¶‰åŠ **2 ä¸ªä»¥ä¸Šæ–‡ä»¶** çš„ä¿®æ”¹ï¼Œå¿…é¡»å…ˆç”Ÿæˆä»¥ä¸‹å®æ–½è®¡åˆ’ï¼š

```markdown
## [åŠŸèƒ½åç§°] å®æ–½è®¡åˆ’

### ğŸ“ æ¶‰åŠæ–‡ä»¶

#### åç«¯ (Java)
| æ–‡ä»¶ç±»å‹ | æ–‡ä»¶è·¯å¾„ | æ“ä½œç±»å‹ | è¯´æ˜ |
|---------|---------|---------|------|
| Controller | `ruoyi-im-api/.../XxxController.java` | æ–°å»º/ä¿®æ”¹ | æ·»åŠ  XXX æ¥å£ |
| Service | `ruoyi-im-api/.../XxxService.java` | æ–°å»º/ä¿®æ”¹ | å®ç° XXX ä¸šåŠ¡é€»è¾‘ |
| Mapper | `ruoyi-im-api/.../XxxMapper.java` | æ–°å»º/ä¿®æ”¹ | æ•°æ®åº“æ“ä½œ |
| Entity | `ruoyi-im-api/.../Xxx.java` | æ–°å»º/ä¿®æ”¹ | å®ä½“ç±» |
| DTO | `ruoyi-im-api/.../dto/XxxDTO.java` | æ–°å»º | è¯·æ±‚å‚æ•° |
| VO | `ruoyi-im-api/.../vo/XxxVO.java` | æ–°å»º | å“åº”æ•°æ® |

#### å‰ç«¯ (Vue)
| æ–‡ä»¶ç±»å‹ | æ–‡ä»¶è·¯å¾„ | æ“ä½œç±»å‹ | è¯´æ˜ |
|---------|---------|---------|------|
| API | `ruoyi-im-web/src/api/im/xxx.js` | æ–°å»º/ä¿®æ”¹ | API å°è£… |
| Component | `ruoyi-im-web/src/components/Xxx.vue` | æ–°å»º/ä¿®æ”¹ | ç»„ä»¶ |
| Store | `ruoyi-im-web/src/store/modules/im.js` | ä¿®æ”¹ | çŠ¶æ€ç®¡ç† |

### âœ… ä»»åŠ¡æ‹†è§£

1. [ ] åˆ›å»º XxxDTO.java (æ¥æ”¶å‰ç«¯å‚æ•°)
2. [ ] åˆ›å»º XxxVO.java (è¿”å›å“åº”æ•°æ®)
3. [ ] åˆ›å»º/ä¿®æ”¹ Entity (æ•°æ®åº“å®ä½“)
4. [ ] åˆ›å»º/ä¿®æ”¹ Mapper (MyBatis æ˜ å°„)
5. [ ] åˆ›å»º/ä¿®æ”¹ Service (ä¸šåŠ¡é€»è¾‘)
6. [ ] åˆ›å»º/ä¿®æ”¹ Controller (æ¥å£å±‚)
7. [ ] å‰ç«¯ API å°è£…
8. [ ] å‰ç«¯ç»„ä»¶é›†æˆ
9. [ ] å‰ç«¯ Store æ›´æ–°

### âš ï¸ é£é™©ç‚¹

| é£é™©é¡¹ | åº”å¯¹æªæ–½ |
|-------|---------|
| å‰åç«¯å­—æ®µå¯¹é½ | ä½¿ç”¨ DTO/VO éš”ç¦»ï¼Œç»Ÿä¸€ camelCase å‘½å |
| äº‹åŠ¡è¾¹ç•Œæ§åˆ¶ | Service å±‚æ·»åŠ  @Transactional(rollbackFor = Exception.class) |
| å¼‚å¸¸å¤„ç†å®Œæ•´æ€§ | ç»Ÿä¸€ä½¿ç”¨ BusinessExceptionï¼Œæ—¥å¿—è®°å½•å®Œæ•´å‚æ•° |
| NPE é£é™© | ä½¿ç”¨ Optional/StringUtils/Objects é˜²å¾¡ |

### ğŸ¯ éªŒæ”¶æ ‡å‡†

- [ ] æ—  Java 9+ è¯­æ³• (var/record/switch expression/ç­‰)
- [ ] æ‰€æœ‰ç±»æœ‰ JavaDoc ç±»æ³¨é‡Š
- [ ] æ‰€æœ‰ public æ–¹æ³•æœ‰ JavaDoc æ–¹æ³•æ³¨é‡Š
- [ ] ä¸šåŠ¡é€»è¾‘åˆ†æ”¯æœ‰ä¸­æ–‡æ³¨é‡Š
- [ ] MyBatis-Plus æŸ¥è¯¢ä½¿ç”¨ Lambda é£æ ¼
- [ ] å‰ç«¯ç»„ä»¶ä½¿ç”¨ `<script setup>`
- [ ] CSS æœ‰ scoped å±æ€§
- [ ] å‰ç«¯é¡µé¢æ— ç™½å±ã€æ— æ§åˆ¶å°é”™è¯¯
```

---

## 2. æŠ€æœ¯æ ˆè§„èŒƒ (Tech Stack Specifications)

### 2.1 Backend (Java 1.8 Strict)

#### è¯­æ³•é™åˆ¶é»‘åå•

| è¯­æ³•ç‰¹æ€§ | Java ç‰ˆæœ¬ | âŒ é”™è¯¯å†™æ³• | âœ… æ­£ç¡®å†™æ³• |
|---------|----------|-----------|-----------|
| ç±»å‹æ¨æ–­ | Java 10 | `var name = "test"` | `String name = "test"` |
| record | Java 14 | `record Point(int x, int y) {}` | `class Point { final int x; ... }` |
| sealed class | Java 15 | `sealed class Shape {}` | `abstract class Shape {}` |
| switch expression | Java 12 | `switch (v) { case A -> }` | `switch (v) { case A: break; }` |
| text blocks | Java 15 | `String s = """..."""` | `String s = "...\n..."` |
| Optional.isEmpty() | Java 11 | `opt.isEmpty()` | `!opt.isPresent()` |
| Optional.orElseThrow() æ— å‚ | Java 10 | `opt.orElseThrow()` | `opt.orElseThrow(() -> new Ex())` |
| Collection.toList() | Java 16 | `list.stream().toList()` | `list.stream().collect(Collectors.toList())` |
| Pattern matching instanceof | Java 14 | `if (obj instanceof String s)` | `if (obj instanceof String) { String s = (String) obj; }` |

#### ORM è§„èŒƒ (MyBatis-Plus 3.5.2)

```java
// âœ… æ­£ç¡®: ä½¿ç”¨ Lambda é£æ ¼ï¼Œé¿å… Magic String
List<ImUser> users = userMapper.selectList(new LambdaQueryWrapper<ImUser>()
    .eq(ImUser::getId, userId)
    .eq(ImUser::getDelFlag, "0")
    .like(ImUser::getNickName, keyword)
    .orderByDesc(ImUser::getCreateTime));

// âŒ é”™è¯¯: Magic String å®¹æ˜“å‡ºé”™
List<ImUser> users = userMapper.selectList(new QueryWrapper<ImUser>()
    .eq("id", userId)
    .eq("del_flag", "0"));

// âœ… æ­£ç¡®: Lambda æ›´æ–°
userMapper.update(null, new LambdaUpdateWrapper<ImUser>()
    .set(ImUser::getNickName, newName)
    .eq(ImUser::getId, userId));

// âœ… æ­£ç¡®: Service å±‚æ˜¾å¼å£°æ˜äº‹åŠ¡
@Override
@Transactional(rollbackFor = Exception.class)
public void updateUserName(Long userId, String newName) {
    // ä¸šåŠ¡é€»è¾‘
}
```

#### åˆ†å±‚æ¶æ„å¼ºåˆ¶è¦æ±‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Controller å±‚                                       â”‚
â”‚  - èŒè´£: æ¥æ”¶è¯·æ±‚ã€å‚æ•°æ ¡éªŒã€è°ƒç”¨ Serviceã€è¿”å›å“åº”   â”‚
â”‚  - ç¦æ­¢: ç›´æ¥è°ƒç”¨ Mapperã€ç¼–å†™ä¸šåŠ¡é€»è¾‘                â”‚
â”‚  - å¿…é¡»: ä½¿ç”¨ DTO æ¥æ”¶å‚æ•°ã€ä½¿ç”¨ VO è¿”å›æ•°æ®          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Service å±‚                                           â”‚
â”‚  - èŒè´£: ä¸šåŠ¡é€»è¾‘ã€äº‹åŠ¡æ§åˆ¶ã€è°ƒç”¨ Mapper              â”‚
â”‚  - ç¦æ­¢: è·¨å±‚è°ƒç”¨ Controllerã€ç›´æ¥å¤„ç† HTTP è¯·æ±‚      â”‚
â”‚  - å¿…é¡»: æ·»åŠ  @Transactional æ³¨è§£                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Mapper å±‚                                            â”‚
â”‚  - èŒè´£: æ•°æ®åº“è®¿é—®ã€SQL æ‰§è¡Œ                         â”‚
â”‚  - ç¦æ­¢: åŒ…å«ä¸šåŠ¡é€»è¾‘ã€ç›´æ¥è¿”å› Entity ç»™ä¸Šå±‚         â”‚
â”‚  - å¿…é¡»: ä½¿ç”¨ MyBatis-Plus Lambda é£æ ¼               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Frontend (Vue 3 + Composition API)

#### ç»„ä»¶è§„èŒƒ

```vue
<!-- âœ… æ­£ç¡®: æ ‡å‡†ç»„ä»¶ç»“æ„ -->
<template>
  <div class="user-profile">
    <!-- æ¨¡æ¿å†…å®¹ -->
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'
import { getUserInfo } from '@/api/im/user'

// å“åº”å¼æ•°æ®
const userInfo = ref(null)
const loading = ref(false)

// è®¡ç®—å±æ€§ (ä¼˜å…ˆäºæ–¹æ³•)
const displayName = computed(() => {
  return userInfo.value?.nickName || 'æœªçŸ¥ç”¨æˆ·'
})

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadUserInfo()
})

// æ–¹æ³•
async function loadUserInfo() {
  loading.value = true
  try {
    const res = await getUserInfo()
    userInfo.value = res.data
  } finally {
    loading.value = false
  }
}
</script>

<style scoped>
.user-profile {
  /* æ ·å¼å†…å®¹ */
}
</style>
```

#### API å°è£…è§„èŒƒ

```javascript
// âœ… æ­£ç¡®: src/api/im/user.js
import request from '@/utils/request'

/**
 * è·å–ç”¨æˆ·ä¿¡æ¯
 * @param {number} userId - ç”¨æˆ·ID
 * @returns {Promise} ç”¨æˆ·ä¿¡æ¯
 */
export function getUserInfo(userId) {
  return request({
    url: '/api/im/user/info',
    method: 'get',
    params: { userId }
  })
}

/**
 * æ›´æ–°ç”¨æˆ·ä¿¡æ¯
 * @param {Object} data - ç”¨æˆ·æ•°æ®
 * @param {number} data.id - ç”¨æˆ·ID
 * @param {string} data.nickName - æ˜µç§°
 * @param {string} data.avatar - å¤´åƒURL
 */
export function updateUserInfo(data) {
  return request({
    url: '/api/im/user/update',
    method: 'post',
    data
  })
}
```

#### Vue 3 çº¦æŸ

| çº¦æŸé¡¹ | è§„åˆ™ |
|-------|------|
| è„šæœ¬è¯­æ³• | å¿…é¡»ä½¿ç”¨ `<script setup lang="js">` |
| æ ·å¼éš”ç¦» | CSS å¿…é¡»åŠ  `scoped` å±æ€§ |
| å“åº”å¼æ•°æ® | ç®€å•ç±»å‹ç”¨ `ref`ï¼Œå¯¹è±¡ç”¨ `reactive` |
| è®¡ç®—å±æ€§ | ä¼˜å…ˆä½¿ç”¨ `computed`ï¼Œé¿å…é‡å¤è®¡ç®— |
| äº‹ä»¶å‘½å | ä½¿ç”¨ kebab-case: `@send-message` |
| Props å®šä¹‰ | å¿…é¡»å®šä¹‰ç±»å‹å’Œé»˜è®¤å€¼ |
| å¼‚æ­¥æ“ä½œ | å¿…é¡»ä½¿ç”¨ `try-finally` å¤„ç† loading |

---

## 3. ç¼–ç ç»†èŠ‚ä¸é˜²å¾¡æ€§ç¼–ç¨‹

### 3.1 å‘½åè§„èŒƒ

#### å‘½åç¦æ­¢åˆ—è¡¨

| âŒ ç¦æ­¢å‘½å | åŸå›  | âœ… æ¨èå‘½å |
|-----------|------|-----------|
| `data` | æ— è¯­ä¹‰ | `userVO`, `messageDTO` |
| `info` | æ— è¯­ä¹‰ | `userInfo`, `messageInfo` |
| `temp` | ä¸´æ—¶å˜é‡å‘½å | `cachedUser`, `buffer` |
| `obj` | æ— è¯­ä¹‰ | `requestParam`, `response` |
| `handle` | åŠ¨è¯ä¸æ˜ç¡® | `processMessage`, `validateUser` |
| `process` | åŠ¨è¯ä¸æ˜ç¡® | `calculateRevenue`, `transformData` |
| `doxxx` | å†—ä½™å‰ç¼€ | ç›´æ¥ç”¨åŠ¨è¯: `sendMessage` |

#### ç±»å‘½åè§„èŒƒ

```java
// âœ… æ­£ç¡®çš„ç±»å‘½å
ImUserController          // Controller: XxxController
ImMessageService          // Service: XxxService / XxxServiceImpl
ImUserMapper              // Mapper: XxxMapper
ImUser                    // Entity: ç›´æ¥å¯¹åº”è¡¨å
ImMessageDTO              // DTO: XxxDTO (è¯·æ±‚å‚æ•°)
ImMessageVO               // VO: XxxVO (å“åº”æ•°æ®)
ImUserQuery               // Query: XxxQuery (æŸ¥è¯¢å‚æ•°)

// âŒ é”™è¯¯çš„ç±»å‘½å
ImUserHandle              // handle ç¦æ­¢
ImUserData                // data ç¦æ­¢
ImMessageInfo             // Entity ä¸åŠ åç¼€
ImUserObject              // obj ç¦æ­¢
```

#### æ–¹æ³•å‘½åè§„èŒƒ

```java
// âœ… æ­£ç¡®çš„æ–¹æ³•å‘½å (åŠ¨è¯å¼€å¤´)
sendMessage()             // å‘é€æ¶ˆæ¯
getUserInfo()             // è·å–ç”¨æˆ·ä¿¡æ¯
validateToken()           // éªŒè¯ä»¤ç‰Œ
calculateRevenue()        // è®¡ç®—æ”¶å…¥
transformData()           // è½¬æ¢æ•°æ®
processMessage()          // å¤„ç†æ¶ˆæ¯

// âŒ é”™è¯¯çš„æ–¹æ³•å‘½å
message()                 // åè¯ï¼Œä¸æ˜ç¡®
userHandle()              // handle ç¦æ­¢
doProcess()               // do å‰ç¼€å†—ä½™
```

### 3.2 æ³¨é‡Šè§„èŒƒ

#### JavaDoc æ³¨é‡Š

```java
/**
 * IM æ¶ˆæ¯æœåŠ¡æ¥å£
 *
 * @author Antigravity
 * @date 2025-01-22
 */
public interface ImMessageService {

    /**
     * å‘é€æ¶ˆæ¯
     * <p>æ¶ˆæ¯ä¼šä¿å­˜åˆ°æ•°æ®åº“å¹¶é€šè¿‡ WebSocket æ¨é€ç»™ä¼šè¯æˆå‘˜</p>
     *
     * @param message æ¶ˆæ¯å®ä½“ï¼ŒåŒ…å«ä¼šè¯IDã€å‘é€è€…IDã€æ¶ˆæ¯ç±»å‹å’Œå†…å®¹
     * @return ä¿å­˜åçš„æ¶ˆæ¯å®ä½“ï¼ŒåŒ…å«ç”Ÿæˆçš„IDå’Œæ—¶é—´æˆ³
     * @throws BusinessException å½“ä¼šè¯ä¸å­˜åœ¨æˆ–å‘é€å¤±è´¥æ—¶æŠ›å‡º
     */
    ImMessage sendMessage(ImMessage message);
}
```

#### é€»è¾‘æ³¨é‡Šè§„èŒƒ

```java
// âœ… æ­£ç¡®: è¯´æ˜ä¸šåŠ¡èƒŒæ™¯
// çŠ¶æ€ä¸º1ä»£è¡¨è®¢å•å·²æ”¯ä»˜ï¼Œè§¦å‘åº“å­˜æ‰£å‡é€»è¾‘
if (order.getStatus() == 1) {
    inventoryService.deduct(order.getProductId(), order.getQuantity());
}

// âŒ é”™è¯¯: ç¿»è¯‘ä»£ç 
// å¦‚æœçŠ¶æ€ç­‰äº1
if (order.getStatus() == 1) {
    inventoryService.deduct(order.getProductId(), order.getQuantity());
}
```

### 3.3 å¼‚å¸¸å¤„ç†è§„èŒƒ

#### ç¦æ­¢äº‹é¡¹

```java
// âŒ é”™è¯¯: åå¼‚å¸¸
try {
    doSomething();
} catch (Exception e) {
    // ä»€ä¹ˆéƒ½ä¸åš
}

// âŒ é”™è¯¯: åªæ‰“å°ä¸æŠ›å‡º
try {
    doSomething();
} catch (Exception e) {
    e.printStackTrace();
}

// âŒ é”™è¯¯: æ•è·å¤ªå®½æ³›
try {
    doSomething();
} catch (Throwable t) {
    // ...
}
```

#### æ­£ç¡®åšæ³•

```java
// âœ… æ­£ç¡®: å®Œæ•´çš„å¼‚å¸¸å¤„ç†
try {
    doSomething(param);
} catch (BusinessException e) {
    // ä¸šåŠ¡å¼‚å¸¸ï¼Œè®°å½•æ—¥å¿—åæŠ›å‡º
    log.error("ä¸šåŠ¡å¤„ç†å¤±è´¥, å‚æ•°: {}", param, e);
    throw e;
} catch (Exception e) {
    // ç³»ç»Ÿå¼‚å¸¸ï¼Œè®°å½•æ—¥å¿—ååŒ…è£…æŠ›å‡º
    log.error("ç³»ç»Ÿå¼‚å¸¸, æ‰§è¡Œxxxå¤±è´¥, å‚æ•°: {}", param, e);
    throw new BusinessException(500, "ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•");
}

// âœ… æ­£ç¡®: NPE é˜²æŠ¤
public void processUser(Long userId) {
    // ä½¿ç”¨ Optional é˜²æŠ¤
    ImUser user = userMapper.selectById(userId);
    if (user == null) {
        throw new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨");
    }

    // ä½¿ç”¨ StringUtils é˜²æŠ¤
    String nickName = user.getNickName();
    if (StringUtils.isBlank(nickName)) {
        nickName = "åŒ¿åç”¨æˆ·";
    }
}
```

---

## 4. æ•°æ®åº“ä¸‰å±‚éš”ç¦»è§„èŒƒ

### 4.1 æ ¸å¿ƒåŸåˆ™

**æ•°æ®åº“å­—æ®µ â‰  API æ¥å£å­—æ®µ â‰  å‰ç«¯é¡µé¢å­—æ®µ**

å¿…é¡»ä½¿ç”¨ä¸‰å±‚éš”ç¦»ï¼š
- **Entity**: æ•°æ®åº“å®ä½“æ˜ å°„ï¼ˆç›´æ¥å¯¹åº”æ•°æ®åº“ï¼‰
- **DTO/VO**: æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆAPI æ¥å£ä½¿ç”¨ï¼‰
- **Frontend Model**: å‰ç«¯æ•°æ®æ¨¡å‹ï¼ˆå‰ç«¯ç»„ä»¶ä½¿ç”¨ï¼‰

### 4.2 åˆ†å±‚å®šä¹‰

```
com.ruoyi.im.domain/
â”œâ”€â”€ entity/        # Entity - æ•°æ®åº“å®ä½“
â”‚   â””â”€â”€ ImMessage.java
â”œâ”€â”€ dto/           # DTO - æ¥æ”¶è¯·æ±‚å‚æ•°
â”‚   â””â”€â”€ ImMessageDTO.java
â””â”€â”€ vo/            # VO - è¿”å›å“åº”æ•°æ®
    â””â”€â”€ ImMessageVO.java
```

### 4.3 Entity ç¤ºä¾‹

```java
/**
 * IM æ¶ˆæ¯å®ä½“
 * å¯¹åº”æ•°æ®åº“è¡¨: im_message
 */
@Data
@TableName("im_message")
public class ImMessage {

    /**
     * ä¸»é”®ID
     */
    @TableId(type = IdType.ASSIGN_ID)
    private Long id;

    /**
     * ä¼šè¯ID
     */
    @TableField("conversation_id")
    private Long conversationId;

    /**
     * å‘é€è€…ID
     */
    @TableField("sender_id")
    private Long senderId;

    /**
     * æ¶ˆæ¯ç±»å‹: TEXT, IMAGE, FILE, VOICE, VIDEO
     */
    @TableField("message_type")
    private String messageType;

    /**
     * æ¶ˆæ¯å†…å®¹ (JSON æ ¼å¼)
     */
    private String content;

    /**
     * æ˜¯å¦å·²æ’¤å›: 0-å¦ 1-æ˜¯
     */
    @TableField("is_revoked")
    private String isRevoked;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    @TableField("create_time")
    private LocalDateTime createTime;

    /**
     * æ›´æ–°æ—¶é—´
     */
    @TableField("update_time")
    private LocalDateTime updateTime;

    /**
     * åˆ é™¤æ ‡å¿—: 0-æ­£å¸¸ 1-åˆ é™¤
     */
    @TableField("del_flag")
    private String delFlag;

    // ===== éæ•°æ®åº“å­—æ®µ =====

    /**
     * å‘é€è€…æ˜µç§° (å…³è”æŸ¥è¯¢)
     */
    @TableField(exist = false)
    private String senderName;

    /**
     * å‘é€è€…å¤´åƒ (å…³è”æŸ¥è¯¢)
     */
    @TableField(exist = false)
    private String senderAvatar;
}
```

### 4.4 DTO ç¤ºä¾‹

```java
/**
 * å‘é€æ¶ˆæ¯è¯·æ±‚ DTO
 * <p>åªåŒ…å«å‰ç«¯éœ€è¦ä¼ é€’çš„å­—æ®µ</p>
 */
@Data
public class ImMessageDTO {

    /**
     * ä¼šè¯ID
     */
    @NotNull(message = "ä¼šè¯IDä¸èƒ½ä¸ºç©º")
    private Long conversationId;

    /**
     * æ¶ˆæ¯ç±»å‹
     */
    @NotBlank(message = "æ¶ˆæ¯ç±»å‹ä¸èƒ½ä¸ºç©º")
    private String messageType;

    /**
     * æ¶ˆæ¯å†…å®¹
     */
    @NotBlank(message = "æ¶ˆæ¯å†…å®¹ä¸èƒ½ä¸ºç©º")
    private String content;

    /**
     * å›å¤æ¶ˆæ¯ID (å¯é€‰)
     */
    private Long replyToMessageId;

    // æ³¨æ„: ä¸åŒ…å« id, senderId, createTime ç­‰ç”±åç«¯ç”Ÿæˆçš„å­—æ®µ
}
```

### 4.5 VO ç¤ºä¾‹

```java
/**
 * æ¶ˆæ¯å“åº” VO
 * <p>åªåŒ…å«è¿”å›ç»™å‰ç«¯éœ€è¦å±•ç¤ºçš„å­—æ®µ</p>
 */
@Data
public class ImMessageVO {

    /**
     * æ¶ˆæ¯ID
     */
    private Long id;

    /**
     * ä¼šè¯ID
     */
    private Long conversationId;

    /**
     * å‘é€è€…ID
     */
    private Long senderId;

    /**
     * å‘é€è€…æ˜µç§°
     */
    private String senderName;

    /**
     * å‘é€è€…å¤´åƒ
     */
    private String senderAvatar;

    /**
     * æ¶ˆæ¯ç±»å‹
     */
    private String messageType;

    /**
     * æ¶ˆæ¯å†…å®¹
     */
    private String content;

    /**
     * æ˜¯å¦å·²æ’¤å›
     */
    private Boolean isRevoked;

    /**
     * åˆ›å»ºæ—¶é—´
     */
    private LocalDateTime createTime;

    // æ³¨æ„: ä¸åŒ…å«æ•æ„Ÿå­—æ®µæˆ–ä¸éœ€è¦è¿”å›çš„å­—æ®µ
}
```

### 4.6 Controller å±‚è½¬æ¢

```java
/**
 * IM æ¶ˆæ¯æ§åˆ¶å™¨
 */
@RestController
@RequestMapping("/api/im/message")
public class ImMessageController {

    @Autowired
    private ImMessageService messageService;

    /**
     * å‘é€æ¶ˆæ¯
     *
     * @param dto å‰ç«¯ä¼ é€’çš„å‚æ•° (DTO)
     * @return è¿”å›ç»™å‰ç«¯çš„æ•°æ® (VO)
     */
    @PostMapping("/send")
    public AjaxResult sendMessage(@RequestBody @Validated ImMessageDTO dto) {
        // 1. DTO â†’ Entity
        ImMessage message = BeanUtil.copyProperties(dto, ImMessage.class);

        // 2. è°ƒç”¨ Service
        ImMessage savedMessage = messageService.sendMessage(message);

        // 3. Entity â†’ VO
        ImMessageVO vo = BeanUtil.copyProperties(savedMessage, ImMessageVO.class);

        return AjaxResult.success(vo);
    }
}
```

### 4.7 å‰ç«¯ API å®šä¹‰

```javascript
// src/api/im/message.js

/**
 * å‘é€æ¶ˆæ¯
 * @param {Object} params - å‚æ•°å¯¹è±¡
 * @param {number} params.conversationId - ä¼šè¯ID
 * @param {string} params.messageType - æ¶ˆæ¯ç±»å‹ TEXT/IMAGE/FILE
 * @param {string} params.content - æ¶ˆæ¯å†…å®¹
 * @param {number} [params.replyToMessageId] - å›å¤æ¶ˆæ¯ID (å¯é€‰)
 */
export function sendMessage(params) {
  return request({
    url: '/api/im/message/send',
    method: 'post',
    data: params
  })
}
```

---

## 5. äº¤ä»˜ç‰©æ ‡å‡†

### 5.1 Java ä»£ç æ ‡å‡†

#### ç±»çº§åˆ«è¦æ±‚

```java
/**
 * IM ç”¨æˆ·æœåŠ¡å®ç°ç±»
 *
 * <p>ä¸»è¦åŠŸèƒ½:</p>
 * <ul>
 *   <li>ç”¨æˆ·æ³¨å†Œä¸ç™»å½•</li>
 *   <li>ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢ä¸æ›´æ–°</li>
 *   <li>ç”¨æˆ·çŠ¶æ€ç®¡ç†</li>
 * </ul>
 *
 * @author Antigravity
 * @date 2025-01-22
 * @see ImUserService
 */
@Service
public class ImUserServiceImpl implements ImUserService {

    private static final Logger log = LoggerFactory.getLogger(ImUserServiceImpl.class);

    /**
     * é»˜è®¤å¤´åƒURL
     */
    private static final String DEFAULT_AVATAR = "/default/avatar.png";

    /**
     * ç”¨æˆ·ç¼“å­˜è¿‡æœŸæ—¶é—´ (ç§’)
     */
    private static final long CACHE_EXPIRE_SECONDS = 3600L;

    // ...
}
```

#### æ–¹æ³•çº§åˆ«è¦æ±‚

```java
/**
 * æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
 *
 * @param userId ç”¨æˆ·IDï¼Œä¸èƒ½ä¸ºç©º
 * @return ç”¨æˆ·ä¿¡æ¯ï¼Œå¦‚æœç”¨æˆ·ä¸å­˜åœ¨è¿”å› null
 * @throws IllegalArgumentException å½“ userId ä¸º null æ—¶æŠ›å‡º
 */
public ImUserVO getUserById(Long userId) {
    if (userId == null) {
        throw new IllegalArgumentException("ç”¨æˆ·IDä¸èƒ½ä¸ºç©º");
    }

    ImUser user = userMapper.selectById(userId);
    if (user == null) {
        return null;
    }

    return BeanUtil.copyProperties(user, ImUserVO.class);
}
```

### 5.2 å‰ç«¯ä»£ç æ ‡å‡†

#### ç»„ä»¶ç»“æ„è¦æ±‚

```vue
<template>
  <div class="chat-container">
    <chat-header :title="title" @close="handleClose" />
    <chat-message-list :messages="messages" />
    <chat-input @send="handleSendMessage" />
  </div>
</template>

<script setup>
import { ref, computed, onMounted, onUnmounted } from 'vue'
import { useStore } from 'vuex'
import ChatHeader from './ChatHeader.vue'
import ChatMessageList from './ChatMessageList.vue'
import ChatInput from './ChatInput.vue'

// Props å®šä¹‰
const props = defineProps({
  sessionId: {
    type: String,
    required: true
  }
})

// Emits å®šä¹‰
const emit = defineEmits(['close', 'message-sent'])

// å“åº”å¼æ•°æ®
const store = useStore()
const messages = ref([])
const loading = ref(false)

// è®¡ç®—å±æ€§
const title = computed(() => {
  return store.getters['im/currentSessionName'] || 'èŠå¤©'
})

// ç”Ÿå‘½å‘¨æœŸ
onMounted(() => {
  loadMessages()
})

// æ–¹æ³•
async function loadMessages() {
  loading.value = true
  try {
    const data = await store.dispatch('im/loadMessages', {
      sessionId: props.sessionId
    })
    messages.value = data
  } catch (error) {
    console.error('åŠ è½½æ¶ˆæ¯å¤±è´¥:', error)
  } finally {
    loading.value = false
  }
}

function handleSendMessage(content) {
  emit('message-sent', { content })
}
</script>

<style scoped>
.chat-container {
  display: flex;
  flex-direction: column;
  height: 100%;
}
</style>
```

---

## 6. æ£€æŸ¥æ¸…å•

### 6.1 å¢é‡å¼€å‘å‰ç½®æ£€æŸ¥

**åœ¨æ‰§è¡Œä»»ä½• write_file æ“ä½œä¹‹å‰å¿…é¡»æ‰§è¡Œ**ï¼š

```markdown
## ğŸ”„ å¢é‡å¼€å‘å‰ç½®æ£€æŸ¥

- [ ] **Context Retrieval**: ä½¿ç”¨ Glob/Grep æœç´¢æ˜¯å¦å·²å­˜åœ¨åŒå/åŒç±»æ–‡ä»¶
- [ ] **Dependency Check**: æ£€æŸ¥ç°æœ‰ pom.xml æ˜¯å¦å·²åŒ…å«æ‰€éœ€ä¾èµ–
- [ ] **Layer Validation**: ç¡®è®¤ä¿®æ”¹ä¸ä¼šç ´åå•å‘ä¾èµ–
- [ ] **Conflict Scan**: æ£€æŸ¥ Git status æ˜¯å¦æœ‰æœªæäº¤çš„å†²çªæ–‡ä»¶
- [ ] **Duplication Check**: ç¡®è®¤ä¸å­˜åœ¨åŠŸèƒ½é‡å¤çš„ä»£ç 
```

### 6.2 JDK 1.8 å…¼å®¹æ€§æ£€æŸ¥

**ä»£ç ç”Ÿæˆåå¿…é¡»æ£€æŸ¥**ï¼š

```markdown
## â˜• JDK 1.8 å…¼å®¹æ€§æ£€æŸ¥

- [ ] æ—  `var` å…³é”®å­— (ç±»å‹æ¨æ–­)
- [ ] æ—  `record` ç±»å‹
- [ ] æ—  `sealed class` å…³é”®å­—
- [ ] æ—  `switch expression` (-> è¯­æ³•)
- [ ] æ— æ–‡æœ¬å— `"""` è¯­æ³•
- [ ] æ—  `Optional.isEmpty()` (Java 11+)
- [ ] æ—  `Optional.orElseThrow()` æ— å‚ç‰ˆæœ¬
- [ ] æ—  `Collection.toList()` (Java 16+)
- [ ] æ—  Pattern matching instanceof
- [ ] æ—  Stream.toList() (Java 16+)
```

### 6.3 ä»£ç è´¨é‡æ£€æŸ¥

```markdown
## ğŸ“ ä»£ç è´¨é‡æ£€æŸ¥

### åç«¯ (Java)
- [ ] ç±»çº§åˆ« JavaDoc å­˜åœ¨
- [ ] æ‰€æœ‰ public æ–¹æ³•æœ‰ JavaDoc (å‚æ•°ã€è¿”å›å€¼ã€å¼‚å¸¸)
- [ ] ä¸šåŠ¡é€»è¾‘åˆ†æ”¯æœ‰ä¸­æ–‡æ³¨é‡Š (è¯´æ˜ä¸šåŠ¡èƒŒæ™¯)
- [ ] NPE é˜²æŠ¤: Optional/StringUtils/Objects
- [ ] å¸¸é‡å®šä¹‰: é­”æ³•å€¼å·²æ›¿æ¢ä¸ºå¸¸é‡
- [ ] å¼‚å¸¸å¤„ç†: ä¸åå¼‚å¸¸ï¼Œæœ‰æ—¥å¿—è®°å½•

### åˆ†å±‚éªŒè¯
- [ ] Controller æ— ç›´æ¥è°ƒç”¨ Mapper
- [ ] Service æ— è·¨å±‚è°ƒç”¨ Controller
- [ ] DTO/VO ä¸ Entity åˆ†ç¦»
- [ ] äº‹åŠ¡æ³¨è§£åœ¨ Service å±‚

### å‰ç«¯ (Vue)
- [ ] ä½¿ç”¨ `<script setup>` è¯­æ³•
- [ ] CSS æœ‰ `scoped` å±æ€§
- [ ] API å°è£…åœ¨ `api/` ç›®å½•
- [ ] Props å®šä¹‰äº†ç±»å‹å’Œé»˜è®¤å€¼
- [ ] Emits æœ‰æ˜ç¡®å®šä¹‰
- [ ] å¼‚æ­¥æ“ä½œæœ‰ try-finally å¤„ç† loading
```

### 6.4 MyBatis-Plus è§„èŒƒæ£€æŸ¥

```markdown
## ğŸ—„ï¸ MyBatis-Plus è§„èŒƒæ£€æŸ¥

- [ ] æŸ¥è¯¢ä½¿ç”¨ Lambda: `.eq(ImUser::getId, id)`
- [ ] æ—  Magic String: `.eq("id", id)` âŒ
- [ ] å¤§è¡¨æŸ¥è¯¢å·²åˆ†é¡µ (å•é¡µ â‰¤ 1000 æ¡)
- [ ] ç¦æ­¢ `SELECT *`ï¼Œæ˜ç¡®æŒ‡å®šå­—æ®µ
- [ ] Entity æœ‰ `@TableName` æ³¨è§£
- [ ] éæ•°æ®åº“å­—æ®µæœ‰ `@TableField(exist = false)`
- [ ] Service å±‚æœ‰ `@Transactional` æ³¨è§£
```

### 6.5 å‰åç«¯å¯¹é½æ£€æŸ¥

```markdown
## ğŸ”— å‰åç«¯å¯¹é½æ£€æŸ¥

- [ ] DTO å­—æ®µä¸å‰ç«¯ API å‚æ•°ä¸€è‡´
- [ ] VO å­—æ®µä¸å‰ç«¯å±•ç¤ºæ•°æ®ä¸€è‡´
- [ ] å­—æ®µå‘½åç»Ÿä¸€ä½¿ç”¨ camelCase
- [ ] æ—¥æœŸæ ¼å¼ç»Ÿä¸€ ( LocalDateTime / timestamp )
- [ ] åˆ†é¡µå‚æ•°ç»Ÿä¸€ (pageNum/pageSize, current/size )
```

---

## 7. å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

### 7.1 æœç´¢å‘½ä»¤

```bash
# æœç´¢ç±»å
Grep: "ImUserController"
Grep: "class ImUserController"

# æœç´¢æ–¹æ³•å
Grep: "sendMessage"
Grep: "public.*sendMessage"

# æŸ¥æ‰¾æ‰€æœ‰æ§åˆ¶å™¨
Glob: "**/*Controller.java"

# æŸ¥æ‰¾æ‰€æœ‰å®ä½“
Glob: "**/domain/entity/*.java"

# æŸ¥æ‰¾æ‰€æœ‰ DTO
Glob: "**/dto/*.java"

# æŸ¥æ‰¾æ‰€æœ‰ VO
Glob: "**/vo/*.java"
```

### 7.2 Maven å‘½ä»¤

```bash
# æ¸…ç†å¹¶æ„å»º
cd ruoyi-im-api
mvn clean package

# å®‰è£…åˆ°æœ¬åœ°ä»“åº“
mvn clean install

# è·³è¿‡æµ‹è¯•æ„å»º
mvn clean package -DskipTests
```

### 7.3 å‰ç«¯å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
cd ruoyi-im-web
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# ç”Ÿäº§æ„å»º
npm run build
```

### 7.4 æ•°æ®åº“å‘½ä»¤

```bash
# è¿æ¥æ•°æ®åº“
mysql -h 172.168.20.222 -P 3306 -u im -p123456 im

# æ‰§è¡Œ SQL è„šæœ¬
mysql -u root -p im < sql/im.sql
```

---

## é™„å½•: å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### A1: å‰ç«¯å¤šä¼ å­—æ®µå¯¼è‡´æŠ¥é”™

**åŸå› **: ä½¿ç”¨ Entity æ¥æ”¶å‚æ•°ï¼ŒMyBatis-Plus å°è¯•æ˜ å°„æ‰€æœ‰å­—æ®µ

**è§£å†³æ–¹æ¡ˆ**:
```java
// æ–¹æ¡ˆ 1: ä½¿ç”¨ DTO æ¥æ”¶ (æ¨è)
@PostMapping("/xxx")
public AjaxResult xxx(@RequestBody XxxDTO dto) {
    // DTO ä¸­ä¸å­˜åœ¨çš„å­—æ®µä¼šè¢«å¿½ç•¥
}

// æ–¹æ¡ˆ 2: å…¨å±€é…ç½® (application.yml)
spring:
  jackson:
    deserialization:
      fail-on-unknown-properties: false  # å¿½ç•¥æœªçŸ¥å­—æ®µ
```

### A2: å­—æ®µå‘½åä¸ä¸€è‡´å¯¼è‡´æ˜ å°„å¤±è´¥

**åŸå› **: å‰ç«¯ä½¿ç”¨ camelCaseï¼Œåç«¯ä½¿ç”¨å…¶ä»–å‘½å

**è§£å†³æ–¹æ¡ˆ**: ç»Ÿä¸€ä½¿ç”¨ camelCase
```java
// âœ… æ­£ç¡®: å‰åç«¯ä¸€è‡´
private Long conversationId;

// âŒ é”™è¯¯: ä¸ä¸€è‡´
private Long conversation_id;
```

### A3: æ•°æ®åº“å­—æ®µä¸ API å­—æ®µæ··æ·†

**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨ MyBatis-Plus å­—æ®µæ˜ å°„
```java
@Data
@TableName("im_message")
public class ImMessage {

    @TableId(type = IdType.ASSIGN_ID)
    private Long id;

    @TableField("conversation_id")  // æ•°æ®åº“å­—æ®µå
    private Long conversationId;    // Java å­—æ®µå

    @TableField(exist = false)     // ä¸å­˜åœ¨äºæ•°æ®åº“
    private String extraField;
}
```

---

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´è¯´æ˜ |
|-----|------|---------|
| v2.0 | 2025-01-22 | å¢å¼ºç‰ˆ: å®Œæ•´ç‹¬ç«‹ï¼ŒåŒ…å«æ‰€æœ‰ç»†èŠ‚ |
| v1.0 | 2024-12-XX | åˆå§‹ç‰ˆæœ¬ |

---

**æ–‡æ¡£ç»´æŠ¤**: æœ¬æ–‡æ¡£åº”éšé¡¹ç›®æ¼”è¿›æŒç»­æ›´æ–°ã€‚å¦‚å‘ç°ä¸ä¸€è‡´æˆ–é—æ¼ï¼Œè¯·åŠæ—¶ä¿®è®¢ã€‚
