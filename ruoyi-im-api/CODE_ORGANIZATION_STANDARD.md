# RuoYi IM API 代码组织规范和命名标准

## 1. 文件夹组织规范

### 1.1 工具类文件夹统一规范
- **统一使用 `utils` 文件夹**：删除 `common/util` 文件夹
- **迁移路径**：
  - `com.ruoyi.im.common.util.MessagePushUtils` → `com.ruoyi.im.utils.MessagePushUtils`

### 1.2 包结构规范
```
com.ruoyi.im
├── annotation/          # 自定义注解
├── aspect/             # AOP切面
├── common/             # 公共组件
│   ├── config/         # 配置类
│   ├── constant/       # 常量定义
│   └── exception/      # 异常定义
├── controller/         # 控制器层
├── domain/             # 实体模型
├── dto/                # 数据传输对象
├── interceptor/        # 拦截器
├── mapper/             # 数据访问层
│   └── base/           # 基础Mapper
├── monitor/            # 监控组件
├── service/            # 业务逻辑层
│   └── impl/           # 服务实现
├── utils/              # 工具类（统一命名）
├── vo/                 # 视图对象
└── websocket/          # WebSocket相关
```

## 2. 命名规范

### 2.1 类命名规范
- **工具类**：统一使用 `*Utils` 格式
- **服务接口**：使用 `I*Service` 格式（符合Spring习惯）
- **服务实现**：使用 `*ServiceImpl` 格式
- **控制器**：使用 `*Controller` 格式

### 2.2 方法命名规范
- **CRUD操作**：统一使用 `insert`, `update`, `deleteById`, `selectById`
- **业务方法**：使用动宾短语，如 `sendMessage`, `loginUser`
- **参数验证**：统一使用 `validate*Params` 格式

### 2.3 常量命名规范
- **缓存前缀**：使用大写和下划线，如 `MESSAGE_CACHE_PREFIX`
- **状态常量**：使用大写，如 `STATUS_SENT`
- **配置常量**：使用大写，如 `DEFAULT_PAGE_SIZE`

## 3. 代码复用规范

### 3.1 公共模块抽象
- **参数验证**：抽象为 `ValidationUtils`
- **缓存操作**：抽象为 `CacheUtils`
- **日志记录**：抽象为 `LoggingUtils`

### 3.2 基础服务抽象
- **增强基础服务**：使用 `EnhancedBaseServiceImpl`
- **缓存清理**：抽象到基类，子类只需覆盖特定逻辑

### 3.3 工具类规范
- **单一职责**：每个工具类只负责一类功能
- **静态方法**：工具类方法应设计为静态方法
- **参数验证**：工具类方法必须进行参数验证

## 4. 性能优化规范

### 4.1 缓存策略
- **统一缓存前缀**：使用模块化的缓存键命名
- **缓存超时**：根据业务需求设置合理的超时时间
- **缓存清理**：使用模式匹配清理相关缓存

### 4.2 事务管理
- **读操作**：使用 `@Transactional(readOnly = true)`
- **写操作**：使用 `@Transactional(rollbackFor = Exception.class)`
- **批量操作**：使用编程式事务控制

### 4.3 异步处理
- **消息推送**：使用 `CompletableFuture` 异步处理
- **日志记录**：异步记录性能日志
- **缓存操作**：使用异步更新缓存

## 5. 错误处理规范

### 5.1 异常分类
- **业务异常**：使用 `BusinessException`
- **系统异常**：使用 `RuntimeException`
- **参数异常**：使用 `IllegalArgumentException`

### 5.2 错误码规范
- **业务错误码**：使用统一的 `ImErrorCode` 枚举
- **HTTP状态码**：使用标准HTTP状态码
- **错误信息**：使用中文描述，便于理解

## 6. 文档规范

### 6.1 代码注释
- **类注释**：使用 `@author` 和 `@since` 标签
- **方法注释**：必须包含方法说明和参数说明
- **关键代码**：添加行内注释说明业务逻辑

### 6.2 接口文档
- **RESTful API**：使用Swagger注解
- **参数说明**：详细说明每个参数的作用
- **返回值说明**：说明成功和失败的不同情况

## 7. 维护指南

### 7.1 代码审查
- **命名检查**：确保命名符合规范
- **重复代码**：识别并消除重复代码
- **性能考虑**：检查是否有性能问题

### 7.2 性能监控
- **响应时间**：监控接口响应时间
- **缓存命中率**：监控缓存使用效果
- **错误率**：监控异常发生率

### 7.3 安全考虑
- **参数验证**：确保所有输入参数都经过验证
- **权限控制**：确保敏感操作有权限控制
- **数据加密**：敏感数据必须加密存储

## 8. 实施计划

### 阶段一：文件夹整理
1. 迁移 `common/util` 到 `utils`
2. 更新所有引用路径
3. 验证编译通过

### 阶段二：代码重构
1. 抽象重复验证逻辑
2. 统一缓存操作
3. 优化日志记录

### 阶段三：测试验证
1. 单元测试
2. 集成测试
3. 性能测试

### 阶段四：文档更新
1. 更新API文档
2. 编写维护手册
3. 制定后续规范

---

*本规范旨在提高代码质量，确保项目长期可维护性。请严格遵循以上规范进行开发和维护。*