<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.im.mapper.ImVideoCallMapper">

    <resultMap type="com.ruoyi.im.domain.ImVideoCall" id="ImVideoCallResult">
        <id property="id" column="id"/>
        <result property="callerId" column="caller_id"/>
        <result property="calleeId" column="callee_id"/>
        <result property="conversationId" column="conversation_id"/>
        <result property="callType" column="call_type"/>
        <result property="status" column="status"/>
        <result property="startTime" column="start_time"/>
        <result property="endTime" column="end_time"/>
        <result property="duration" column="duration"/>
        <result property="rejectReason" column="reject_reason"/>
    </resultMap>

    <sql id="selectImVideoCallVo">
        select id, caller_id, callee_id, conversation_id, call_type, status,
               start_time, end_time, duration, reject_reason
        from im_video_call
    </sql>

    <select id="selectImVideoCallById" parameterType="Long" resultMap="ImVideoCallResult">
        <include refid="selectImVideoCallVo"/>
        where id = #{id}
    </select>

    <insert id="insertImVideoCall" parameterType="com.ruoyi.im.domain.ImVideoCall" useGeneratedKeys="true" keyProperty="id">
        insert into im_video_call
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="callerId != null">caller_id,</if>
            <if test="calleeId != null">callee_id,</if>
            <if test="conversationId != null">conversation_id,</if>
            <if test="callType != null">call_type,</if>
            <if test="status != null">status,</if>
            <if test="startTime != null">start_time,</if>
            <if test="endTime != null">end_time,</if>
            <if test="duration != null">duration,</if>
            <if test="rejectReason != null">reject_reason,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="callerId != null">#{callerId},</if>
            <if test="calleeId != null">#{calleeId},</if>
            <if test="conversationId != null">#{conversationId},</if>
            <if test="callType != null">#{callType},</if>
            <if test="status != null">#{status},</if>
            <if test="startTime != null">#{startTime},</if>
            <if test="endTime != null">#{endTime},</if>
            <if test="duration != null">#{duration},</if>
            <if test="rejectReason != null">#{rejectReason},</if>
        </trim>
    </insert>

    <update id="updateImVideoCall" parameterType="com.ruoyi.im.domain.ImVideoCall">
        update im_video_call
        <trim prefix="SET" suffixOverrides=",">
            <if test="status != null">status = #{status},</if>
            <if test="endTime != null">end_time = #{endTime},</if>
            <if test="duration != null">duration = #{duration},</if>
            <if test="rejectReason != null">reject_reason = #{rejectReason},</if>
        </trim>
        where id = #{id}
    </update>

    <select id="selectCallsByUserId" resultMap="ImVideoCallResult">
        <include refid="selectImVideoCallVo"/>
        where caller_id = #{userId} or callee_id = #{userId}
        order by start_time desc
        <if test="limit != null">
            limit #{limit}
        </if>
    </select>

</mapper>
