<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.im.mapper.ImEmailAttachmentMapper">

    <resultMap type="com.ruoyi.im.domain.ImEmailAttachment" id="ImEmailAttachmentResult">
        <id property="id" column="id"/>
        <result property="emailId" column="email_id"/>
        <result property="fileName" column="file_name"/>
        <result property="fileSize" column="file_size"/>
        <result property="fileType" column="file_type"/>
        <result property="filePath" column="file_path"/>
        <result property="fileUrl" column="file_url"/>
        <result property="uploadTime" column="upload_time"/>
        <result property="uploaderId" column="uploader_id"/>
        <result property="createTime" column="create_time"/>
    </resultMap>

    <sql id="selectImEmailAttachmentVo">
        select id, email_id, file_name, file_size, file_type, file_path, file_url,
               upload_time, uploader_id, create_time
        from im_email_attachment
    </sql>

    <select id="selectAttachmentsByEmailId" parameterType="Long" resultMap="ImEmailAttachmentResult">
        <include refid="selectImEmailAttachmentVo"/>
        where email_id = #{emailId}
        order by create_time asc
    </select>

    <select id="selectAttachmentById" parameterType="Long" resultMap="ImEmailAttachmentResult">
        <include refid="selectImEmailAttachmentVo"/>
        where id = #{id}
    </select>

    <insert id="insertAttachment" parameterType="com.ruoyi.im.domain.ImEmailAttachment" useGeneratedKeys="true" keyProperty="id">
        insert into im_email_attachment
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="emailId != null">email_id,</if>
            <if test="fileName != null">file_name,</if>
            <if test="fileSize != null">file_size,</if>
            <if test="fileType != null">file_type,</if>
            <if test="filePath != null">file_path,</if>
            <if test="fileUrl != null">file_url,</if>
            <if test="uploadTime != null">upload_time,</if>
            <if test="uploaderId != null">uploader_id,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="emailId != null">#{emailId},</if>
            <if test="fileName != null">#{fileName},</if>
            <if test="fileSize != null">#{fileSize},</if>
            <if test="fileType != null">#{fileType},</if>
            <if test="filePath != null">#{filePath},</if>
            <if test="fileUrl != null">#{fileUrl},</if>
            <if test="uploadTime != null">#{uploadTime},</if>
            <if test="uploaderId != null">#{uploaderId},</if>
        </trim>
    </insert>

    <insert id="batchInsertAttachments">
        insert into im_email_attachment (email_id, file_name, file_size, file_type, file_path, file_url, upload_time, uploader_id)
        values
        <foreach collection="attachments" item="att" separator=",">
            (#{att.emailId}, #{att.fileName}, #{att.fileSize}, #{att.fileType}, #{att.filePath}, #{att.fileUrl}, #{att.uploadTime}, #{att.uploaderId})
        </foreach>
    </insert>

    <delete id="deleteAttachmentById" parameterType="Long">
        delete from im_email_attachment where id = #{id}
    </delete>

    <delete id="deleteAttachmentsByEmailId" parameterType="Long">
        delete from im_email_attachment where email_id = #{emailId}
    </delete>

</mapper>
